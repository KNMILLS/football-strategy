{"version":3,"mappings":"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","names":["shouldGoForTwo","ctx","late","go","performPAT","rng","pickBucketProb","ay","table","row","createFGModel","cfg","overrides","attemptYards","p","wind","head","k","buildPolicy","fgModel","chooseFourthDown","fg","yl","toGo","kickDistance","pMake","early","twoMin","trailing","choosePAT","chooseTempo","lead9","clamp","n","min","max","isRedZone","ballOnFromHome","playerIsHome","possession","toDistanceBucket","keyForSituation","down","dist","inRedZone","PlayerTendenciesMemory","side","playType","inRed","input","counts","g","bucketN","globalN","bucketRun","globalRun","w","OFFENSE_BASE_LABELS","makeCardId","deck","label","deckKey","labelKey","makeArtPath","inferTypeFromLabel","buildOffenseDeck","base","puntLabel","punt","c","OFFENSE_DECKS","DEFENSE_DECK","WHITE_SIGN_RESTRICTIONS","uiRegistered","bus","EventBus","tables","progressiveEnhancement","ensureUIRegistered","showInitialLoading","ErrorBoundary","__vitePreload","createFallbackHUD","createFallbackLog","createFallbackField","createFallbackHand","createFallbackControls","createGenericFallback","createLoadingSpinner","registerCoreUI","registerInteractiveUI","registerOptionalUI","hideLoadingSpinner","error","showCriticalError","errorDiv","loadingElement","spinner","text","style","errorElement","coreComponents","component","module","originalRegister","interactiveComponents","scheduleWork","callback","boundary","retry","info","element","container","modulePath","registerName","registerFn","initializeProgressiveEnhancement","ProgressiveEnhancement","features","loadTime","fps","preloadTables","loaders","oc","pk","tk","lg","summary","setTheme","theme","start","options","deckName","opponentName","seed","createLCG","flow","GameFlow","quarter","clock","diff","playerDeck","name","aiDeck","initial","ko","stateAfterKO","cardsToRender","defCards","tendencies","translate","events","ev","deps","d","pcPlayer","PlayCaller","pcAI","rt","cards","cardId","currentState","card","defPicked","before","res","defCard","offPicked","err","dispose","runtime","Kickoff","Punt","PlaceKicking","ResultParsing","Timekeeping","Charts","LongGain","PATDecision","CoachProfiles","params","resolvePlayCore","nextState","pendingPenalty","kind","chosen","fin","state","decision","context","conceding","type","kicking"],"ignoreList":[],"sources":["../../src/ai/PATDecision.ts","../../src/ai/policy/NFL2025Policy.ts","../../src/ai/tendencies/PlayerTendenciesMemory.ts","../../src/data/decks.ts","../../src/index.ts"],"sourcesContent":["import type { CoachProfile } from './CoachProfiles';\r\nimport type { RNG } from '../sim/RNG';\r\n\r\nexport interface PATContext {\r\n  diff: number; // player - ai after AI touchdown counted\r\n  quarter: number;\r\n  clock: number; // seconds\r\n  coach: CoachProfile;\r\n}\r\n\r\nexport function shouldGoForTwo(ctx: PATContext): boolean {\r\n  const late = ctx.quarter === 4 && ctx.clock <= 5 * 60;\r\n  // Go for two when trailing by 1 or 2\r\n  let go = (ctx.diff > 0 && ctx.diff <= 2);\r\n  // Aggressive coaches may go when leading by 1 very late (diff < 0 means AI leads)\r\n  if (ctx.coach.twoPointAggressiveLate && ctx.diff < 0 && ctx.diff === -1 && late) go = true;\r\n  return go;\r\n}\r\n\r\nexport function performPAT(ctx: PATContext, rng: RNG): { aiPoints: number } {\r\n  if (shouldGoForTwo(ctx)) {\r\n    const success = rng() < 0.5;\r\n    return { aiPoints: success ? 2 : 0 };\r\n  }\r\n  // XP success heuristic aligned with legacy behavior; 98% success when abstracted\r\n  const success = rng() < 0.98;\r\n  return { aiPoints: success ? 1 : 0 };\r\n}\r\n","import type { GameState } from '../../domain/GameState';\n\nexport type TeamArchetype = 'Pro'|'Aerial'|'BallControl';\n\nexport interface PolicyInputs {\n  quarter: number; // 1..4\n  time_remaining_sec: number; // in current quarter\n  half: 1|2;\n  score_diff: number; // offense - defense\n  down: 1|2|3|4;\n  distance_to_go_yd: number;\n  yardline_100: number; // 1..99 from offense goal\n  has_two_minute_warning: boolean;\n  wind_mph?: number;\n  roof?: 'open'|'closed'|'retractable';\n  surface?: 'grass'|'turf';\n  kicker_make_table?: Array<{ max_yd: number; p_make: number }>;\n  team_archetype: TeamArchetype;\n  home_or_road: 'home'|'road';\n  underdog: boolean;\n  possession_after_score_pref: 'normal'|'want_OT';\n}\n\nexport interface FGEnvAdjust {\n  wind_head_per_10mph: number;\n  wind_tail_per_10mph: number;\n  altitude_high: number;\n  wet_surface: number;\n  elite_kicker_bonus: number;\n  weak_kicker_malus: number;\n}\n\nexport interface FGModelConfig {\n  baseline: Array<{ max_yd: number; p_make: number }>;\n  adjustments: FGEnvAdjust;\n}\n\nexport interface FGModel {\n  makeProb(attemptYards: number, ctx: { wind_mph?: number; roof?: string; surface?: string; kicker?: 'elite'|'weak'|'avg' }): number;\n}\n\nfunction pickBucketProb(ay: number, table: Array<{ max_yd: number; p_make: number }>): number {\n  for (const row of table) {\n    if (ay <= row.max_yd) return row.p_make;\n  }\n  return 0.0;\n}\n\nexport function createFGModel(cfg: FGModelConfig, overrides?: Array<{ max_yd: number; p_make: number }>): FGModel {\n  const table = overrides && overrides.length ? overrides : cfg.baseline;\n  return {\n    makeProb(attemptYards, ctx) {\n      let p = pickBucketProb(Math.round(attemptYards), table);\n      // Simple environment adjustments\n      const wind = Math.abs(ctx.wind_mph ?? 0);\n      const head = (ctx.wind_mph ?? 0) > 0 ? 1 : (ctx.wind_mph ?? 0) < 0 ? -1 : 0; // positive means headwind\n      if (head > 0) p += cfg.adjustments.wind_head_per_10mph * (wind / 10);\n      if (head < 0) p += cfg.adjustments.wind_tail_per_10mph * (wind / 10);\n      if (ctx.surface === 'grass') p += 0; // neutral default; could tune per JSON\n      // Kicker quality\n      const k = ctx.kicker ?? 'avg';\n      if (k === 'elite') p += cfg.adjustments.elite_kicker_bonus;\n      if (k === 'weak') p += cfg.adjustments.weak_kicker_malus;\n      return Math.max(0, Math.min(1, p));\n    },\n  };\n}\n\nexport type SpecialDecision = 'field_goal'|'punt'|'go_for_it'|'qb_kneel'|'spike'|'hail_mary'|'normal_play';\nexport type Tempo = 'normal'|'hurry_up'|'burn_clock'|'no_huddle';\n\nexport interface PolicyOutputs {\n  playcall_weights?: Record<string, number>;\n  tempo: Tempo;\n  special: SpecialDecision;\n  explanations: string[];\n}\n\nexport interface PolicyAPI {\n  chooseFourthDown(ctx: PolicyInputs & { fgModel: FGModel }): SpecialDecision;\n  choosePAT(ctx: { quarter: number; time_remaining_sec: number; score_diff: number }): 'kick'|'two';\n  chooseTempo(ctx: PolicyInputs): { tempo: Tempo };\n}\n\nexport function buildPolicy(): PolicyAPI {\n  // Constants from JSON\n  const fgConfig: FGModelConfig = {\n    baseline: [\n      { max_yd: 29, p_make: 0.97 },\n      { max_yd: 39, p_make: 0.92 },\n      { max_yd: 49, p_make: 0.82 },\n      { max_yd: 55, p_make: 0.68 },\n      { max_yd: 60, p_make: 0.50 },\n      { max_yd: 66, p_make: 0.32 },\n    ],\n    adjustments: {\n      wind_head_per_10mph: -0.05,\n      wind_tail_per_10mph: +0.03,\n      altitude_high: +0.03,\n      wet_surface: -0.03,\n      elite_kicker_bonus: +0.04,\n      weak_kicker_malus: -0.04,\n    },\n  };\n\n  const fgModel = createFGModel(fgConfig);\n\n  function chooseFourthDown(ctx: PolicyInputs & { fgModel?: FGModel }): SpecialDecision {\n    const fg = ctx.fgModel || fgModel;\n    // Quick field zones\n    const yl = ctx.yardline_100;\n    const toGo = ctx.distance_to_go_yd;\n    // NFL-style thresholds per JSON matrices (simplified)\n    // Compute kick distance\n    const kickDistance = (100 - yl) + 17;\n    const pMake = fg.makeProb(kickDistance, {} as any);\n\n    // Basic neutral early matrix\n    const early = (ctx.quarter === 1 || (ctx.quarter === 2 && ctx.time_remaining_sec > 300) || (ctx.quarter === 3 && ctx.time_remaining_sec > 300));\n    const late = (ctx.quarter === 2 || ctx.quarter === 4) && ctx.time_remaining_sec <= 300;\n    const twoMin = ctx.time_remaining_sec <= 120;\n    const trailing = ctx.score_diff < 0;\n\n    if (early) {\n      if (yl <= 40) {\n        if (toGo <= 1) return 'punt';\n        if (toGo <= 2 && yl >= 35) return pMake >= 0.75 ? 'field_goal' : 'punt';\n        return 'punt';\n      }\n      if (yl >= 41 && yl <= 59) {\n        if (toGo <= 2) return 'go_for_it';\n        if (toGo <= 4) return 'go_for_it'; // consider_go → go_for_it in simplified model\n        return 'punt';\n      }\n      if (yl >= 60 && yl <= 69) {\n        if (toGo <= 2) return 'go_for_it';\n        if (toGo <= 5) return 'go_for_it';\n        return pMake >= 0.75 ? 'field_goal' : 'punt';\n      }\n      if (yl >= 70) {\n        if (toGo <= 2) return 'go_for_it';\n        if (toGo <= 5) return 'go_for_it';\n        return pMake >= 0.7 ? 'field_goal' : (pMake >= 0.5 ? 'field_goal' : 'go_for_it');\n      }\n    }\n\n    if (late && trailing) {\n      if (yl >= 50 && toGo <= 5) return 'go_for_it';\n      if (yl >= 60 && toGo <= 7) return 'go_for_it';\n      if (yl >= 70 && toGo <= 10) return 'go_for_it';\n      if (yl < 40 && twoMin && toGo <= 2) return 'go_for_it';\n    }\n\n    if (late && !trailing) {\n      if (yl >= 80 && toGo <= 1) return 'go_for_it';\n      if (yl >= 57 && (ctx.down >= 2 || ctx.time_remaining_sec <= 30)) return pMake >= 0.55 ? 'field_goal' : 'punt';\n      return pMake >= 0.62 && yl >= 60 ? 'field_goal' : 'punt';\n    }\n\n    // Default punt rule\n    if (yl <= 59) return 'punt';\n    // Fringe\n    return pMake >= 0.62 ? 'field_goal' : (toGo <= 2 ? 'go_for_it' : 'punt');\n  }\n\n  function choosePAT(ctx: { quarter: number; time_remaining_sec: number; score_diff: number }): 'kick'|'two' {\n    if (ctx.quarter < 4 || ctx.time_remaining_sec > 300) {\n      // Kick unless trailing big\n      if (ctx.score_diff <= -9) return 'two';\n      return 'kick';\n    }\n    if (ctx.score_diff === -8) return 'two';\n    if (ctx.score_diff === -5) return 'kick';\n    if (ctx.score_diff === -4) return 'two';\n    return 'kick';\n  }\n\n  function chooseTempo(ctx: PolicyInputs): { tempo: Tempo } {\n    const trailing = ctx.score_diff < 0;\n    const lead9 = ctx.score_diff >= 9;\n    const late = (ctx.quarter === 2 || ctx.quarter === 4) && ctx.time_remaining_sec <= 300;\n    const twoMin = ctx.time_remaining_sec <= 120;\n    if ((late || twoMin) && trailing) return { tempo: 'hurry_up' };\n    if ((late || twoMin) && lead9) return { tempo: 'burn_clock' };\n    return { tempo: 'normal' };\n  }\n\n  return { chooseFourthDown, choosePAT, chooseTempo };\n}\n\n// Helpers to convert engine GameState to PolicyInputs for offense side\nexport function toPolicyInputsFromState(st: GameState, offenseIsHome: boolean): PolicyInputs {\n  const offenseIsPlayer = st.possession === 'player';\n  const offenseScore = st.score[offenseIsPlayer ? 'player' : 'ai'];\n  const defenseScore = st.score[offenseIsPlayer ? 'ai' : 'player'];\n  const score_diff = offenseScore - defenseScore;\n  const quarter = st.quarter;\n  const time_remaining_sec = st.clock;\n  const half: 1|2 = quarter <= 2 ? 1 : 2;\n  const down = st.down as 1|2|3|4;\n  const distance_to_go_yd = st.toGo;\n  const yardline_from_home = st.ballOn;\n  const yardline_100 = offenseIsHome ? yardline_from_home : (100 - yardline_from_home);\n  const has_two_minute_warning = (quarter === 2 || quarter === 4) && time_remaining_sec > 0 && time_remaining_sec > 120;\n  return {\n    quarter,\n    time_remaining_sec,\n    half,\n    score_diff,\n    down,\n    distance_to_go_yd,\n    yardline_100,\n    has_two_minute_warning,\n    team_archetype: 'Pro',\n    home_or_road: offenseIsHome ? 'home' : 'road',\n    underdog: false,\n    possession_after_score_pref: 'normal',\n  };\n}\n\n\n","// Move utility functions here to break circular dependency\r\nfunction clamp(n: number, min: number, max: number): number {\r\n  return Math.max(min, Math.min(max, n));\r\n}\r\n\r\nfunction isRedZone(ballOnFromHome: number, playerIsHome: boolean, possession: 'player'|'ai'): boolean {\r\n  const offenseIsHomeFlag = (possession === 'player') === playerIsHome;\r\n  const yardsToOppGoal = offenseIsHomeFlag ? (100 - ballOnFromHome) : ballOnFromHome;\r\n  return yardsToOppGoal < 20;\r\n}\r\n\r\nexport type TendencyDistanceBucket = 'short'|'medium'|'long';\r\n\r\nfunction toDistanceBucket(toGo: number): TendencyDistanceBucket {\r\n\tif (toGo <= 2) return 'short';\r\n\tif (toGo >= 8) return 'long';\r\n\treturn 'medium';\r\n}\r\n\r\nfunction keyForSituation(down: number, dist: TendencyDistanceBucket, inRedZone: boolean): string {\r\n\tconst d = Math.max(1, Math.min(4, down));\r\n\treturn `${d}:${dist}:${inRedZone ? 'RZ' : 'FG'}`;\r\n}\r\n\r\nexport class PlayerTendenciesMemory {\r\n\tprivate countsByKey: Record<string, { run: number; pass: number }> = Object.create(null);\r\n\tprivate global: { run: number; pass: number } = { run: 0, pass: 0 };\r\n\r\n\trecord(side: 'player'|'ai', playType: 'run'|'pass', ctx: { down: number; toGo: number; ballOnFromHome: number; playerIsHome: boolean; possessing: 'player'|'ai' }): void {\r\n\t\t// Only learn the HUMAN player's offense tendencies\r\n\t\tif (side !== 'player' || ctx.possessing !== 'player') return;\r\n\t\tconst inRed = isRedZone(ctx.ballOnFromHome, ctx.playerIsHome, ctx.possessing);\r\n\t\tconst k = keyForSituation(ctx.down, toDistanceBucket(ctx.toGo), inRed);\r\n\t\tif (!this.countsByKey[k]) this.countsByKey[k] = { run: 0, pass: 0 };\r\n\t\tthis.countsByKey[k]![playType] += 1;\r\n\t\tthis.global[playType] += 1;\r\n\t}\r\n\r\n\t// Predict run probability for the player's next play without peeking current selection\r\n\tpredictRunProbabilityForPlayer(input: { down: number; toGo: number; ballOnFromHome: number; playerIsHome: boolean }): number {\r\n\t\tconst inRed = isRedZone(input.ballOnFromHome, input.playerIsHome, 'player');\r\n\t\tconst k = keyForSituation(input.down, toDistanceBucket(input.toGo), inRed);\r\n\t\tconst counts = this.countsByKey[k] || { run: 0, pass: 0 };\r\n\t\tconst g = this.global;\r\n\t\t// Laplace smoothing with small prior; blend bucket with global if sparse\r\n\t\tconst bucketN = counts.run + counts.pass;\r\n\t\tconst globalN = g.run + g.pass;\r\n\t\tconst bucketRun = (counts.run + 1) / (bucketN + 2);\r\n\t\tconst globalRun = globalN > 0 ? (g.run / globalN) : 0.5;\r\n\t\tconst w = Math.max(0, Math.min(1, bucketN / 6)); // need about 6 samples to fully trust bucket\r\n\t\treturn clamp(bucketRun * w + globalRun * (1 - w), 0.1, 0.9);\r\n\t}\r\n}\r\n\r\nexport type PlayerTendenciesMemoryConstructor = typeof PlayerTendenciesMemory;\r\n\r\n\r\n","export type DeckName = 'Pro Style'|'Ball Control'|'Aerial Style';\r\nexport type CardType = 'run'|'pass'|'punt'|'field-goal';\r\n\r\nexport interface OffenseCardDef {\r\n\tid: string;\r\n\tdeck: DeckName;\r\n\tlabel: string;\r\n\ttype: CardType;\r\n\tart: string;\r\n}\r\n\r\nexport interface DefenseCardDef {\r\n\tid: string;\r\n\tlabel:\r\n\t\t| 'Goal Line'|'Short Yardage'|'Inside Blitz'|'Running'|'Run & Pass'\r\n\t\t| 'Pass & Run'|'Passing'|'Outside Blitz'|'Prevent'|'Prevent Deep';\r\n}\r\n\r\nconst LABEL_TO_CHART_KEY_LOCAL: Record<string, string> = {\r\n\t'Sideline Pass': 'Side Line Pass',\r\n\t'Run & Pass Option': 'Run/Pass Option',\r\n};\r\n\r\nconst OFFENSE_BASE_LABELS: readonly string[] = [\r\n\t'Power Up Middle',\r\n\t'Power Off Tackle',\r\n\t'QB Keeper',\r\n\t'Slant Run',\r\n\t'End Run',\r\n\t'Reverse',\r\n\t'Draw',\r\n\t'Trap',\r\n\t'Run & Pass Option',\r\n\t'Flair Pass',\r\n\t'Sideline Pass',\r\n\t'Look In Pass',\r\n\t'Screen Pass',\r\n\t'Pop Pass',\r\n\t'Button Hook Pass',\r\n\t'Razzle Dazzle',\r\n\t'Down & Out Pass',\r\n\t'Down & In Pass',\r\n\t'Long Bomb',\r\n\t'Stop & Go Pass',\r\n] as const;\r\n\r\nfunction makeCardId(deck: DeckName, label: string): string {\r\n\tconst deckKey = deck.replace(/\\s+/g, '_');\r\n\tconst labelKey = label\r\n\t\t.replace(/\\s+/g, '')\r\n\t\t.replace(/[()&]/g, '')\r\n\t\t.replace(/\\/+/, '');\r\n\treturn `${deckKey}_${labelKey}`;\r\n}\r\n\r\nfunction makeArtPath(deck: DeckName, label: string): string {\r\n\treturn `assets/cards/${deck}/${label}.jpg`;\r\n}\r\n\r\nfunction inferTypeFromLabel(label: string): CardType {\r\n\tif (label.startsWith('Punt')) return 'punt';\r\n\tconst lowered = label.toLowerCase();\r\n\tif (lowered.includes('pass')) return 'pass';\r\n\tif (['Run & Pass Option'].includes(label)) return 'run';\r\n\treturn 'run';\r\n}\r\n\r\nfunction buildOffenseDeck(deck: DeckName): OffenseCardDef[] {\r\n\t// Base 20 offense plays\r\n\tconst base: OffenseCardDef[] = OFFENSE_BASE_LABELS.map((label) => ({\r\n\t\tid: makeCardId(deck, label),\r\n\t\tdeck,\r\n\t\tlabel,\r\n\t\ttype: inferTypeFromLabel(label),\r\n\t\tart: makeArtPath(deck, label),\r\n\t}));\r\n\t// Include one 4th-down-only punt card per deck\r\n\tconst puntLabel = 'Punt (4th Down Only)';\r\n\tconst punt: OffenseCardDef = {\r\n\t\tid: makeCardId(deck, puntLabel),\r\n\t\tdeck,\r\n\t\tlabel: puntLabel,\r\n\t\ttype: 'punt',\r\n\t\tart: makeArtPath(deck, puntLabel),\r\n\t};\r\n\t// Exclude Field Goal from deck (handled by controls elsewhere)\r\n\t// Ensure final count is exactly 20 by removing one duplicate-type label if needed\r\n\t// The base list already has 20. Replace one low-importance card with Punt to keep 20.\r\n\tconst filtered = base.filter((c) => c.label !== 'Trap');\r\n\treturn [...filtered, punt];\r\n}\r\n\r\nexport const OFFENSE_DECKS: Record<DeckName, OffenseCardDef[]> = {\r\n\t'Pro Style': buildOffenseDeck('Pro Style'),\r\n\t'Ball Control': buildOffenseDeck('Ball Control'),\r\n\t'Aerial Style': buildOffenseDeck('Aerial Style'),\r\n};\r\n\r\nexport const DEFENSE_DECK: DefenseCardDef[] = [\r\n\t{ id: 'Defense_GoalLine', label: 'Goal Line' },\r\n\t{ id: 'Defense_ShortYardage', label: 'Short Yardage' },\r\n\t{ id: 'Defense_InsideBlitz', label: 'Inside Blitz' },\r\n\t{ id: 'Defense_Running', label: 'Running' },\r\n\t{ id: 'Defense_RunAndPass', label: 'Run & Pass' },\r\n\t{ id: 'Defense_PassAndRun', label: 'Pass & Run' },\r\n\t{ id: 'Defense_Passing', label: 'Passing' },\r\n\t{ id: 'Defense_OutsideBlitz', label: 'Outside Blitz' },\r\n\t{ id: 'Defense_Prevent', label: 'Prevent' },\r\n\t{ id: 'Defense_PreventDeep', label: 'Prevent Deep' },\r\n];\r\n\r\n// White-sign (goal-line) restrictions; populate known restricted plays\r\n// Keyed by play label, value is max distance (yards to opponent goal) where play is restricted\r\nexport const WHITE_SIGN_RESTRICTIONS: Record<string, number> = {\r\n\t// Example restrictions; tune when canonical list available\r\n\t'Long Bomb': 5,\r\n\t'Run & Pass Option': 2,\r\n\t'Razzle Dazzle': 5,\r\n\t'Stop & Go Pass': 5,\r\n};\r\n\r\n// Utility for tests: ensure labels align via LABEL_TO_CHART_KEY elsewhere\r\nexport const __LABEL_MAP = LABEL_TO_CHART_KEY_LOCAL;\r\n","// Bootstrap: expose extracted modules for gradual integration\nimport * as Kickoff from './rules/special/Kickoff';\nimport * as Punt from './rules/special/Punt';\nimport * as PlaceKicking from './rules/special/PlaceKicking';\nimport * as ResultParsing from './rules/ResultParsing';\nimport * as Timekeeping from './rules/Timekeeping';\nimport * as Charts from './rules/Charts';\nimport * as LongGain from './rules/LongGain';\nimport * as PATDecision from './ai/PATDecision';\nimport * as CoachProfiles from './ai/CoachProfiles';\nimport { PlayerTendenciesMemory } from './ai/Playcall';\nimport { PlayCaller } from './ai/PlayCaller';\nimport { resolvePlayCore } from './rules/ResolvePlayCore';\nimport type { ResolveInput as CoreResolveInput } from './rules/ResolvePlayCore';\nimport { EventBus } from './utils/EventBus';\nimport type { GameRuntime, TablesState } from './runtime/types';\nimport { GameFlow, type FlowEvent, type PlayInput } from './flow/GameFlow';\nimport { buildPolicy } from './ai/policy/NFL2025Policy';\nimport { createLCG } from './sim/RNG';\n// import { validateOffensePlay, canAttemptFieldGoal } from './rules/PlayValidation';\nimport { OFFENSE_DECKS, DEFENSE_DECK, WHITE_SIGN_RESTRICTIONS } from './data/decks';\nimport type { DeckName } from './data/decks';\n\nlet uiRegistered = false;\nconst bus = new EventBus();\nlet tables: TablesState = { offenseCharts: null, placeKicking: null, timeKeeping: null, longGain: null };\nlet progressiveEnhancement: any = null;\n\nasync function ensureUIRegistered(): Promise<void> {\n  console.log('ensureUIRegistered called, uiRegistered:', uiRegistered);\n  if (uiRegistered) return;\n\n  console.log('Starting UI registration...');\n  // Show initial loading state\n  showInitialLoading();\n\n  try {\n    // Import error boundary and fallback components first (critical for error handling)\n    const { ErrorBoundary } = await import('./ui/ErrorBoundary');\n    const {\n      createFallbackHUD,\n      createFallbackLog,\n      createFallbackField,\n      createFallbackHand,\n      createFallbackControls,\n      createGenericFallback,\n      createLoadingSpinner\n    } = await import('./ui/fallbacks/FallbackComponents');\n\n    // Register core UI components first (critical for basic functionality)\n    await registerCoreUI(ErrorBoundary, createFallbackHUD, createFallbackLog, createFallbackField, createFallbackHand, createFallbackControls, createLoadingSpinner);\n\n    // Register interactive UI components with lazy loading\n    await registerInteractiveUI(ErrorBoundary, createFallbackHand, createFallbackControls, createGenericFallback);\n\n    // Register optional UI components (non-critical features)\n    await registerOptionalUI();\n\n    uiRegistered = true;\n    hideLoadingSpinner();\n\n    // Emit ready event for progressive enhancement\n    (bus as any).emit('ui:ready', {});\n\n  } catch (error) {\n    console.error('Failed to register UI components:', error);\n    // Import createLoadingSpinner for error fallback\n    import('./ui/fallbacks/FallbackComponents').then(({ createLoadingSpinner }) => {\n      showCriticalError(createLoadingSpinner);\n    }).catch(() => {\n      // Ultimate fallback - just show an alert\n      if (typeof document !== 'undefined') {\n        const errorDiv = document.createElement('div');\n        errorDiv.textContent = 'Critical error - please refresh the page';\n        errorDiv.style.cssText = 'position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:red;color:white;padding:20px;border-radius:8px;';\n        document.body.appendChild(errorDiv);\n      }\n    });\n  }\n}\n\n/**\n * Shows initial loading state while UI components are being registered\n */\nfunction showInitialLoading(): void {\n  if (typeof document === 'undefined') return;\n\n  const loadingElement = document.createElement('div');\n  loadingElement.id = 'initial-loading';\n  loadingElement.style.cssText = `\n    position: fixed;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background: rgba(0, 0, 0, 0.8);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    z-index: 9999;\n    color: white;\n    font-family: Arial, sans-serif;\n    flex-direction: column;\n  `;\n\n  const spinner = document.createElement('div');\n  spinner.style.cssText = `\n    width: 40px;\n    height: 40px;\n    border: 4px solid #333;\n    border-top: 4px solid #007bff;\n    border-radius: 50%;\n    animation: spin 1s linear infinite;\n    margin-bottom: 16px;\n  `;\n\n  const text = document.createElement('div');\n  text.textContent = 'Loading Gridiron Strategy...';\n\n  loadingElement.appendChild(spinner);\n  loadingElement.appendChild(text);\n\n  // Add CSS animation if not already present\n  if (!document.getElementById('initial-loading-styles')) {\n    const style = document.createElement('style');\n    style.id = 'initial-loading-styles';\n    style.textContent = `\n      @keyframes spin {\n        0% { transform: rotate(0deg); }\n        100% { transform: rotate(360deg); }\n      }\n    `;\n    document.head.appendChild(style);\n  }\n\n  document.body.appendChild(loadingElement);\n}\n\n/**\n * Hides the initial loading spinner\n */\nfunction hideLoadingSpinner(): void {\n  if (typeof document === 'undefined') return;\n\n  const loadingElement = document.getElementById('initial-loading');\n  if (loadingElement) {\n    loadingElement.remove();\n  }\n}\n\n/**\n * Shows critical error fallback\n */\nfunction showCriticalError(createLoadingSpinner: (message: string) => HTMLElement): void {\n  if (typeof document === 'undefined') return;\n\n  hideLoadingSpinner();\n  const errorElement = createLoadingSpinner('Critical error - please refresh the page');\n  document.body.appendChild(errorElement);\n}\n\n/**\n * Registers core UI components that are essential for basic functionality\n */\nasync function registerCoreUI(\n  ErrorBoundary: any,\n  createFallbackHUD: () => HTMLElement,\n  createFallbackLog: () => HTMLElement,\n  createFallbackField: () => HTMLElement,\n  createFallbackHand: () => HTMLElement,\n  createFallbackControls: () => HTMLElement,\n  createLoadingSpinner: (message: string) => HTMLElement\n): Promise<void> {\n  // Core components loaded immediately for critical functionality\n  const coreComponents = [\n    { module: './ui/HUD', register: 'registerHUD', name: 'HUD', fallback: createFallbackHUD },\n    { module: './ui/Log', register: 'registerLog', name: 'GameLog', fallback: createFallbackLog },\n    { module: './ui/Field', register: 'registerField', name: 'GameField', fallback: createFallbackField },\n    { module: './ui/Controls', register: 'registerControls', name: 'GameControls', fallback: createFallbackControls },\n    { module: './ui/Hand', register: 'registerHand', name: 'PlayerHand', fallback: createFallbackHand }\n  ];\n\n  console.log('Starting core UI component registration...');\n  for (const component of coreComponents) {\n    console.log(`Loading ${component.name} component from ${component.module}...`);\n    try {\n      const module = await import(component.module);\n      console.log(`${component.name} module loaded successfully`);\n\n      // For critical core components, only use basic error handling\n      // Don't use aggressive error boundaries that might hide real issues\n      const originalRegister = module[component.register];\n      module[component.register] = (bus: EventBus) => {\n        try {\n          console.log(`Calling ${component.name} register function...`);\n          return originalRegister.call(module, bus);\n        } catch (error) {\n          console.error(`${component.name} component registration failed:`, error);\n          bus.emit('log', { message: `${component.name} component failed to initialize` });\n          return undefined;\n        }\n      };\n\n      console.log(`Registering ${component.name}...`);\n      module[component.register](bus);\n      console.log(`${component.name} registered successfully`);\n    } catch (error) {\n      console.error(`${component.name} module failed to load:`, error);\n      // For critical components, show a simple error message but don't use fallback UI\n      // as that might mask the real issue\n      if (typeof document !== 'undefined') {\n        const errorDiv = document.createElement('div');\n        errorDiv.style.cssText = `\n          position: fixed;\n          top: 10px;\n          right: 10px;\n          background: #ff4444;\n          color: white;\n          padding: 10px;\n          border-radius: 4px;\n          z-index: 9999;\n          font-family: monospace;\n          font-size: 12px;\n        `;\n        errorDiv.textContent = `${component.name} failed to load - check console`;\n        document.body.appendChild(errorDiv);\n      }\n    }\n  }\n}\n\n/**\n * Registers interactive UI components with lazy loading\n */\nasync function registerInteractiveUI(\n  ErrorBoundary: any,\n  createFallbackHand: () => HTMLElement,\n  createFallbackControls: () => HTMLElement,\n  createGenericFallback: (componentName: string, error?: Error) => HTMLElement\n): Promise<void> {\n  // Interactive components loaded when user interaction begins\n  const interactiveComponents: Array<{\n    module: string;\n    register: string;\n    name: string;\n    fallback: () => HTMLElement;\n  }> = [\n    // No interactive components for now - all critical UI is in core\n  ];\n\n  // Use requestIdleCallback if available, otherwise setTimeout\n  const scheduleWork = (callback: () => void) => {\n    if ('requestIdleCallback' in window) {\n      requestIdleCallback(callback, { timeout: 2000 });\n    } else {\n      setTimeout(callback, 100);\n    }\n  };\n\n  for (const component of interactiveComponents) {\n    scheduleWork(async () => {\n      try {\n        const module = await import(component.module);\n        const boundary = new ErrorBoundary({\n          componentName: component.name,\n          fallbackComponent: (error: Error, retry: () => void) => component.fallback(),\n          onError: (error: Error, info: any) => {\n            console.error(`${component.name} component error:`, error);\n            bus.emit('log', { message: `${component.name} component failed - using fallback display` });\n          }\n        });\n\n        const originalRegister = module[component.register];\n        module[component.register] = (bus: EventBus) => {\n          try {\n            return originalRegister.call(module, bus);\n          } catch (error) {\n            boundary.handleError(error as Error);\n            return undefined;\n          }\n        };\n\n        module[component.register](bus);\n      } catch (error) {\n        console.warn(`${component.name} module failed to load:`, error);\n        const element = component.fallback();\n        if (typeof document !== 'undefined') {\n          const container = document.getElementById(component.name.toLowerCase()) || document.createElement('div');\n          container.id = component.name.toLowerCase();\n          container.appendChild(element);\n          document.body.appendChild(container);\n        }\n      }\n    });\n  }\n}\n\n/**\n * Registers optional UI components (non-critical features)\n */\nasync function registerOptionalUI(): Promise<void> {\n  // Optional components loaded asynchronously with lower priority\n  const optionalComponents = [\n    './ui/DevMode',\n    './ui/SpecialTeamsUI',\n    './ui/PenaltyUI',\n    './ui/VFX',\n    './ui/SFX',\n    './qa/Harness'\n  ];\n\n  // Load optional components in background\n  optionalComponents.forEach(async (modulePath) => {\n    try {\n      const module = await import(modulePath);\n      // Extract register function name from module path\n      const registerName = modulePath.split('/').pop()?.replace(/([A-Z])/g, '_$1').toLowerCase().slice(1) || '';\n      if (module[`register${registerName.charAt(0).toUpperCase() + registerName.slice(1)}`]) {\n        const registerFn = module[`register${registerName.charAt(0).toUpperCase() + registerName.slice(1)}`];\n        registerFn(bus);\n      }\n    } catch (error) {\n      console.warn(`${modulePath} component failed to load:`, error);\n    }\n  });\n}\n\n/**\n * Initializes progressive enhancement features\n */\nasync function initializeProgressiveEnhancement(): Promise<void> {\n  try {\n    const { ProgressiveEnhancement } = await import('./ui/progressive/ProgressiveEnhancement');\n    progressiveEnhancement = new ProgressiveEnhancement(bus, {\n      enableWebGL: true,\n      enableWebAudio: true,\n      enableOfflineSupport: true,\n      enableAdvancedAnimations: true,\n      enablePerformanceMonitoring: true\n    });\n\n    // Listen for feature detection results\n    (bus as any).on('features:detected', ({ features }: any) => {\n      console.log('Browser features detected:', features);\n\n      // Log enhancement status to game log\n      if (features.webgl) {\n        bus.emit('log', { message: 'Enhanced graphics enabled' });\n      }\n      if (features.webAudio) {\n        bus.emit('log', { message: 'Enhanced audio enabled' });\n      }\n      if (features.serviceWorker) {\n        bus.emit('log', { message: 'Offline support available' });\n      }\n    });\n\n    // Listen for performance metrics\n    (bus as any).on('performance:loadTime', ({ loadTime }: any) => {\n      console.log(`UI loaded in ${Math.round(loadTime)}ms`);\n      bus.emit('log', { message: `UI loaded in ${Math.round(loadTime)}ms` });\n    });\n\n    (bus as any).on('performance:fps', ({ fps }: any) => {\n      if (fps < 30) {\n        console.warn(`Low frame rate detected: ${fps}fps`);\n        bus.emit('log', { message: `Performance: ${fps}fps` });\n      }\n    });\n\n  } catch (error) {\n    console.warn('Progressive enhancement failed to initialize:', error);\n    // Continue without progressive enhancement - basic functionality still works\n  }\n}\n\nasync function preloadTables(): Promise<void> {\n  try {\n    const loaders = await import('./data/loaders/tables');\n    const [oc, pk, tk, lg] = await Promise.all([\n      loaders.fetchOffenseCharts(),\n      loaders.fetchPlaceKicking(),\n      loaders.fetchTimeKeeping(),\n      loaders.fetchLongGain(),\n    ]);\n    tables = {\n      offenseCharts: oc.ok ? oc.data : null,\n      placeKicking: pk.ok ? pk.data : null,\n      timeKeeping: tk.ok ? tk.data : null,\n      longGain: lg.ok ? lg.data : null,\n    };\n    const summary = `Loaded offense charts ${oc.ok ? '✓' : `✕ (${oc.error.code})`}, place-kicking ${pk.ok ? '✓' : `✕ (${pk.error.code})`}, timekeeping ${tk.ok ? '✓' : `✕ (${tk.error.code})`}, long-gain ${lg.ok ? '✓' : `✕ (${lg.error.code})`}`;\n    bus.emit('log', { message: summary });\n  } catch {\n    tables = { offenseCharts: null, placeKicking: null, timeKeeping: null, longGain: null };\n  }\n  if (typeof window !== 'undefined' && window.GS) {\n    window.GS.tables = tables;\n  }\n}\n\nfunction setTheme(theme: string): void {\n  if (typeof document === 'undefined') return;\n  (document.body as any).dataset.theme = theme;\n}\n\n// Bridge UI theme change events to body dataset\nbus.on('ui:themeChanged', ({ theme }: any) => {\n  try { setTheme(theme); } catch {}\n});\n\nasync function start(options?: { theme?: 'arcade'|'minimalist'|'retro'|'board'|'vintage'|'modern' }): Promise<void> {\n  if (typeof window === 'undefined') return;\n\n  // Initialize progressive enhancement first\n  await initializeProgressiveEnhancement();\n\n  await ensureUIRegistered();\n  if (options && options.theme) setTheme(options.theme);\n  await preloadTables();\n  // Emit a baseline HUD update so UI is not blank in smoke tests\n  bus.emit('hudUpdate', {\n    quarter: 1,\n    clock: 15 * 60,\n    down: 1,\n    toGo: 10,\n    ballOn: 25,\n    possession: 'player',\n    score: { player: 0, ai: 0 },\n  } as any);\n\n  // Hook up New Game UI event to start a playable flow\n  try {\n    bus.on('ui:newGame', async ({ deckName, opponentName }: any) => {\n      try {\n        if (!tables.offenseCharts) {\n          bus.emit('log', { message: 'Data tables not loaded yet.' });\n          return;\n        }\n        const seed = Math.floor(Math.random() * 1e9);\n        const rng = createLCG(seed);\n        const flow = new GameFlow({ charts: tables.offenseCharts, rng, timeKeeping: tables.timeKeeping || {\n          gain0to20: 30,\n          gain20plus: 45,\n          loss: 30,\n          outOfBounds: 15,\n          incomplete: 15,\n          interception: 30,\n          penalty: 15,\n          fumble: 15,\n          kickoff: 15,\n          fieldgoal: 15,\n          punt: 15,\n          extraPoint: 0,\n        }, policy: {\n          chooseTempo: ({ quarter, clock, diff, side }) => {\n            try { return buildPolicy().chooseTempo({\n              quarter,\n              time_remaining_sec: clock,\n              half: quarter <= 2 ? 1 : 2,\n              score_diff: diff,\n              down: 1,\n              distance_to_go_yd: 10,\n              yardline_100: 25,\n              has_two_minute_warning: (quarter === 2 || quarter === 4) && clock > 120,\n              team_archetype: 'Pro',\n              home_or_road: side === 'player' ? 'home' : 'road',\n              underdog: false,\n              possession_after_score_pref: 'normal',\n            }).tempo as any; } catch { return 'normal'; }\n          },\n        } });\n        // Pick player deck from selection with fallback\n        const validDeck = (name: any): DeckName => (name === 'Pro Style' || name === 'Ball Control' || name === 'Aerial Style') ? name : 'Pro Style';\n        const playerDeck = validDeck(deckName);\n        // Map opponent to an AI deck style\n        let aiDeck: DeckName = 'Pro Style';\n        if (opponentName === 'Andy Reid') aiDeck = 'Aerial Style';\n        else if (opponentName === 'Bill Belichick') aiDeck = 'Ball Control';\n        else if (opponentName === 'John Madden') aiDeck = 'Pro Style';\n\n        // Initial state at kickoff\n        const initial: import('./domain/GameState').GameState = {\n          seed,\n          quarter: 1,\n          clock: 15 * 60,\n          down: 1,\n          toGo: 10,\n          ballOn: 25,\n          possession: 'ai', // AI kicks to Player by default\n          awaitingPAT: false,\n          gameOver: false,\n          score: { player: 0, ai: 0 },\n        } as const;\n\n        // Kickoff from AI to Player to start game\n        const ko = flow.performKickoff(initial, 'normal', 'ai');\n        const stateAfterKO = ko.state as any;\n        // Announce new game and push kickoff events now (translate declared below)\n        bus.emit('log', { message: `New game started — You: ${playerDeck} vs ${String(opponentName || 'AI')} (seed=${seed})` });\n\n        // Emit HUD from kickoff result (already included in events, but ensure baseline)\n        bus.emit('hudUpdate', {\n          quarter: stateAfterKO.quarter,\n          clock: stateAfterKO.clock,\n          down: stateAfterKO.down,\n          toGo: stateAfterKO.toGo,\n          ballOn: stateAfterKO.ballOn,\n          possession: stateAfterKO.possession,\n          score: stateAfterKO.score,\n        } as any);\n\n        // Deal hand immediately based on possession after kickoff\n        if (stateAfterKO.possession === 'player') {\n          const deck = OFFENSE_DECKS[playerDeck] || [];\n          const cardsToRender = deck.map((c) => ({ id: c.id, label: c.label, art: c.art, type: c.type }));\n          bus.emit('handUpdate', { cards: cardsToRender, isPlayerOffense: true } as any);\n        } else {\n          const defCards = DEFENSE_DECK.map((d) => ({ id: (d as any).id, label: (d as any).label, art: `assets/cards/Defense/${(d as any).label}.jpg`, type: 'defense' }));\n          bus.emit('handUpdate', { cards: defCards, isPlayerOffense: false } as any);\n        }\n\n        // Store minimal runtime pointers for potential future interactions\n        (window as any).GS_RUNTIME = { flow, playerDeck, aiDeck, state: stateAfterKO, seed };\n\n        // Per-game player tendencies memory for adaptive AI defense\n        const tendencies = new PlayerTendenciesMemory();\n\n        // Helper: translate flow events into UI bus\n        const translate = (events: FlowEvent[]) => {\n          for (const ev of events) {\n            if (ev.type === 'hud') bus.emit('hudUpdate', ev.payload as any);\n            else if (ev.type === 'log') bus.emit('log', { message: ev.message });\n            else if (ev.type === 'vfx') bus.emit('vfx', { type: ev.payload.kind, payload: ev.payload.data });\n            else if (ev.type === 'final') bus.emit('log', { message: `Final — HOME ${ev.payload.score.player} — AWAY ${ev.payload.score.ai}` });\n            else if (ev.type === 'halftime') bus.emit('log', { message: 'Halftime' });\n            else if (ev.type === 'endOfQuarter') bus.emit('log', { message: `End of Q${ev.payload.quarter}` });\n            else if (ev.type === 'score') bus.emit('log', { message: `Score: ${ev.payload.kind}` });\n          }\n        };\n\n        // Emit kickoff events now that translator is ready\n        try { translate(ko.events as any); } catch {}\n\n        // Prepare new PlayCaller instances for human vs AI flow\n        const deps = {\n          charts: tables.offenseCharts!,\n          getOffenseHand: () => {\n            const deck = OFFENSE_DECKS[playerDeck] || [];\n            return deck.map((c: any) => ({ id: c.id, label: c.label, type: c.type } as any));\n          },\n          getDefenseOptions: () => DEFENSE_DECK.map(d => d.label) as any,\n          getWhiteSignRestriction: (label: string) => (WHITE_SIGN_RESTRICTIONS as any)[label] ?? null,\n        } as const;\n        const pcPlayer = new PlayCaller(deps as any, true);\n        const pcAI = new PlayCaller(deps as any, true);\n        try { await pcPlayer.loadPersonality(); await pcAI.loadPersonality(); } catch {}\n        pcPlayer.reset(seed);\n        pcAI.reset(seed + 1);\n\n        // Keep the hand UI in sync with possession by re-emitting handUpdate on HUD changes\n        // When AI has the ball, present defense calls for the human to choose\n        bus.on('hudUpdate', ({ possession }) => {\n          try {\n            const rt: any = (window as any).GS_RUNTIME || {};\n            if (possession === 'player') {\n              const deckDef = OFFENSE_DECKS[rt.playerDeck as DeckName] || [];\n              const cards = deckDef.map((c: any) => ({ id: c.id, label: c.label, art: c.art, type: c.type }));\n              bus.emit('handUpdate', { cards, isPlayerOffense: true } as any);\n            } else {\n              const defCards = DEFENSE_DECK.map((d) => ({ id: (d as any).id, label: (d as any).label, art: `assets/cards/Defense/${(d as any).label}.jpg`, type: 'defense' }));\n              bus.emit('handUpdate', { cards: defCards, isPlayerOffense: false } as any);\n            }\n          } catch {}\n        });\n\n        // Listen for player selection; if player has ball, it's an offense play; if AI has ball, selection is defense\n        bus.on('ui:playCard', ({ cardId }: { cardId: string }) => {\n          try {\n            const rt: any = (window as any).GS_RUNTIME || {};\n            const currentState = rt.state;\n            if (!currentState || currentState.gameOver) return;\n            if (currentState.possession === 'player') {\n              // Player offense: look up offense card from player's deck\n              const playerDeckDef = OFFENSE_DECKS[rt.playerDeck as DeckName] || [];\n              const card = playerDeckDef.find((c: any) => c.id === cardId);\n              if (!card) return;\n              const defPicked = pcAI.choose_defense_play(currentState);\n              const input: PlayInput = { deckName: rt.playerDeck, playLabel: card.label, defenseLabel: defPicked.label } as any;\n              const before = { ...currentState };\n              const res = flow.resolveSnap(currentState, input);\n              translate(res.events);\n              (window as any).GS_RUNTIME.state = res.state as any;\n              try { pcPlayer.add_observation(before, card.label, defPicked.label); pcAI.add_observation(before, card.label, defPicked.label); pcPlayer.stepDecay(); pcAI.stepDecay(); } catch {}\n              try {\n                const playType: 'run'|'pass' = (/pass/i.test(card.label) ? 'pass' : 'run');\n                tendencies.record('player', playType, {\n                  down: before.down,\n                  toGo: before.toGo,\n                  ballOnFromHome: before.ballOn,\n                  playerIsHome: true,\n                  possessing: before.possession,\n                });\n              } catch {}\n            } else {\n              // AI offense: player's click selects a defense; AI picks offense via PlayCaller\n              const defCard = DEFENSE_DECK.find((d) => (d as any).id === cardId);\n              if (!defCard) return;\n              const offPicked = pcAI.choose_offense_play(currentState, rt.aiDeck as DeckName);\n              const input: PlayInput = { deckName: rt.aiDeck, playLabel: offPicked.playLabel, defenseLabel: (defCard as any).label } as any;\n              const before = { ...currentState };\n              const res = flow.resolveSnap(currentState, input);\n              translate(res.events);\n              (window as any).GS_RUNTIME.state = res.state as any;\n              try { pcPlayer.add_observation(before, offPicked.playLabel, (defCard as any).label); pcAI.add_observation(before, offPicked.playLabel, (defCard as any).label); pcPlayer.stepDecay(); pcAI.stepDecay(); } catch {}\n            }\n          } catch (err) {\n            try { bus.emit('log', { message: `Play selection failed: ${String((err as any)?.message || err)}` }); } catch {}\n          }\n        });\n      } catch (err) {\n        bus.emit('log', { message: `Failed to start new game: ${(err as Error)?.message || err}` });\n      }\n    });\n  } catch {}\n}\n\nfunction dispose(): void {\n  // No timers yet; leave bus listeners intact for now. Future timers/intervals cleared here.\n}\n\nconst runtime: GameRuntime = {\n  bus,\n  rules: { Kickoff, Punt, PlaceKicking, ResultParsing, Timekeeping, Charts, LongGain },\n  ai: { PATDecision, CoachProfiles },\n  tables,\n  start,\n  dispose,\n  setTheme,\n  runtime: {\n    resolvePlayAdapter: (params: {\n      state: CoreResolveInput['state'];\n      charts: CoreResolveInput['charts'];\n      deckName: CoreResolveInput['deckName'];\n      playLabel: CoreResolveInput['playLabel'];\n      defenseLabel: CoreResolveInput['defenseLabel'];\n      rng: CoreResolveInput['rng'];\n      ui?: { inTwoMinute?: boolean };\n    }) => {\n      const res = resolvePlayCore({\n        state: params.state,\n        charts: params.charts,\n        deckName: params.deckName,\n        playLabel: params.playLabel,\n        defenseLabel: params.defenseLabel,\n        rng: params.rng,\n      });\n      const nextState = {\n        ...res.state,\n        clock: (params as any).state.clock,\n        score: { ...(params as any).state.score },\n        awaitingPAT: (params as any).state.awaitingPAT,\n        gameOver: (params as any).state.gameOver,\n      } as any;\n      const events: Array<{ type: string; data?: any }> = [];\n      if ((res as any).possessionChanged) events.push({ type: 'possessionChanged' });\n      if ((res as any).touchdown) events.push({ type: 'touchdown' });\n      if ((res as any).safety) events.push({ type: 'safety' });\n      return { nextState, outcome: (res as any).outcome, events } as any;\n    },\n    // Expose createFlow for tests (typed as any in GameRuntime to avoid leaking internals)\n    createFlow: (seed?: number) => {\n      const rng = createLCG(seed ?? 12345);\n      if (!tables.offenseCharts) throw new Error('Offense charts not loaded');\n      const flow = new GameFlow({ charts: tables.offenseCharts, rng, timeKeeping: tables.timeKeeping || {\n        gain0to20: 30,\n        gain20plus: 45,\n        loss: 30,\n        outOfBounds: 15,\n        incomplete: 15,\n        interception: 30,\n        penalty: 15,\n        fumble: 15,\n        kickoff: 15,\n        fieldgoal: 15,\n        punt: 15,\n        extraPoint: 0,\n      }, policy: {\n        chooseTempo: ({ quarter, clock, diff, side }) => {\n          try { return buildPolicy().chooseTempo({\n            quarter,\n            time_remaining_sec: clock,\n            half: quarter <= 2 ? 1 : 2,\n            score_diff: diff,\n            down: 1,\n            distance_to_go_yd: 10,\n            yardline_100: 25,\n            has_two_minute_warning: (quarter === 2 || quarter === 4) && clock > 120,\n            team_archetype: 'Pro',\n            home_or_road: side === 'player' ? 'home' : 'road',\n            underdog: false,\n            possession_after_score_pref: 'normal',\n          }).tempo as any; } catch { return 'normal'; }\n        },\n      } });\n      let flowState: import('./domain/GameState').GameState | null = null;\n      let pendingPenalty: { accepted: import('./domain/GameState').GameState; declined: import('./domain/GameState').GameState; meta: any } | null = null;\n      const translate = (events: FlowEvent[]) => {\n        for (const ev of events) {\n          if (ev.type === 'hud') bus.emit('hudUpdate', ev.payload as any);\n          else if (ev.type === 'log') {\n            bus.emit('log', { message: ev.message });\n            if (/Field goal missed/i.test(ev.message)) {\n              (bus as any).emit && (bus as any).emit('vfx:banner', { text: 'NO GOOD' });\n              (bus as any).emit && (bus as any).emit('sfx:crowd', { kind: 'groan' });\n            }\n          }\n          else if (ev.type === 'vfx') {\n            const kind = ev.payload.kind;\n            if (kind === 'td') {\n              (bus as any).emit && (bus as any).emit('vfx:banner', { text: 'TOUCHDOWN!', gold: true });\n              (bus as any).emit && (bus as any).emit('vfx:flash', {});\n              (bus as any).emit && (bus as any).emit('sfx:crowd', { kind: 'cheer' });\n            } else if (kind === 'interception') {\n              (bus as any).emit && (bus as any).emit('vfx:banner', { text: 'INTERCEPTION!' });\n              (bus as any).emit && (bus as any).emit('vfx:shake', { selector: 'body' });\n              (bus as any).emit && (bus as any).emit('sfx:hit', {});\n            } else if (kind === 'twoMinute') {\n              (bus as any).emit && (bus as any).emit('vfx:flash', {});\n            }\n            bus.emit('vfx', { type: kind, payload: ev.payload.data });\n          }\n          else if (ev.type === 'choice-required') {\n            (bus as any).emit('flow:choiceRequired', { choice: ev.choice, data: ev.data });\n            if (ev.choice === 'penaltyAcceptDecline') {\n              const d: any = ev.data || {};\n              pendingPenalty = { accepted: d.accepted, declined: d.declined, meta: d.meta };\n            }\n          }\n          else if (ev.type === 'final') bus.emit('log', { message: `Final — HOME ${ev.payload.score.player} — AWAY ${ev.payload.score.ai}` });\n          else if (ev.type === 'halftime') bus.emit('log', { message: 'Halftime' });\n          else if (ev.type === 'endOfQuarter') bus.emit('log', { message: `End of Q${ev.payload.quarter}` });\n          else if (ev.type === 'score') {\n            bus.emit('log', { message: `Score: ${ev.payload.kind}` });\n            (bus as any).emit && (bus as any).emit('vfx:scorePop', {});\n            if (ev.payload.kind === 'FG') {\n              (bus as any).emit && (bus as any).emit('vfx:banner', { text: 'FIELD GOAL!' });\n              (bus as any).emit && (bus as any).emit('sfx:beep', { freq: 880, type: 'triangle' });\n            } else if (ev.payload.kind === 'Safety') {\n              (bus as any).emit && (bus as any).emit('vfx:banner', { text: 'SAFETY!', gold: true });\n              (bus as any).emit && (bus as any).emit('sfx:beep', { freq: 220, type: 'square' });\n            } else if (ev.payload.kind === 'TD') {\n              (bus as any).emit && (bus as any).emit('vfx:banner', { text: 'TOUCHDOWN!', gold: true });\n              (bus as any).emit && (bus as any).emit('sfx:crowd', { kind: 'cheer' });\n            }\n          }\n        }\n      };\n      (bus as any).on && (bus as any).on('ui:choice.penalty', (p: { decision: 'accept'|'decline' }) => {\n        if (!pendingPenalty) return;\n        const ctx = pendingPenalty;\n        const chosen = p.decision === 'accept' ? ctx.accepted : ctx.declined;\n        const fin = (flow as any).finalizePenaltyDecision(chosen, p.decision, ctx.meta);\n        flowState = fin.state as any;\n        translate(fin.events);\n        pendingPenalty = null;\n      });\n      return {\n        resolveSnap: (state: import('./domain/GameState').GameState, input: PlayInput) => {\n          const res = flow.resolveSnap(state, input);\n          translate(res.events);\n          flowState = res.state as any;\n          return res;\n        },\n        applyPenaltyDecision: (state: import('./domain/GameState').GameState, decision: 'accept'|'decline', context: { accepted: import('./domain/GameState').GameState; declined: import('./domain/GameState').GameState; meta: any }) => {\n          const chosen = decision === 'accept' ? context.accepted : context.declined;\n          const fin = (flow as any).finalizePenaltyDecision(chosen, decision, context.meta);\n          translate(fin.events);\n          flowState = fin.state as any;\n          return fin;\n        },\n        resolvePATAndRestart: (state: import('./domain/GameState').GameState, side: 'player'|'ai') => {\n          const res = flow.resolvePATAndRestart(state, side);\n          translate(res.events);\n          flowState = res.state as any;\n          return res;\n        },\n        attemptFieldGoal: (state: import('./domain/GameState').GameState, attemptYards: number, side: 'player'|'ai') => {\n          const res = flow.attemptFieldGoal(state, attemptYards, side);\n          translate(res.events);\n          flowState = res.state as any;\n          return res;\n        },\n        resolveSafetyRestart: (state: import('./domain/GameState').GameState, conceding: 'player'|'ai') => {\n          const res = flow.resolveSafetyRestart(state, conceding);\n          translate(res.events);\n          flowState = res.state as any;\n          return res;\n        },\n        performKickoff: (state: import('./domain/GameState').GameState, type: 'normal'|'onside', kicking: 'player'|'ai') => {\n          const res = flow.performKickoff(state, type, kicking);\n          translate(res.events);\n          flowState = res.state as any;\n          return res;\n        },\n        inner: flow,\n      } as any;\n    },\n  },\n};\n\ndeclare global {\n  interface Window { GS?: GameRuntime }\n}\n\nif (typeof window !== 'undefined' && !window.GS) {\n  window.GS = runtime;\n}\n\n// Ensure no legacy bridge remains; runtime boots purely via TS modules.\n\n\n// Auto-start the runtime once the DOM is ready so UI registers and field chrome renders.\n// Idempotent: start() guards on a local flag.\nif (typeof document !== 'undefined') {\n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', () => {\n      try { void runtime.start(); } catch {}\n    }, { once: true });\n  } else {\n    try { void runtime.start(); } catch {}\n  }\n}\n"],"file":"assets/index-eOZWbFL9.js"}