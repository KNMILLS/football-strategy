class u{listeners={};on(r,e){const t=this.listeners[r]||=[];return t.push(e),()=>{const o=t.indexOf(e);o>=0&&t.splice(o,1)}}emit(r,e){const t=this.listeners[r];if(t)for(const o of t)o(e)}}class i{state={hasError:!1,error:null,errorInfo:null,retryCount:0};config;retryTimeoutId=null;originalErrorHandler=null;constructor(r={}){this.config={fallbackComponent:r.fallbackComponent||this.createDefaultFallback,onError:r.onError||this.defaultErrorHandler,isolate:r.isolate??!0,componentName:r.componentName||"UnknownComponent",showErrorDetails:r.showErrorDetails??!1}}static wrap(r,e){return new i(e).wrapElement(r)}static wrapComponent(r,e){const t=new i(e);return((...n)=>{try{const s=r.apply(this,n);return t.wrapElement(s)}catch(s){return t.handleError(s)}})}static wrapEventHandler(r,e,t,o){const n=new i(o),s=(...a)=>{try{return t.apply(this,a)}catch(l){n.handleError(l);return}};return r.on(e,s),()=>r.off(e,s)}wrapElement(r){this.config.isolate&&this.setupErrorIsolation(r);const e=r.addEventListener;return r.addEventListener=(...t)=>{const[o,n,s]=t,a=(...l)=>{try{return n.apply(this,l)}catch(c){this.handleError(c);return}};return e.call(r,o,a,s)},r}setupErrorIsolation(r){this.originalErrorHandler=window.onerror,window.onerror=(t,o,n,s,a)=>{if(a&&this.isErrorFromComponent(a,r))return this.handleError(a),!0;if(this.originalErrorHandler&&a)try{return this.originalErrorHandler(a)}catch{return!1}return!1};const e=new MutationObserver(t=>{t.forEach(o=>{o.removedNodes.forEach(n=>{(n===r||r.contains(n))&&(this.cleanup(),e.disconnect())})})});r.parentNode&&e.observe(r.parentNode,{childList:!0,subtree:!0})}isErrorFromComponent(r,e){const t=r.stack||"";return["HUD","Log","Field","Hand","Controls"].some(n=>t.includes(n)||e.id?.includes(n.toLowerCase()))}handleError(r){this.state.hasError=!0,this.state.error=r,this.state.errorInfo={componentName:this.config.componentName,errorBoundary:"ErrorBoundary"};try{this.config.onError(r,this.state.errorInfo)}catch(e){console.error("Error in error boundary callback:",e)}return console.error(`ErrorBoundary caught error in ${this.config.componentName}:`,r),this.config.fallbackComponent(r,()=>this.retry())}retry(){this.state.retryCount<3&&(this.state.hasError=!1,this.state.error=null,this.state.errorInfo=null,this.state.retryCount++,this.retryTimeoutId&&clearTimeout(this.retryTimeoutId),this.retryTimeoutId=window.setTimeout(()=>{window.dispatchEvent(new CustomEvent("errorBoundaryRetry",{detail:{componentName:this.config.componentName}}))},100*this.state.retryCount))}createDefaultFallback(r,e){const t=document.createElement("div");t.className="error-boundary-fallback",t.style.cssText=`
      padding: 16px;
      margin: 8px;
      border: 2px solid #ff6b6b;
      border-radius: 8px;
      background-color: #fff5f5;
      color: #c92a2a;
      font-family: monospace;
      font-size: 14px;
    `;const o=document.createElement("div");o.textContent=`âš ï¸ ${this.config.componentName} Error`,o.style.fontWeight="bold",o.style.marginBottom="8px";const n=document.createElement("div");n.textContent=this.config.showErrorDetails?r.message:"Component failed to load";const s=document.createElement("button");return s.textContent="Retry",s.style.cssText=`
      margin-top: 8px;
      padding: 4px 12px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
    `,s.onclick=()=>e(),t.appendChild(o),t.appendChild(n),t.appendChild(s),t}defaultErrorHandler(r,e){console.group(`ðŸš¨ ErrorBoundary: ${e.componentName}`),console.error("Error:",r),console.log("Error Info:",e),console.groupEnd()}cleanup(){this.retryTimeoutId&&(clearTimeout(this.retryTimeoutId),this.retryTimeoutId=null),this.originalErrorHandler&&(window.onerror=this.originalErrorHandler,this.originalErrorHandler=null)}getState(){return{...this.state}}triggerError(r){return this.handleError(r)}reset(){this.state.hasError=!1,this.state.error=null,this.state.errorInfo=null,this.state.retryCount=0,this.cleanup()}}const h=Object.freeze(Object.defineProperty({__proto__:null,ErrorBoundary:i},Symbol.toStringTag,{value:"Module"}));export{u as E,h as a};
//# sourceMappingURL=ui-core-BeopM7ou.js.map
