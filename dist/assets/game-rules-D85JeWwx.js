const x={1:"+50 and (+10 x 1D6)",2:"+50",3:"+45",4:"+40",5:"+35",6:"+30"};function g(e){return Math.floor(e()*6)+1}function v(e){const t=g(e),o=x[t];if(!o)return 30;if(o.includes("and"))return 50+g(e)*10;const n=o.match(/\+(\d+)/);return n&&n[1]?parseInt(n[1],10):30}const ae=Object.freeze(Object.defineProperty({__proto__:null,LONG_GAIN_TABLE:x,resolveLongGain:v,rollD6:g},Symbol.toStringTag,{value:"Module"})),y={gain0to20:30,gain20plus:45,loss:30,outOfBounds:15,incomplete:15,interception:30,penalty:15,fumble:15,kickoff:15,fieldgoal:15,punt:15,extraPoint:0};function A(e,t,o){const n={yards:0,penalty:null,turnover:!1,interceptReturn:0,firstDown:!1};if(!e)return n;const s=e.trim();if(n.raw=s,n.outOfBounds=/O\/?B/i.test(s),/Incomplete/i.test(s))return n.category="incomplete",n;if(/FUMBLE/i.test(s))return n.turnover=!0,n.category="fumble",n;if(/INTERCEPT/i.test(s)){n.turnover=!0,n.category="interception";const a=s.match(/[+-]?\d+/);return a&&(n.interceptReturn=parseInt(a[0],10)),n}if(/PENALTY/i.test(s)){const a=s.match(/[+-]\d+/),i=a?parseInt(a[0],10):0,r=i>0;return n.penalty={on:r?"defense":"offense",yards:Math.abs(i),firstDown:/1st\s*Down/i.test(s)},n.category="penalty",n}if(/Sack/i.test(s)){const a=s.match(/-\d+/);return a&&(n.yards=parseInt(a[0],10)),n.category="loss",n}if(/LG/.test(s))return n.yards=t(o),n.category="gain",n;const l=s.match(/[+-]?\d+/);if(l)return n.yards=parseInt(l[0],10),n.category=n.yards<0?"loss":"gain",n;const c=s.match(/Complete\s*[+-]\d+/i);if(c){const a=c[0].match(/[+-]\d+/);return a&&(n.yards=parseInt(a[0],10)),n.category=n.yards<0?"loss":"gain",n}return n.category="other",n}function B(e,t=y){if(!e)return t.gain0to20;if(e.outOfBounds)return t.outOfBounds;switch(e.category){case"incomplete":return t.incomplete;case"interception":return t.interception;case"fumble":return t.fumble;case"penalty":return t.penalty;case"loss":return t.loss;case"gain":return Math.abs(e.yards)>20?t.gain20plus:t.gain0to20;default:return t.gain0to20}}const re=Object.freeze(Object.defineProperty({__proto__:null,DEFAULT_TIME_KEEPING:y,calculateTimeOff:B,parseResultString:A},Symbol.toStringTag,{value:"Module"}));function P(e,t,o,n=y){let s=B(e,n);if(t){const l=e.category==="incomplete",c=!!e.outOfBounds;(l||c||o)&&(s=0)}return s}const le=Object.freeze(Object.defineProperty({__proto__:null,timeOffWithTwoMinute:P},Symbol.toStringTag,{value:"Module"})),k={1:"A",2:"B",3:"C",4:"D",5:"E",6:"F",7:"G",8:"H",9:"I",0:"J"},R={"Goal Line":1,"Short Yardage":2,"Inside Blitz":3,Running:4,"Run & Pass":5,"Pass & Run":6,Passing:7,"Outside Blitz":8,Prevent:9,"Prevent Deep":0},C={"Pro Style":"ProStyle","Ball Control":"BallControl","Aerial Style":"AerialStyle"},F={"Run & Pass Option":"Run/Pass Option","Sideline Pass":"Side Line Pass"};function j(e){const{deckName:t,playLabel:o,defenseLabel:n,charts:s,rng:l}=e,c=C[t]||t,a=F[o]||o,i=R[n],r=i!=null?k[i]:void 0,u=s?.[c],f=u?u[a]:void 0,O=r&&f?f[r]:null;return A(O,v,l)}const ie=Object.freeze(Object.defineProperty({__proto__:null,DECK_NAME_TO_CHART_KEY:C,DEF_LABEL_TO_NUM:R,DEF_NUM_TO_LETTER:k,LABEL_TO_CHART_KEY:F,determineOutcomeFromCharts:j},Symbol.toStringTag,{value:"Module"}));function q(e){return Math.max(0,Math.min(100,e))}function L(e,t){return e.possession==="player"?t:-t}function D(e,t){return q(e+t)}function b(e,t){return e.possession==="player"?100-t:t}function J(e,t){return e.possession==="player"?t:100-t}function G(e,t){const o=Math.floor(t/2);return e>o?{applied:o,capped:!0}:{applied:e,capped:!1}}function W(e,t,o){if(o){const l=e.possession==="player"?100-t:t;return{down:1,toGo:Math.min(10,l)}}const n=e.possession==="player"?100-t:t,s=Math.min(10,n);return{down:Math.max(1,e.down),toGo:Math.max(1,s)}}function Q(e){return e?!!(e.raw&&/\bLG\b/i.test(e.raw)):!1}function X(e,t){return t?0:y.penalty}function S(e){return{...e,score:{...e.score}}}function $(e,t,o,n){const s=n&&o.on==="defense",l=s?"midfield":"previous",c=s?50:t;if(o.on==="defense"){const a=b(e,c),{applied:i,capped:r}=G(o.yards,a);return{ballOn:D(c,L(e,i)),capped:r,spotBasis:l}}else{const a=J(e,c),{applied:i,capped:r}=G(o.yards,a);return{ballOn:D(c,L(e,-i)),capped:r,spotBasis:l}}}function I(e){const{prePlayState:t,postPlayState:o,outcome:n,inTwoMinute:s}=e,l=n.penalty,a=Q(n)&&l.on==="defense",i=S(o),r=$(t,t.ballOn,l,a),u=!!l.firstDown&&l.on==="defense",f=W(t,r.ballOn,u);let p={...S(t),ballOn:r.ballOn,down:f.down,toGo:f.toGo};const z=t.quarter<=4,H=t.clock===0||p.clock===0,h=l.on==="defense"&&z&&H,U=X(s,h);p.clock=Math.max(0,t.clock-U);const N={automaticFirstDownApplied:u,halfDistanceCapped:r.capped,measuredFromMidfieldForLG:a,spotBasis:r.spotBasis,untimedDownScheduled:h};function w(d){const Y=-b(t,d.ballOn)+b(t,t.ballOn),Z=d.down===1?5:d.down===2?2:d.down===3?0:-3,V=Math.max(0,10-d.toGo)*.2;return Y+Z+V}const M=w(p),T=w(i);let m="neutral";return M>T+.5?m="accept":T>M+.5&&(m="decline"),{accepted:p,declined:i,decisionHint:m,adminMeta:N}}function K(e){return e===0||e===100}function E(e){return e<0||e>100}function ee(e){return e==="player"?20:80}function _(e){return{ballOn:ee(e.possessing),possession:e.possessing}}function ne(e,t){const o={...e};return e.possession==="player"?o.ballOn=Math.max(0,Math.min(100,e.ballOn+t)):o.ballOn=Math.max(0,Math.min(100,e.ballOn-t)),o}function te(e){const t={...e,score:{...e.score}};let o=!1,n=!1;return e.possession==="player"?(e.ballOn>=100&&(t.score.player+=6,o=!0),e.ballOn<=0&&(t.score.ai+=2,n=!0)):(e.ballOn<=0&&(t.score.ai+=6,o=!0),e.ballOn>=100&&(t.score.player+=2,n=!0)),{state:t,touchdown:o,safety:n}}function ce(e){let{state:t}=e;const o=j({deckName:e.deckName,playLabel:e.playLabel,defenseLabel:e.defenseLabel,charts:e.charts,rng:e.rng});if(o.category==="penalty"&&o.penalty){const u=I({prePlayState:t,postPlayState:t,outcome:o,inTwoMinute:!1});return{state:u.decisionHint==="decline"?u.declined:u.accepted,outcome:o,touchdown:!1,safety:!1,possessionChanged:!1}}let n={...t},s=!1;if(o.category==="gain"||o.category==="loss")n=ne(t,o.yards);else if(o.category!=="incomplete")if(o.category==="interception"){n.possession=t.possession==="player"?"ai":"player",s=!0;const i=o.interceptReturn||0;if(n.possession==="player"?n.ballOn=Math.max(0,Math.min(100,t.ballOn+i)):n.ballOn=Math.max(0,Math.min(100,t.ballOn-i)),E(n.ballOn)){const r=_({ballOn:n.ballOn,possessing:n.possession});n.ballOn=r.ballOn}else if(K(n.ballOn)){const r=_({ballOn:n.ballOn,possessing:n.possession});n.ballOn=r.ballOn}n.down=1,n.toGo=10}else o.category==="fumble"&&(n.possession=t.possession==="player"?"ai":"player",s=!0,n.down=1,n.toGo=10);if(!s&&(o.category==="gain"||o.category==="loss")){const r=Math.abs(o.yards)>=t.toGo&&o.yards>0;r?(n.down=1,n.toGo=10):(n.down=Math.min(4,t.down+1),n.toGo=Math.max(1,r?10:t.toGo-Math.max(0,o.yards)))}else!s&&o.category==="incomplete"&&(n.down=Math.min(4,t.down+1));const l=!s&&o.category==="gain"&&o.yards>0&&o.yards>=t.toGo,c=P(o,!1,l);n.clock=Math.max(0,t.clock-c);const a=te(n);return n=a.state,{state:n,outcome:o,touchdown:a.touchdown,safety:a.safety,possessionChanged:s}}export{ie as C,y as D,ae as L,re as R,le as T,g as a,ce as b,I as c,v as r,P as t};
//# sourceMappingURL=game-rules-D85JeWwx.js.map
