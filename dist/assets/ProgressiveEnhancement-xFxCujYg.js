class c{features;config;bus;constructor(e,t={}){this.bus=e,this.config={enableWebGL:t.enableWebGL??this.detectWebGL(),enableWebAudio:t.enableWebAudio??this.detectWebAudio(),enableOfflineSupport:t.enableOfflineSupport??this.detectServiceWorker(),enableAdvancedAnimations:t.enableAdvancedAnimations??this.detectAdvancedAnimations(),enablePerformanceMonitoring:t.enablePerformanceMonitoring??!0},this.features=this.detectFeatures(),this.initializeProgressiveFeatures()}detectFeatures(){return{webgl:this.detectWebGL(),webAudio:this.detectWebAudio(),localStorage:this.detectLocalStorage(),serviceWorker:this.detectServiceWorker(),intersectionObserver:this.detectIntersectionObserver(),requestIdleCallback:this.detectRequestIdleCallback(),webWorkers:this.detectWebWorkers()}}detectWebGL(){try{const e=document.createElement("canvas");return!!(window.WebGLRenderingContext&&(e.getContext("webgl")||e.getContext("experimental-webgl")))}catch{return!1}}detectWebAudio(){return"webkitAudioContext"in window||"AudioContext"in window}detectLocalStorage(){try{const e="__localStorage_test__";return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch{return!1}}detectServiceWorker(){return"serviceWorker"in navigator}detectIntersectionObserver(){return"IntersectionObserver"in window}detectRequestIdleCallback(){return"requestIdleCallback"in window}detectWebWorkers(){return"Worker"in window}detectAdvancedAnimations(){const e=document.createElement("div").style;return"transform"in e&&"transition"in e&&"animation"in e&&this.detectWebGL()}initializeProgressiveFeatures(){this.bus.emit("features:detected",{features:this.features}),this.config.enableWebGL&&this.features.webgl&&this.enableWebGLFeatures(),this.config.enableWebAudio&&this.features.webAudio&&this.enableWebAudioFeatures(),this.config.enableOfflineSupport&&this.features.serviceWorker&&this.enableOfflineSupport(),this.config.enableAdvancedAnimations&&this.features.intersectionObserver&&this.enableAdvancedAnimations(),this.config.enablePerformanceMonitoring&&this.enablePerformanceMonitoring(),this.features.intersectionObserver&&this.setupLazyLoading()}enableWebGLFeatures(){this.bus.emit("webgl:enabled",{}),document.body.classList.add("webgl-supported"),this.bus.emit("ui:enhancement",{type:"webgl",enabled:!0,message:"Enhanced graphics enabled"})}enableWebAudioFeatures(){this.bus.emit("webaudio:enabled",{}),document.body.classList.add("webaudio-supported"),this.bus.emit("ui:enhancement",{type:"webaudio",enabled:!0,message:"Enhanced audio enabled"})}enableOfflineSupport(){this.bus.emit("offline:enabled",{}),"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js").then(e=>{this.bus.emit("offline:ready",{registration:e})}).catch(e=>{console.warn("Service worker registration failed:",e)})}enableAdvancedAnimations(){this.bus.emit("animations:enabled",{}),document.body.classList.add("animations-supported"),this.bus.emit("ui:enhancement",{type:"animations",enabled:!0,message:"Enhanced animations enabled"})}enablePerformanceMonitoring(){"performance"in window&&"measure"in performance&&this.setupPerformanceMonitoring()}setupPerformanceMonitoring(){let e=performance.now(),t=0,i=performance.now();const s=()=>{t++;const r=performance.now(),n=r-i;if(n>=1e3){const a=Math.round(t*1e3/n);this.bus.emit("performance:fps",{fps:a}),t=0,i=r}requestAnimationFrame(s)};requestAnimationFrame(s),this.bus.on("ui:ready",()=>{const r=performance.now()-e;performance.mark("ui-ready"),this.bus.emit("performance:loadTime",{loadTime:r,mark:"ui-ready"})}),this.bus.on("flow:gameStart",()=>{performance.mark("game-start");const r=performance.now()-e;this.bus.emit("performance:gameStartTime",{gameStartTime:r,mark:"game-start"})})}setupLazyLoading(){const e=document.querySelectorAll("img[data-src]");if(e.length===0)return;const t=new IntersectionObserver((i,s)=>{i.forEach(r=>{if(r.isIntersecting){const n=r.target;n.src=n.dataset.src,n.classList.remove("lazy"),s.unobserve(n)}})});e.forEach(i=>t.observe(i))}getFeatures(){return{...this.features}}getConfig(){return{...this.config}}isFeatureEnabled(e){return this.features[e]&&this.config[`enable${e.charAt(0).toUpperCase()+e.slice(1)}`]===!0}enableFeature(e){if(!this.features[e])return!1;const t=`enable${e.charAt(0).toUpperCase()+e.slice(1)}`;switch(this.config[t]=!0,e){case"webgl":this.enableWebGLFeatures();break;case"webAudio":this.enableWebAudioFeatures();break;case"serviceWorker":this.enableOfflineSupport();break;case"intersectionObserver":this.enableAdvancedAnimations();break}return!0}disableFeature(e){const t=`enable${e.charAt(0).toUpperCase()+e.slice(1)}`;switch(this.config[t]=!1,e){case"webgl":document.body.classList.remove("webgl-supported");break;case"webAudio":document.body.classList.remove("webaudio-supported");break;case"intersectionObserver":document.body.classList.remove("animations-supported");break}}}export{c as ProgressiveEnhancement};
//# sourceMappingURL=ProgressiveEnhancement-xFxCujYg.js.map
