import{r as W,a as B,D as j,t as re,b as ie,c as le}from"./game-rules-D85JeWwx.js";const U={2:"FUMBLE*",3:"PENALTY -10*",4:10,5:15,6:20,7:25,8:30,9:35,10:40,11:"LG",12:"LG + 5"},V={1:{possession:"kicker",yard:40},2:{possession:"kicker",yard:40},3:{possession:"receiver",yard:35},4:{possession:"receiver",yard:35},5:{possession:"receiver",yard:35},6:{possession:"receiver",yard:30}};function ee(n,e){return typeof n=="number"?{yardLine:n,turnover:!1}:n==="LG"?{yardLine:Math.min(W(e),50),turnover:!1}:n==="LG + 5"?{yardLine:Math.min(W(e)+5,50),turnover:!1}:{yardLine:25,turnover:!1}}function te(n,e){if(e.onside){let l=B(n);e.kickerLeadingOrTied&&(l=Math.min(6,l+1));const c=V[l]||{possession:"receiver",yard:35};return{yardLine:c.yard,turnover:c.possession==="kicker"}}let s=B(n)+B(n),t=U[s],o=!1,a=!1;if(typeof t=="string"&&t.includes("*")){/FUMBLE/i.test(t)&&(o=!0),/PENALTY/i.test(t)&&(a=!0),t=t.replace("*","").trim();const l=B(n)+B(n);let c=U[l];typeof c=="string"&&c.includes("*")&&(/FUMBLE/i.test(c)&&(o=!1),/PENALTY/i.test(c)&&(a=!1),c=c.replace("*","").trim()),t=c}const i=ee(t,n);let r=i.yardLine;return a&&(r=Math.max(0,i.yardLine-10)),{yardLine:r,turnover:o}}const Ne=Object.freeze(Object.defineProperty({__proto__:null,NORMAL_KICKOFF_TABLE:U,ONSIDE_KICK_TABLE:V,parseKickoffYardLine:ee,resolveKickoff:te},Symbol.toStringTag,{value:"Module"})),se={2:30,3:35,4:38,5:40,6:42,7:43,8:44,9:46,10:48,11:50,12:52},oe={2:{type:"LG"},3:{yards:20},4:{yards:15},5:{yards:12},6:{yards:10},7:{yards:8},8:{yards:6},9:{yards:5},10:{yards:3},11:{yards:0},12:{type:"FC"}};function F(n){return Math.floor(n()*6)+1}function ae(n,e,s){const t=n.puntingTeam==="player",o=F(e)+F(e),a=se[o]??40;let i=n.ballOn+(t?a:-a);if(i>100||i<0||i===100||i===0)return{ballOn:(t?"ai":"player")==="player"?20:80,possessionFlips:!0,fumbleRecoveredByKickingTeam:!1,touchback:!0,distance:a,returnYards:0,returnType:"YDS"};const r=F(e)+F(e),l=oe[r]||{yards:0};let c=0,d=!1;return l.type==="FC"?c=0:l.type==="LG"?c=s(e):(c=l.yards||0,r<=4&&e()<.15&&(d=e()<.5)),t?i-=c:i+=c,i=Math.max(0,Math.min(100,i)),d?{ballOn:i,possessionFlips:!1,fumbleRecoveredByKickingTeam:!0,touchback:!1,distance:a,returnYards:c,returnType:l.type?l.type:"YDS"}:{ballOn:i,possessionFlips:!0,fumbleRecoveredByKickingTeam:!1,touchback:!1,distance:a,returnYards:c,returnType:l.type?l.type:"YDS"}}const qe=Object.freeze(Object.defineProperty({__proto__:null,PUNT_DISTANCE_TABLE:se,PUNT_RETURN_TABLE:oe,resolvePunt:ae,rollD6:F},Symbol.toStringTag,{value:"Module"})),E={2:{PAT:"NG","1-12":"NG","13-22":"NG","23-32":"G","33-38":"G","39-45":"G"},3:{PAT:"G","1-12":"NG","13-22":"NG","23-32":"NG","33-38":"G","39-45":"NG"},4:{PAT:"G","1-12":"G","13-22":"NG","23-32":"NG","33-38":"NG","39-45":"NG"},5:{PAT:"G","1-12":"G","13-22":"G","23-32":"NG","33-38":"NG","39-45":"NG"},6:{PAT:"G","1-12":"G","13-22":"G","23-32":"G","33-38":"NG","39-45":"NG"},7:{PAT:"G","1-12":"G","13-22":"G","23-32":"G","33-38":"G","39-45":"NG"},8:{PAT:"G","1-12":"G","13-22":"G","23-32":"G","33-38":"NG","39-45":"NG"},9:{PAT:"G","1-12":"G","13-22":"G","23-32":"NG","33-38":"NG","39-45":"NG"},10:{PAT:"G","1-12":"G","13-22":"G","23-32":"NG","33-38":"NG","39-45":"NG"},11:{PAT:"G","1-12":"G","13-22":"NG","23-32":"NG","33-38":"G","39-45":"NG"},12:{PAT:"NG","1-12":"NG","13-22":"G","23-32":"G","33-38":"G","39-45":"G"}};function A(n){return Math.floor(n()*6)+1}function ce(n){const e=A(n)+A(n);return(E[e]||{}).PAT==="G"}function de(n,e){const s=Math.round(e);let t=null;if(s<=12?t="1-12":s<=22?t="13-22":s<=32?t="23-32":s<=38?t="33-38":s<=45?t="39-45":t=null,!t)return!1;const o=A(n)+A(n);return(E[o]||{})[t]==="G"}const Be=Object.freeze(Object.defineProperty({__proto__:null,PLACE_KICK_TABLE:E,attemptFieldGoal:de,attemptPAT:ce,rollD6:A},Symbol.toStringTag,{value:"Module"}));function ue(n){const e=(n||[]).map(d=>String(d).replace(/\s+/g," ").trim()).filter(Boolean);if(e.length===0)return{pbp:"Play is underway.",analyst:"Watch the leverage and pad level here."};if(e.length===1)return{pbp:e[0]||"Play is underway.",analyst:"Good fundamentals at the point of attack."};const s=d=>/\blines up\b/i.test(d),t=d=>/^\d+(st|nd|rd|th)\s*&|^Now\s/i.test(d),o=d=>!(s(d)||t(d)),a=e.filter(o),i=/(drops back|throws|pass|button hook|slant|sideline|down and in|down and out|pop pass|flair|flare|screen|bomb|keeper|sneak|draw|trap|toss|sweep|handoff|fumbled|intercepted|sacked|return|pylon|toe-?tap|first down|loss of|gain of|pressure|hits|seam shot|deep post|post|corner)/i,r=/(blitz|goal[- ]?line|prevent|nickel|coverage|box|pad level|leverage|midfield|red zone|goal to go|backed up|short[- ]?yardage|crowds the line|balanced)/i,l=a.find(d=>i.test(d))||a[0]||e.find(o)||e[0]||"Play is underway.";let c=a.find(d=>d!==l&&(r.test(d)||/first down|now \d+(st|nd|rd|th)/i.test(d)))||e.find(d=>d!==l&&o(d))||e.find(d=>d!==l)||"Good fundamentals at the point of attack.";return{pbp:l,analyst:c}}function fe(n,e,s,t,o){const a=n.down===1?"First and 10":n.down===2?`Second and ${n.toGo}`:n.down===3?`Third and ${n.toGo}`:`Fourth and ${n.toGo}`,i=o.formatPossessionSpotForBroadcast(n.possession,n.ballOn),r=String(s.defenseLabel||""),l=String(s.playLabel||""),c=o.formatClock(n.clock),d=`HOME ${n.score.player} – AWAY ${n.score.ai}`,h=(()=>{const m=n.ballOn%3;return m===0?"left hash":m===1?"right hash":"between the hashes"})(),w=n.ballOn%2===0?"near side numbers":"far side numbers",g=/shotgun|down &|bomb|screen|sideline|button|look in|pop pass|flair|flare/i.test(l)?"shotgun, three wide":/keeper|sneak|short yard|goal line|off tackle|slant run|trap|draw/i.test(l)?"under center, I-formation":"balanced set",$=/outside blitz|inside blitz/i.test(r)?"blitz look":/passing/i.test(r)?"nickel shell, two-high safeties":/prevent_deep/i.test(r)?"prevent, safeties deep":/goal line|short yard/i.test(r)?"heavy front, stacked box":"balanced front",f=/sideline|down & out|down & in|screen|flair|flare|button/i.test(l)?"slot in short motion":"",y=/run|keeper|draw|trap|sneak|slant|off tackle|end run|razzle/i.test(l)&&!/pass/i.test(l),S=/pass|hook|look in|sideline|flair|flare|screen|down &/i.test(l),P=y?/end run/i.test(l)?"hands it off around the edge.":/off tackle/i.test(l)?"hands it off off tackle.":/keeper|sneak|qb/i.test(l)?"keeps it himself.":"turns and hands it off up the middle.":S?"drops back and fires.":"gets it out quickly.";let T="";if(!t)T="";else if(t.category==="incomplete")T=" Incomplete.";else if(t.category==="gain"||t.category==="loss"){const m=t.yards||0;if(m>0){const _=[" slips through left guard."," dives into the pile."," cuts back against pursuit."," bounces outside."," spins forward."],Q=[" quick hitter underneath."," slant left, caught."," button hook at the sticks."," out to the flat."," screen forms."],G=I=>I[Math.floor((o.rng?.()||Math.random())*I.length)];if(T=`${G(y?_:Q)} Gain of ${m}.`,m>=20)try{o.quarterStats.explosives+=1}catch{}}else m<0?T=` Swallowed up for ${Math.abs(m)}.`:T=" Stonewalled at the line."}else if(t.category==="fumble"){T=" Ball is loose and recovered.";try{o.quarterStats.turnovers+=1}catch{}}else if(t.category==="interception"){T=" Picked off!";try{o.quarterStats.turnovers+=1}catch{}}`${a}${o.formatTeamYardLine(n.possession,n.ballOn)}${n.quarter}${c}${d}`;const L=n.possession==="player"?"HOME":"AWAY",O=(()=>{const m=["Here we go —","They set —","Quick to the line —","They take their time —","Snap comes —","Ball is snapped —","Here’s the play —","They roll it out —"];return m[Math.floor((o.rng?.()||Math.random())*m.length)]})(),p=`${L} ${o.playInDrive>1?"sets":"breaks the huddle"} on the ${h}, ${g}. Defense shows ${$}${f?`, ${f}`:""}.`,D=`${O} quarterback ${P}${T}`,N=`${o.formatOrdinal(e.down)} & ${e.toGo}`,R=o.formatTeamYardLine(e.possession,e.ballOn),u=`Spotted ${(e.possession==="player"?100-e.ballOn:e.ballOn)<=20?"inside the red zone":e.ballOn>=48&&e.ballOn<=52?"just shy of midfield":`${w}`} at ${R}. ${N}.`,v=(n.quarter===2||n.quarter===4)&&n.clock<=120?n.clock<60?" They’re hurrying now — under a minute left.":" Gotta get this snapped before the clock burns.":"",Y=t&&(t.category==="interception"||t.category==="fumble")?e.possession==="player"?" And the crowd erupts!":" A hush falls over the stadium.":"",C=((o.rng?.()||Math.random())<.35?`${a} at ${o.formatTeamYardLine(n.possession,n.ballOn)}… ${D} ${u}${v}${Y}`:`${a} from ${i}, Q${n.quarter} ${c} — ${d}. ${p} ${D} ${u}${v}${Y}`).trim();let b="";if(t&&(t.category==="gain"||t.category==="loss")){const m=t.yards||0;m>=8?b=y?"Great cut and second-level block opened that lane.":"Beat the leverage outside — timing was perfect.":m>=3?b=y?"Good pad level; fell forward behind the guard.":"On time and on target; easy yards.":m>0?b=y?"Patient run, but backers closed fast.":"Checkdown; kept it ahead of the sticks.":m===0?b="Front won at the snap — no movement.":b="That was a brick wall up front; linebackers filled every crease."}b||(/outside blitz/i.test(r)?b="Edge pressure; QB had to speed it up.":/inside blitz/i.test(r)?b="A-gap heat — protection slid late.":/goal line|short yard/i.test(r)?b="Heavy front, gaps corked.":/passing/i.test(r)?b="Light box with umbrella coverage.":/prevent/i.test(r)?b="Soft shell, keep-it-in-front spacing.":b=y?"Line got just enough push.":"Protection held just long enough.");try{(o.playInDrive>=2?o.playInDrive:0)>=2&&y&&(b+=" They’ve hit that off-tackle twice; don’t be shocked if they fake it next series.")}catch{}return{pbp:C,analyst:b}}function he(n,e,s,t,o,a,i){const r=[],l=u=>u==="player"?"HOME":"AWAY",c=`${l(n.possession)} ball at the ${i.formatTeamYardLine(n.possession,n.ballOn)} yard line.`,d=n.possession==="player"?100-n.ballOn:n.ballOn,h=n.ballOn,w=n.possession==="player"?h>=50:h<=50,g=h>=45&&h<=55,$=n.possession==="player"?h<=10:h>=90;let f=null;d<=10&&n.down===1&&n.toGo>=d?f="GoalToGo":d<=20?f="RedZone":g?f="NearMid":w?f="AcrossMid":$&&(f="BackedUp");const y=i.getLastNotesForSide(n.possession);f&&f!==y.zone&&(f==="GoalToGo"?r.push("Goal to go."):f==="RedZone"?r.push("Red zone opportunity."):f==="NearMid"?r.push("Near midfield."):f==="AcrossMid"?r.push("Across midfield."):f==="BackedUp"&&r.push("Backed up near own goal line."));const P=d+17<=45;P&&n.down>=3&&!y.fgInRange&&r.push("Within field goal range."),r.push(`${i.formatOrdinal(n.down)} & ${n.toGo}, ${c}`);const T=n.toGo<=1,L=/sneak|qb keeper|keeper/i.test(o),O=/play[- ]?action|long bomb|down & in|down & out|post|corner|seam|bomb/i.test(o);if(T||L||O){const u=/pass|hook|look in|sideline|flare|flair|pop|bomb|button|screen|down &/i.test(o)?"lines up in the shotgun.":"lines up under center.";r.push(u)}const p=String(o||""),N=(u=>{const k=v=>v[Math.floor((i.rng?.()||Math.random())*v.length)];return/goal line/i.test(u)?k(["Stacked front, safeties pinched.","Stacked box, gaps corked."]):/short yardage/i.test(u)?k(["Tight box, gaps packed.","Heavy front, gaps corked."]):/passing/i.test(u)?k(["Light box, two-high shell.","Nickel spacing, umbrella coverage."]):/outside blitz/i.test(u)?k(["Corner fire off the edge.","Nickel off the slot.","Safety blitz crashing down."]):/inside blitz/i.test(u)?k(["Mike shoots the A-gap.","Linebacker dog up the middle."]):/prevent deep/i.test(u)?k(["Umbrella shell, keep it in front.","Prevent deep — nothing behind."]):/prevent/i.test(u)?"Umbrella look, keep-it-in-front spacing.":/run & pass|pass & run|running/i.test(u)?k(["Balanced shell.","Soft quarters, balanced spacing."]):null})(String(a||"")),R=y.defense||null,q=/blitz/i.test(a||"");if(N&&(q||(a||"")!==R)&&r.push(N),/punt/i.test(p)?r.push(`${l(n.possession)} lines up to punt from the ${n.ballOn} yard line.`):/pass|hook|look in|sideline|flare|flair|pop|bomb|button/i.test(p)?/screen/i.test(p)?r.push("Quarterback sets up the screen."):/button hook/i.test(p)?r.push("Quick button hook route."):/look in/i.test(p)?r.push("Quick slant to the inside."):/sideline/i.test(p)?r.push("Throws to the sideline."):/down & in/i.test(p)?r.push("Throws down and in."):/down & out/i.test(p)?r.push("Throws down and out."):/pop pass/i.test(p)?r.push("Quick pop pass over the middle."):/flair|flare/i.test(p)?r.push("Flair pass to the back."):/stop & go/i.test(p)?r.push("Stop-and-go, going deep."):/bomb/i.test(p)?r.push("Going deep downfield."):r.push("Quarterback drops back to pass."):/keeper|draw|qb/i.test(p)?r.push("Quarterback keeps it himself and runs."):/end run/i.test(p)?r.push("Quarterback hands off around the end."):/off tackle/i.test(p)?r.push("Quarterback hands off off tackle."):/slant run/i.test(p)?r.push("Quarterback hands off on an inside slant run."):/draw/i.test(p)?r.push("Quarterback delays and hands off on a draw play."):/trap/i.test(p)?r.push("Quarterback hands off on a trap play."):/run & pass option/i.test(p)?r.push("Quarterback reads the option look."):/razzle dazzle/i.test(p)?r.push("Trick play! Razzle dazzle in the backfield."):r.push("Quarterback hands off to the running back."),t.td)return{result:"Touchdown",notes:[...r,"Touchdown scored."]};if(t.safety)return{result:"Safety",notes:[...r,"Safety is awarded."]};if(!s)return{result:"Play",notes:r};if(s.category==="incomplete"){let u="The pass falls incomplete.";return/blitz/i.test(a)?u="Pressure forces an incomplete pass.":/prevent deep/i.test(a)?u="Prevent deep coverage breaks up the deep shot.":/passing/i.test(a)&&(u="Tight coverage, pass falls incomplete."),{result:"Incomplete",notes:[...r,u]}}if(s.category==="gain"||s.category==="loss"){const u=s.yards||0,k=u>=0?"Gain":"Loss";if(!!(s.raw&&/sack/i.test(s.raw)||/sack/i.test(p))){const G=/blitz/i.test(a)?" Blitz gets home.":"";return{result:`Sack -${Math.abs(u)}`,notes:[...r,`Edge wins inside spin; quarterback swallowed.${G}`,`Loss of ${Math.abs(u)} yards. Protection beaten.`,`Now ${i.formatOrdinal(e.down)} & ${e.toGo}.`]}}const Y=n.possession===e.possession&&n.down!==1&&e.down===1,Z=["slashes for","rumbles for","bursts for","powers for","cuts for"],C=["stacked for","dropped for","stuffed for","spilled for"],b=G=>G[Math.floor((i.rng?.()||Math.random())*G.length)],m=u>=0?`${b(Z)} ${Math.abs(u)}.`:`${b(C)} ${Math.abs(u)}.`,_=Math.abs(u)>=20?(()=>{const G=i.formatTeamYardLine(n.possession,n.ballOn),X=n.possession==="player"?n.ballOn+Math.floor(Math.abs(u)/2):n.ballOn-Math.floor(Math.abs(u)/2),I=i.formatTeamYardLine(n.possession,Math.max(0,Math.min(100,X))),ne=i.formatTeamYardLine(e.possession,e.ballOn);return`From ${G}… to ${I}… down at ${ne}!`})():"",Q=Y?" First down!":"";return{result:`${k} ${Math.abs(u)}`,notes:[...r,`${m} ${_}`.trim(),`Now ${i.formatOrdinal(e.down)} & ${e.toGo}.${Q}`]}}if(i.setLastNotesForSide(n.possession,{zone:f||i.getLastNotesForSide(n.possession).zone,fgInRange:P,defense:a||null}),s.category==="interception"){const u=s.interceptReturn||0,k=u?` Return of ${Math.abs(u)} yards.`:"",v=i.formatTeamYardLine(e.possession,e.ballOn);return{result:"Interception",notes:[...r,`Ball is picked — tipped and taken.${k}`,`${l(e.possession)} takes over at the ${v}.`]}}if(s.category==="fumble"){const u=i.formatTeamYardLine(e.possession,e.ballOn),k=i.formatTeamYardLine(n.possession,n.ballOn);return{result:"Fumble",notes:[...r,`Ball's loose at ${k} — scrum on the ground.`,`Recovered by ${l(e.possession)} at ${u}.`]}}if(s.category==="penalty"){const u=s.penalty&&s.penalty.on||"offense",k=s.penalty&&s.penalty.yards||0;return{result:`Penalty on ${u} (${k})`,notes:[...r,"Penalty called."]}}return{result:"Play",notes:r}}class pe{constructor(e){this.rng=e;const s=t=>t[Math.floor((this.rng?.()||Math.random())*t.length)];this.weather={temp:s(["crisp","mild","warm","hot"]),wind:s(["calm","light breeze","gusty","quartering wind"]),precip:s(["clear","overcast","light rain","light snow"])}}driveId=1;playInDrive=0;currentPossession=null;driveStartAbsBallOn=null;driveStartSide=null;driveStats={runPlays:0,passPlays:0,totalYards:0,explosives:0,sacks:0};quarterStats={quarter:1,runs:0,passes:0,pointsHome:0,pointsAway:0,explosives:0,turnovers:0};weather;lullThreeAndOutStreak=0;lastNotesBySide={player:{zone:null,fgInRange:!1,defense:null},ai:{zone:null,fgInRange:!1,defense:null}};getPlayInDrive(){return this.playInDrive}getQuarterStatsRef(){return this.quarterStats}getLastNotesForSide(e){return this.lastNotesBySide[e]}setLastNotesForSide(e,s){this.lastNotesBySide[e]=s}incrementRunOrPassByLabel(e){try{const s=String(e||"").toLowerCase();/run|keeper|draw|trap|sneak|slant|off tackle|end run|razzle/.test(s)&&!/pass/.test(s)?this.quarterStats.runs+=1:this.quarterStats.passes+=1}catch{}}beginDriveIfNeeded(e,s,t){if(this.currentPossession!==e.possession){this.playInDrive>0&&(this.driveId+=1),this.playInDrive=0,this.currentPossession=e.possession,this.driveStartAbsBallOn=e.ballOn,this.driveStartSide=e.possession,this.driveStats={runPlays:0,passPlays:0,totalYards:0,explosives:0,sacks:0};const o=t(e.possession,e.ballOn),a=e.possession==="player"?"HOME":"AWAY",i=e.ballOn,r=e.possession==="player"?i>=60:i<=40,c=(e.possession==="player"?i<=15:i>=85)?"Backed up deep — protection and ball security matter here.":r?"Short field — everything in the playbook is available.":"Solid field position to start the drive.";s.push({type:"log",message:`Brad: ${a} takes over at ${o}.`}),s.push({type:"log",message:`Rob: ${c}`})}}incrementPlayInDrive(){this.playInDrive+=1}endDriveSummaryIfAny(e,s,t){if(this.driveStartAbsBallOn!=null&&this.driveStartSide!=null){const o=this.playInDrive,a=this.driveStats.totalYards,i=this.driveStats.runPlays>this.driveStats.passPlays?"ground-heavy":this.driveStats.passPlays>this.driveStats.runPlays?"air-heavy":"balanced",r=this.driveStartSide==="player"?"HOME":"AWAY",l=o<=3&&a>=30||this.driveStats.explosives>=1,c=o>=8&&a>=30;let d="";t==="touchdown"?d=l?`Three plays, quick strike — all chunk yardage — and ${r} cashes in.`:c?`Ten-play, grinding march — they owned the trenches — and ${r} finishes.`:`Drive wraps touchdown — ${o} plays for ${Math.abs(a)}.`:t==="punt"?d=o<=3?`${r} goes three-and-out — momentum drifting the other way.`:`Stalled after ${o} plays — punt coming.`:t==="downs"?d=`Stuffed on downs — ${r} turned away.`:t==="safety"?d=`Safety ends it — costly series for ${r}.`:d=`Drive wraps ${t} — ${o} plays, ${Math.abs(a)} yards ${a>=0?"gained":"lost"}.`;const h=t==="touchdown"?c?"They leaned on them — pure power football.":l?"Scheme beat leverage — that flipped the field.":"Execution at the key moments.":t==="safety"?"Protection broke down; all the juice flips sideline.":t==="downs"?"That front dominated gaps — nowhere to go.":t==="punt"?`${i} looks, but no finish.`:`${i} sequence.`;s.push({type:"log",message:`Brad: ${d}`}),s.push({type:"log",message:`Rob: ${h}`});try{if(t==="punt"&&o<=3&&a<5?this.lullThreeAndOutStreak+=1:this.lullThreeAndOutStreak=0,this.lullThreeAndOutStreak>=2){const g=this.weather,$=g.precip!=="clear"?`Weather note — ${g.precip}, ${g.wind}.`:g.wind!=="calm"?`Wind note — ${g.wind}, ball hanging a bit.`:"Crowd is restless; waiting for a spark.",f=this.driveStats.runPlays+this.driveStats.passPlays>=8?"Big bodies leaning — fatigue creeping in.":"Front sevens fresh, but they’re grinding.";s.push({type:"log",message:`Brad: ${$}`}),s.push({type:"log",message:`Rob: ${f}`}),this.lullThreeAndOutStreak=0}}catch{}}}}function ye(n,e,s,t){const o=[];let a={...n},r=(t.timeKeeping||j).kickoff;(a.quarter===2||a.quarter===4)&&a.clock>120&&a.clock-r<120&&(r=a.clock-120,o.push({type:"log",message:"Two-minute warning."}),o.push({type:"vfx",payload:{kind:"twoMinute"}})),a.clock=Math.max(0,a.clock-r);const l=e==="onside",c=t.isLeading(s,a.score)||t.isTied(a.score),d=te(t.rng,{onside:l,kickerLeadingOrTied:c}),h=s==="player"?"ai":"player",w=h==="player"?d.yardLine:100-d.yardLine;a.possession=d.turnover?s:h,a.ballOn=Math.max(0,Math.min(100,w));const g={down:1,toGo:10};a.down=g.down,a.toGo=g.toGo,o.push({type:"kickoff",payload:{onside:l}});try{const $=a.possession,f=t.formatTeamYardLine($,a.ballOn),y=v=>v[Math.floor((t.rng?.()||Math.random())*v.length)],S=y(["a high hanger","a booming end-over-end","a wobbly spiral","a knuckleball","a low liner"]),P=y(["toward the near numbers","to the far sideline","between the hashes","to the right numbers","to the left numbers"]),T=y(["the goal line","the five","the three"]),L=$==="player"?a.ballOn:100-a.ballOn,O=L>=55,p=L>=70,D=["angles left, then up the seam","up the middle, bounces outside","zigs past the first wave, then squared up"],N=["straight ahead, no crease","met by the first wave, stacked"],q=y(p?["hits the crease and bursts free","finds daylight down the sideline","cuts back and turns on the jets"]:O?D:[...D,...N]),u=p?`And away we go — ${S} ${P}. Caught at ${T}, ${q} — all the way to ${f}!`:O?`And away we go — ${S} ${P}. Caught at ${T}, ${q} — big return to ${f}.`:`And away we go — ${S} ${P}. Caught at ${T}, ${q} — brought to ${f}.`,k=y(p?["Coverage bust — contain lost leverage and the lane opened wide.","Out-kicked the coverage — return team found a runway.","Missed fits across the board — explosive return."]:O?["Out-kicked the coverage — return team found daylight.","Gunners got washed — edge was there."]:["Coverage lanes stayed disciplined — no big gap to hit.","Good hang gave the gunners time — textbook coverage.","Return set it up, but contain held firm."]);o.push({type:"log",message:`Brad: ${u}`}),o.push({type:"log",message:`Rob: ${k}`})}catch{}return o.push({type:"hud",payload:{quarter:a.quarter,clock:a.clock,down:a.down,toGo:a.toGo,ballOn:a.ballOn,possession:a.possession,score:{player:a.score.player,ai:a.score.ai}}}),{state:a,events:o}}function ge(n,e,s){const t=[],o=n.possession,a=ae({ballOn:n.ballOn,puntingTeam:o},s.rng,W),i=s.formatTeamYardLine(o,n.ballOn),r=o==="player"?"ai":"player",l=s.formatTeamYardLine(a.possessionFlips?r:o,a.ballOn);typeof a.distance=="number"&&a.distance;const c=a.returnYards||0,d=S=>S[Math.floor((s.rng?.()||Math.random())*S.length)],h=d(["booming end-over-end","tight spiral","wobbly spiral","low driving kick","high hanging punt"]),w=d(["toward the boundary","angling to the near hash","to the far numbers","middle of the field"]),g=c>=15?d(["up the seam","bounces outside","cuts back against pursuit"]):d(["met square by the first wave","slips one, then wrapped","no room, stacked early"]),$=`${h} from ${i}, ${w}. Return ${g} for ${c}, down at ${l}.`,f=c>=15?"Out-kicked the coverage — return team found daylight.":"Hang time and lanes — coverage wins that down.";t.push({type:"log",message:`Brad: ${$}`}),t.push({type:"log",message:`Rob: ${f}`}),e.possession=a.possessionFlips?o==="player"?"ai":"player":o,e.ballOn=a.ballOn;const y={down:1,toGo:10};return e.down=y.down,e.toGo=y.toGo,s.endDriveSummaryIfAny(e,t,"punt"),t.push({type:"hud",payload:{quarter:e.quarter,clock:e.clock,down:e.down,toGo:e.toGo,ballOn:e.ballOn,possession:e.possession,score:{player:e.score.player,ai:e.score.ai}}}),{state:e,events:t}}function me(n,e,s){const t=[];let o={...n};const a=o.score.player-o.score.ai;(s.choosePAT?.({diff:a,quarter:o.quarter,clock:o.clock,side:e})??(e==="ai"?(()=>{const c=o.quarter===4&&o.clock<=300;return a<0&&-a<=2&&c?"two":"kick"})():"kick"))==="two"?s.rng()<.5&&(e==="player"?o.score.player+=2:o.score.ai+=2,t.push({type:"score",payload:{...s.scoringSideToDelta(e,2),kind:"TwoPoint"}})):s.attemptPatInternal(s.rng)&&(e==="player"?o.score.player+=1:o.score.ai+=1,t.push({type:"score",payload:{...s.scoringSideToDelta(e,1),kind:"XP"}})),o.awaitingPAT=!1;const r=s.chooseKickoffType?.({trailing:s.isTrailing(e,o.score),quarter:o.quarter,clock:o.clock})??"normal",l=s.performKickoff(o,r,e);return{state:l.state,events:[...t,...l.events]}}function ke(n,e,s,t){const o=[];let a={...n};const i={...a};let r=t.timeKeepingFieldGoalSeconds,l=!1;if((i.quarter===2||i.quarter===4)&&i.clock>120&&i.clock-r<120&&(r=i.clock-120,l=!0),a.clock=Math.max(0,i.clock-r),l&&(o.push({type:"log",message:"Brad: Two-minute warning."}),o.push({type:"vfx",payload:{kind:"twoMinute"}})),t.attemptFieldGoalKick(t.rng,e)){s==="player"?a.score.player+=3:a.score.ai+=3,o.push({type:"score",payload:{...t.scoringSideToDelta(s,3),kind:"FG"}});const d=t.randomHash(),h=`Field goal from ${e}, ${d} — it is good. HOME ${a.score.player} — AWAY ${a.score.ai}, Q${a.quarter} ${t.formatClock(a.clock)}`,w="Clean snap, clean hold; good rotation on the ball.";o.push({type:"log",message:`Brad: ${h}`}),o.push({type:"log",message:`Rob: ${w}`});const g=t.performKickoff(a,"normal",s);a=g.state,o.push(...g.events)}else{const d=t.missedFieldGoalSpot({ballOn:a.ballOn,possessing:s},e);a.possession=d.possession,a.ballOn=d.ballOn;const h={down:1,toGo:10};a.down=h.down,a.toGo=h.toGo;const w=t.formatTeamYardLine(a.possession,a.ballOn),g=t.randomHash(),$=`Field goal from ${e}, ${g} — no good. ${a.possession==="player"?"HOME":"AWAY"} ball at ${w}.`,f="Snap and hold were fine — just yanked it.";o.push({type:"log",message:`Brad: ${$}`}),o.push({type:"log",message:`Rob: ${f}`})}return o.push({type:"hud",payload:t.hudPayload(a)}),{state:a,events:o}}function be(n,e,s,t,o){const a=[];let i={...n};try{const r=o?.on||"defense",l=o?.yards||0,c=`${t.formatOrdinal(i.down)} & ${i.toGo}`,d=e==="accept"?`Penalty on ${r}, ${l} yards — accepted; now ${c}`:`Penalty on ${r}, ${l} yards — declined; play stands; now ${c}`;a.push({type:"log",message:d})}catch{}if(s.untimedDownScheduled&&(i.untimedDownScheduled=!0,a.push({type:"log",message:"Untimed down will be played due to defensive penalty."})),!i.gameOver&&!i.awaitingPAT){const r=!!i.untimedDownScheduled;if(i.clock===0&&!r){const l=i.quarter;a.push({type:"endOfQuarter",payload:{quarter:l}}),a.push({type:"log",message:`End of Q${l} — HOME ${i.score.player} — AWAY ${i.score.ai}`}),l===2?(a.push({type:"halftime"}),i.quarter=3,i.clock=900):l===4?(i.gameOver=!0,a.push({type:"final",payload:{score:i.score}})):(i.quarter=l+1,i.clock=900)}}return a.push({type:"hud",payload:t.hudPayload(i)}),{state:i,events:a}}function we(n,e,s){const t=[];let o={...n};const a=s.isLeading(e==="player"?"ai":"player",o.score),i=s.chooseSafetyFreeKick?.({leading:a})??"kickoff+25",r=e;if(i==="kickoff+25"){const l=r==="player"?"ai":"player",c=l==="player"?25:75;o.possession=l,o.ballOn=c;const d={down:1,toGo:10};o.down=d.down,o.toGo=d.toGo,t.push({type:"kickoff",payload:{onside:!1}})}else{const l=r==="player"?"ai":"player",c=l==="player"?35:65;o.possession=l,o.ballOn=c;const d={down:1,toGo:10};o.down=d.down,o.toGo=d.toGo,t.push({type:"kickoff",payload:{onside:!1}})}return t.push({type:"hud",payload:{quarter:o.quarter,clock:o.clock,down:o.down,toGo:o.toGo,ballOn:o.ballOn,possession:o.possession,score:{player:o.score.player,ai:o.score.ai}}}),{state:o,events:t}}function $e(n){return{quarter:n.quarter,clock:n.clock,down:n.down,toGo:n.toGo,ballOn:n.ballOn,possession:n.possession,score:{player:n.score.player,ai:n.score.ai}}}function x(n,e){return(n===2||n===4)&&e<=120}function z(n,e){return n==="player"?{playerDelta:e,aiDelta:0}:{playerDelta:0,aiDelta:e}}function Te(n){const e=A(n)+A(n);return(E[e]||{}).PAT==="G"}function ve(n){const e=n?.()||Math.random();return e<.45?"left hash":e<.9?"right hash":"middle"}function J(n,e){const s=e.player-e.ai;return(n==="player"?s:-s)>0}function Se(n,e){const s=e.player-e.ai;return(n==="player"?s:-s)<0}function Ge(n){return n.player===n.ai}function K(n){return n===1?"1st":n===2?"2nd":n===3?"3rd":`${Math.max(1,Math.min(4,n))}th`}function H(n){const e=Math.floor(Math.max(0,n)/60),s=Math.floor(Math.max(0,n)%60),t=s<10?`0${s}`:String(s);return`${e}:${t}`}function Pe(n,e){const s=n==="player"?e<=50:e>=50,t=n==="player"?e<=50?Math.max(1,e):Math.max(1,100-e):e>=50?Math.max(1,100-e):Math.max(1,e);return s?`their own ${t}`:`the ${t}`}function M(n,e){const s=t=>Math.max(1,Math.min(50,t));return n==="player"?e<=50?`HOME ${s(e)}`:`AWAY ${s(100-e)}`:e>=50?`AWAY ${s(100-e)}`:`HOME ${s(e)}`}function Oe(n,e,s,t,o=!1,a){if(o)return{timeOff:0,crossedTwoMinute:!1};const i=x(n.quarter,n.clock);let r=0,l=!1;if(e){const c=!a&&e.category==="gain"&&(e.yards||0)>0&&(e.yards||0)>=n.toGo;r=re(e,i,c,s||j)}return t==="hurry_up"||t==="no_huddle"?r=Math.max(5,Math.floor(r*.7)):t==="burn_clock"&&e&&(e.category==="gain"||e.category==="loss")&&(r=Math.max(r,35),r=Math.min(r,40)),(n.quarter===2||n.quarter===4)&&n.clock>120&&n.clock-r<120&&(r=n.clock-120,l=!0),{timeOff:r,crossedTwoMinute:l}}function Me(n,e){const s={...n};return s.clock=Math.max(0,n.clock-e.timeOff),s}function Ae(n,e){const s=n.quarter>=3,t=n.diff<0,o=n.diff>0;if(s&&n.clock<=300){if(t&&Math.abs(n.diff)<=8)return"hurry_up";if(o&&Math.abs(n.diff)<=14)return"burn_clock"}if(x(n.quarter,n.clock)){if(t)return"hurry_up";if(o)return"burn_clock"}return"normal"}class Le{constructor(e){this.ctx=e,this.tracker=new pe(this.ctx.rng)}tracker;resolveSnap(e,s){const t=[],o=!!e.untimedDownScheduled,a={...e},i=/punt/i.test(String(s.playLabel)),r=ie({state:a,charts:this.ctx.charts,deckName:s.deckName,playLabel:s.playLabel,defenseLabel:s.defenseLabel,rng:this.ctx.rng}),l=r.possessionChanged;if(this.beginDriveIfNeeded(a,t),r.outcome&&r.outcome.category==="penalty"&&r.outcome.penalty)return this.handlePenalty(a,r,t);let c={...r.state};const d=this.determineTempoForPlay(a),h=Oe(a,r.outcome,this.ctx.timeKeeping,d,o,l);if(c=Me(c,h),h.crossedTwoMinute&&(t.push({type:"log",message:"Two-minute warning."}),t.push({type:"vfx",payload:{kind:"twoMinute"}})),this.narratePlayResult(a,c,s,r,t,i),this.updateLastNotes(a,s),!c.gameOver&&!r.touchdown&&!r.safety&&i&&a.down===4){const w=ge(a,c,{rng:this.ctx.rng,formatTeamYardLine:(g,$)=>M(g,$),endDriveSummaryIfAny:(g,$,f)=>this.endDriveSummaryIfAny(g,$,f)});return{state:w.state,events:[...t,...w.events]}}return r.touchdown?this.handleTouchdown(a,c,t):r.safety?this.handleSafety(a,c,t):!c.gameOver&&!r.touchdown&&!r.safety&&!l&&this.isTurnoverOnDowns(a,r.outcome)?this.handleTurnoverOnDowns(a,c,t):!c.gameOver&&!c.awaitingPAT&&c.clock===0&&!c.untimedDownScheduled?this.handleQuarterTransition(c,t):(t.push({type:"hud",payload:this.hudPayload(c)}),{state:c,events:t})}finalizePenaltyDecision(e,s,t,o){return be(e,s,t,{formatOrdinal:a=>K(a),hudPayload:a=>this.hudPayload(a)},o)}resolvePATAndRestart(e,s){return me(e,s,{rng:()=>this.ctx.rng?.()||Math.random(),attemptPatInternal:t=>Te(t),scoringSideToDelta:(t,o)=>z(t,o),isTrailing:(t,o)=>Se(t,o),performKickoff:(t,o,a)=>this.performKickoff(t,o,a),...this.ctx.policy?.choosePAT?{choosePAT:this.ctx.policy.choosePAT.bind(this.ctx.policy)}:{},...this.ctx.policy?.chooseKickoffType?{chooseKickoffType:this.ctx.policy.chooseKickoffType.bind(this.ctx.policy)}:{}})}attemptFieldGoal(e,s,t){return ke(e,s,t,{rng:()=>this.ctx.rng?.()||Math.random(),attemptFieldGoalKick:(o,a)=>require("../../rules/special/PlaceKicking").attemptFieldGoalKick(o,a),scoringSideToDelta:(o,a)=>z(o,a),randomHash:()=>ve(this.ctx.rng),formatClock:o=>H(o),formatTeamYardLine:(o,a)=>M(o,a),performKickoff:(o,a,i)=>this.performKickoff(o,a,i),hudPayload:o=>this.hudPayload(o),timeKeepingFieldGoalSeconds:(this.ctx.timeKeeping||j).fieldgoal,missedFieldGoalSpot:(o,a)=>require("../../rules/Spots").missedFieldGoalSpot(o,a)})}resolveSafetyRestart(e,s){return we(e,s,{...this.ctx.policy?.chooseSafetyFreeKick?{chooseSafetyFreeKick:this.ctx.policy.chooseSafetyFreeKick.bind(this.ctx.policy)}:{},isLeading:(t,o)=>J(t,o)})}performKickoff(e,s,t){return ye(e,s,t,{rng:this.ctx.rng,timeKeeping:this.ctx.timeKeeping,isLeading:(o,a)=>J(o,a),isTied:o=>Ge(o),formatTeamYardLine:(o,a)=>M(o,a)})}beginDriveIfNeeded(e,s){this.tracker.beginDriveIfNeeded(e,s,(t,o)=>M(t,o))}endDriveSummaryIfAny(e,s,t){this.tracker.endDriveSummaryIfAny(e,s,t)}hudPayload(e){return $e(e)}determineTempoForPlay(e){const s=e.score.player-e.score.ai,t={quarter:e.quarter,clock:e.clock,diff:e.possession==="player"?s:-s,side:e.possession};return this.ctx.policy?.chooseTempo?this.ctx.policy.chooseTempo(t):Ae(t)}handlePenalty(e,s,t){const o=s.outcome,a=le({prePlayState:e,postPlayState:e,outcome:o,inTwoMinute:x(e.quarter,e.clock)}),i=o.penalty;if((i.on==="defense"?e.possession:e.possession==="player"?"ai":"player")==="ai"){const c=a.decisionHint==="decline"?"decline":"accept",d=this.finalizePenaltyDecision(c==="accept"?a.accepted:a.declined,c,a.adminMeta,{on:i.on,yards:i.yards}),h=d.state;return t.push(...d.events),t.push({type:"hud",payload:this.hudPayload(h)}),{state:h,events:t}}const l={side:"player",summary:{down:e.down,toGo:e.toGo,ballOn:e.ballOn,quarter:e.quarter,clock:e.clock,possession:e.possession},prePlay:{down:e.down,toGo:e.toGo,ballOn:e.ballOn},accepted:a.accepted,declined:a.declined,penalty:{on:i.on,yards:i.yards,firstDown:i.firstDown},meta:{halfDistanceCapped:a.adminMeta.halfDistanceCapped,measuredFromMidfieldForLG:a.adminMeta.measuredFromMidfieldForLG,spotBasis:a.adminMeta.spotBasis,untimedDownScheduled:a.adminMeta.untimedDownScheduled}};return t.push({type:"choice-required",choice:"penaltyAcceptDecline",data:l}),t.push({type:"hud",payload:this.hudPayload(e)}),{state:e,events:t}}narratePlayResult(e,s,t,o,a,i){try{if(!(i&&e.down===4)){const l=this.buildResultSummary(e,s,o.outcome,{td:!!o.touchdown,safety:!!o.safety},String(t.playLabel),String(t.defenseLabel));this.tracker.incrementPlayInDrive(),this.tracker.incrementRunOrPassByLabel(String(t.playLabel||""));const c=this.buildBroadcastCall(e,s,t,o.outcome);a.push({type:"log",message:`Brad: ${c.pbp}`}),c.analyst&&c.analyst.trim()&&a.push({type:"log",message:`Rob: ${c.analyst}`}),a.push({type:"log",message:"────────"})}}catch{}}updateLastNotes(e,s){try{const t=e.possession==="player"?100-e.ballOn:e.ballOn,o=e.ballOn,a=e.possession==="player"?o>=50:o<=50,i=o>=45&&o<=55,r=e.possession==="player"?o<=10:o>=90;let l=null;t<=10&&e.toGo>=t?l="GoalToGo":t<=20?l="RedZone":i?l="NearMid":a?l="AcrossMid":r&&(l="BackedUp");const c=t+17<=45;this.tracker.setLastNotesForSide(e.possession,{zone:l,fgInRange:c,defense:String(s.defenseLabel||"")})}catch{}}handleTouchdown(e,s,t){s.awaitingPAT=!0;const o=e.possession;t.push({type:"log",message:"Touchdown!"}),t.push({type:"score",payload:{...z(o,6),kind:"TD"}}),t.push({type:"vfx",payload:{kind:"td"}});const a=this.resolvePATAndRestart(s,o);return s=a.state,t.push(...a.events),t.push({type:"log",message:`Brad: Scoreboard — HOME ${s.score.player} — AWAY ${s.score.ai} — Q${s.quarter} ${H(s.clock)}`}),t.push({type:"log",message:"────────"}),this.endDriveSummaryIfAny(s,t,"touchdown"),{state:s,events:t}}handleSafety(e,s,t){const o=e.possession,a=o==="player"?"ai":"player";t.push({type:"log",message:"Brad: Safety!"}),t.push({type:"score",payload:{...z(a,2),kind:"Safety"}}),t.push({type:"log",message:`Brad: Scoreboard — HOME ${a==="player"?s.score.player+2:s.score.player} — AWAY ${a==="ai"?s.score.ai+2:s.score.ai} — safety awarded`});const i=this.resolveSafetyRestart(s,o);return s=i.state,t.push(...i.events),t.push({type:"log",message:"────────"}),this.endDriveSummaryIfAny(s,t,"safety"),{state:s,events:t}}isTurnoverOnDowns(e,s){return e.down!==4||!s?!1:s.category==="incomplete"||(s.category==="loss"||s.category==="gain")&&(s.yards||0)<e.toGo}handleTurnoverOnDowns(e,s,t){const o=M(e.possession,e.ballOn);return t.push({type:"log",message:`Brad: ${K(e.down)} & ${e.toGo} — stuffed — turnover on downs at ${o}`}),s.possession=e.possession==="player"?"ai":"player",s.down=1,s.toGo=10,this.endDriveSummaryIfAny(s,t,"downs"),t.push({type:"log",message:"────────"}),{state:s,events:t}}handleQuarterTransition(e,s){const t=e.quarter;s.push({type:"endOfQuarter",payload:{quarter:t}});try{const a=this.tracker.getQuarterStatsRef(),i=a.runs,r=a.passes,c=`${`End of Q${t} — HOME ${e.score.player} — AWAY ${e.score.ai}.`} Pace so far: ${i} runs, ${r} passes.`,d=i>r?"Ground games setting tone; watch for play action next quarter.":r>i?"Air it out approach; watch the pass rush fatigue.":"Balanced so far; both sides settling in.";s.push({type:"log",message:`Brad: ${c}`}),s.push({type:"log",message:`Rob: ${d}`})}catch{}const o=this.tracker.getQuarterStatsRef();if(o.quarter=t+1,o.runs=0,o.passes=0,o.pointsHome=0,o.pointsAway=0,o.explosives=0,o.turnovers=0,t===2){s.push({type:"halftime"}),s.push({type:"log",message:"Start of quarter 3."}),e.quarter=3,e.clock=900;const i=e.openingKickTo||"player",r=this.performKickoff(e,"normal",i);e=r.state,s.push(...r.events)}else t===4?(e.gameOver=!0,s.push({type:"final",payload:{score:e.score}})):(s.push({type:"log",message:`Brad: Start of quarter ${t+1}.`}),e.quarter=t+1,e.clock=900);return s.push({type:"log",message:"────────"}),{state:e,events:s}}buildBroadcastCall(e,s,t,o){return fe(e,s,t,o,{rng:this.ctx.rng,playInDrive:this.tracker.getPlayInDrive(),formatClock:a=>H(a),formatOrdinal:a=>K(a),formatTeamYardLine:(a,i)=>M(a,i),formatPossessionSpotForBroadcast:(a,i)=>Pe(a,i),quarterStats:this.tracker.getQuarterStatsRef()})}buildResultSummary(e,s,t,o,a,i){return he(e,s,t,o,a,i,{formatOrdinal:r=>K(r),formatTeamYardLine:(r,l)=>M(r,l),rng:()=>this.ctx.rng?.()||Math.random(),getLastNotesForSide:r=>this.tracker.getLastNotesForSide(r),setLastNotesForSide:(r,l)=>this.tracker.setLastNotesForSide(r,l)})}chooseCommentaryLines(e){return ue(e)}}class Fe{constructor(e){this.ctx=e,this.core=new Le(e)}core;resolveSnap(e,s){return this.core.resolveSnap(e,s)}finalizePenaltyDecision(e,s,t,o){return this.core.finalizePenaltyDecision(e,s,t,o)}resolvePATAndRestart(e,s){return this.core.resolvePATAndRestart(e,s)}attemptFieldGoal(e,s,t){return this.core.attemptFieldGoal(e,s,t)}resolveSafetyRestart(e,s){return this.core.resolveSafetyRestart(e,s)}performKickoff(e,s,t){return this.core.performKickoff(e,s,t)}}export{Fe as G,Ne as K,Be as P,qe as a};
//# sourceMappingURL=game-flow-PjC-A5UU.js.map
