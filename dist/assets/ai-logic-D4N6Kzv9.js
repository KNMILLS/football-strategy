const B="modulepreload",T=function(s){return"/"+s},x={},R=function(e,t,n){let o=Promise.resolve();if(t&&t.length>0){let p=function(u){return Promise.all(u.map(a=>Promise.resolve(a).then(_=>({status:"fulfilled",value:_}),_=>({status:"rejected",reason:_}))))};document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),l=i?.nonce||i?.getAttribute("nonce");o=p(t.map(u=>{if(u=T(u),u in x)return;x[u]=!0;const a=u.endsWith(".css"),_=a?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${_}`))return;const g=document.createElement("link");if(g.rel=a?"stylesheet":B,a||(g.as="script"),g.crossOrigin="",g.href=u,l&&g.setAttribute("nonce",l),document.head.appendChild(g),a)return new Promise((y,h)=>{g.addEventListener("load",y),g.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${u}`)))})}))}function f(i){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=i,window.dispatchEvent(l),!l.defaultPrevented)throw i}return o.then(i=>{for(const l of i||[])l.status==="rejected"&&f(l.reason);return e().catch(f)})},G={"Andy Reid":{name:"Andy Reid",aggression:.9,fourthDownBoost:.15,passBias:.15,twoPointAggressiveLate:!0,onsideAggressive:!0},"John Madden":{name:"John Madden",aggression:.6,fourthDownBoost:.08,passBias:.05,twoPointAggressiveLate:!1,onsideAggressive:!1},"Bill Belichick":{name:"Bill Belichick",aggression:.35,fourthDownBoost:0,passBias:-.05,twoPointAggressiveLate:!1,onsideAggressive:!1}},te=Object.freeze(Object.defineProperty({__proto__:null,COACH_PROFILES:G},Symbol.toStringTag,{value:"Module"}));function N(s){let e=s%2147483647;return e<=0&&(e+=2147483646),function(){return e=e*16807%2147483647,(e-1)/2147483646}}function F(s,e,t){return Math.max(e,Math.min(t,s))}function Q(s){return s<=1?1:s<=3?"2-3":s<=6?"4-6":s<=10?"7-10":s<=15?"11-15":"16+"}function C(s,e){const t=e?s:100-s;return t<=5?"own_gl":t<=19?"backed":t<=39?"own":t<=59?"mid":t<=79?"plus":"red"}function M(s,e){return e<=120?"two_min":s===4&&e<=360?"Q4-late":s===4?"Q4-early":s===3?"Q3":s===2?"Q2":"Q1"}function J(s,e){const t=s-e;if(t===0)return"tied";const n=Math.abs(t),o=n<=1?1:n<=3?"2-3":n<=7?"4-7":n<=14?"8-14":"15+";return t>0?`lead:${o}`:`trail:${o}`}function w(s){return`${s.down}|${s.dist}|${s.zone}|${s.score}|${s.clock}`}class K{offenseCounts=new Map;defenseCounts=new Map;decay;alpha;constructor(e){const t=Math.max(1,Math.floor(e?.halfLife??12));this.decay=Math.pow(.5,1/t),this.alpha=e?.alpha??.5}reset(){this.offenseCounts.clear(),this.defenseCounts.clear()}decayAll(e){for(const[t,n]of e){let o=0;for(const f of Object.keys(n)){const l=(n[f]??0)*this.decay;n[f]=l,o+=l}o<.001&&e.delete(t)}}stepDecay(){this.decayAll(this.offenseCounts),this.decayAll(this.defenseCounts)}recordOffense(e,t){const n=w(e),o=this.offenseCounts.get(n)||Object.create(null);o[t]=(o[t]||0)+1,this.offenseCounts.set(n,o)}recordDefense(e,t){const n=w(e),o=this.defenseCounts.get(n)||Object.create(null);o[t]=(o[t]||0)+1,this.defenseCounts.set(n,o)}predictOffense(e){const t=w(e),n=this.offenseCounts.get(t)||{},o=["run_mid","run_edge","pass_short","pass_deep","gadget"];let f=0;const i={run_mid:this.alpha,run_edge:this.alpha,pass_short:this.alpha,pass_deep:this.alpha,gadget:this.alpha};for(const a of o)i[a]+=n[a]||0,f+=i[a];const l=Object.fromEntries(o.map(a=>[a,(i[a]||0)/(f||1)])),u=1/(1+Object.values(n).reduce((a,_)=>a+(_||0),0));return{probs:l,uncertainty:u}}predictDefense(e){const t=w(e),n=this.defenseCounts.get(t)||{},o=["goal_line","short_yd","inside_blitz","outside_blitz","balanced","passing","prevent","prevent_deep"];let f=0;const i=Object.create(null);for(const a of o)i[a]=(n[a]||0)+this.alpha,f+=i[a];const l=Object.fromEntries(o.map(a=>[a,(i[a]||0)/(f||1)])),u=1/(1+Object.values(n).reduce((a,_)=>a+(_||0),0));return{probs:l,uncertainty:u}}buildKeyFromState(e,t){const n=F(e.down,1,4),o=Q(e.toGo),f=C(e.ballOn,t),i=M(e.quarter,e.clock),l=e.score[e.possession==="player"?"player":"ai"],p=e.score[e.possession==="player"?"ai":"player"],u=J(l,p);return{down:n,dist:o,zone:f,score:u,clock:i}}}function D(s){const e=s.toLowerCase();return/reverse|razzle|flea|double pass|end around/.test(e)?"gadget":/end run|outside|sweep|toss/.test(e)?"run_edge":/long bomb|deep|post|corner|stop & go|streak/.test(e)?"pass_deep":/pass|hook|look in|sideline|flair|flare|pop|button|down & (in|out)|screen|quick|slant/.test(e)?"pass_short":"run_mid"}function P(s){const e=s.toLowerCase();return/goal line/.test(e)?"goal_line":/short yardage/.test(e)?"short_yd":/inside blitz/.test(e)?"inside_blitz":/outside blitz/.test(e)?"outside_blitz":/prevent deep/.test(e)?"prevent_deep":/prevent/.test(e)?"prevent":/passing/.test(e)?"passing":"balanced"}function k(s,e,t){return Math.max(e,Math.min(t,s))}function W(s,e,t,n){const o=e.getWhiteSignRestriction(s);return o==null?!0:(t.possession==="player"===n?100-t.ballOn:t.ballOn)>o}function z(s,e,t){const n=Math.max(.05,t),o=e.map(p=>Math.exp(k(p.util,-1,1)/n)),f=o.reduce((p,u)=>p+u,0)||1,i=s()*f;let l=0;for(let p=0;p<e.length;p++){const u=o[p]||0;if(i>=l&&i<l+u)return e[p].item;l+=u}return e[e.length-1].item}function L(s,e){const t=s.ballOn;return e?t<=50?`OWN ${Math.max(1,t)}`:`OPP ${Math.max(1,100-t)}`:t>=50?`OWN ${Math.max(1,100-t)}`:`OPP ${Math.max(1,t)}`}class se{constructor(e,t){this.deps=e,this.playerIsHome=t}rng=Math.random;model=new K({halfLife:12,alpha:.5});lastOffenseCalls=[];lastDefenseCalls=[];personality={aggressiveness_offense:.5,aggressiveness_defense:.5,trick_play_rate:.02,blitz_rate_base:.18,deception_bias:.25,tempo_preference:"normal",risk_tolerance_late:.6};async loadPersonality(e){try{let t={};try{const n=await R(()=>import("./playcaller.config-DWG2L_TX.js"),[]).catch(()=>null);t=n&&(n.default||n)||{}}catch{}this.personality={...this.personality,...t}}catch{}e&&(this.personality={...this.personality,...e})}reset(e){this.rng=N(e),this.model.reset(),this.lastOffenseCalls=[],this.lastDefenseCalls=[]}stepDecay(){this.model.stepDecay()}add_observation(e,t,n){const o=e.possession==="player"===this.playerIsHome,f=this.model.buildKeyFromState(e,o);this.model.recordOffense(f,D(t)),this.model.recordDefense(f,P(n))}choose_offense_play(e,t){const n=this.deps.getOffenseHand().filter(r=>(r.type==="run"||r.type==="pass")&&W(r.label,this.deps,e,this.playerIsHome)),o=e.possession==="player"===this.playerIsHome,f=this.model.buildKeyFromState(e,o),i=this.model.predictDefense(f),l=M(e.quarter,e.clock),p=C(e.ballOn,o),u=e.down===3&&e.toGo>=6||e.down===4||e.quarter===4&&e.clock<=360,a=this.personality.tempo_preference==="hurry"?.7:this.personality.tempo_preference==="chew"?.5:.6,_=k(a*(u?.6:1),.2,1.2),g=.03,y=n.map(r=>{const c=D(r.label),d=i.probs;let m=0;c==="run_mid"?m=.2*(d.passing+d.prevent+d.prevent_deep)+-.3*(d.goal_line+d.short_yd+d.inside_blitz):c==="run_edge"?m=.15*(d.passing+d.balanced)+-.25*(d.short_yd+d.outside_blitz):c==="pass_short"?m=.25*(d.balanced+d.passing)+-.25*(d.inside_blitz+d.outside_blitz+d.goal_line):c==="pass_deep"?m=.35*d.passing+-.5*(d.prevent+d.prevent_deep):c==="gadget"&&(m=.15*(1-d.short_yd)+-.2*d.goal_line);let b=0;const O=e.toGo<=2,S=e.toGo>=8;O&&(c==="run_mid"||c==="run_edge"||/keeper|slant|off tackle/i.test(r.label))&&(b+=.25),S&&(c==="pass_short"||c==="pass_deep")&&(b+=.2),(p==="own_gl"||p==="backed")&&(c==="pass_deep"||c==="gadget")&&(b-=.3),p==="red"&&e.down===1&&c==="run_mid"&&(b+=.05);const v=this.lastOffenseCalls.slice(-2).filter(j=>j===r.label).length,$=v>=2?-.5:v===1?-.2:0,I=(1-i.uncertainty)*this.personality.deception_bias*(Math.random()<.5?1:-1)*.1,A=e.score[e.possession==="player"?"player":"ai"],H=e.score[e.possession==="player"?"ai":"player"],E=e.quarter===4&&e.clock<=300&&A>H&&(c==="pass_deep"||c==="gadget")?.25:0,q=k(.45*m+.3*b+.15*$+.1*I-.4*E,-1,1);return{item:{deckName:t,playLabel:r.label},util:q}});let h;if(this.rng()<g){const r=Math.floor(this.rng()*Math.max(1,y.length));h=y[Math.min(r,y.length-1)].item}else h=z(this.rng,y,_);this.lastOffenseCalls.push(h.playLabel),this.lastOffenseCalls.length>8&&this.lastOffenseCalls.shift();try{if((()=>{try{if(typeof localStorage<"u")return localStorage.getItem("gs_dev_mode")==="1"}catch{}try{return!!globalThis.GS?.__devMode?.enabled}catch{}return!1})()){const c=e.possession==="player"===this.playerIsHome,d={drive:void 0,quarter:e.quarter,clock:`${String(Math.floor(e.clock/60)).padStart(1,"0")}:${String(e.clock%60).padStart(2,"0")}`,score:{us:e.score[e.possession==="player"?"player":"ai"],them:e.score[e.possession==="player"?"ai":"player"]},down:e.down,to_go:e.toGo,yardline:L(e,c),phase:l,field_zone:p,opponent_pred:i.probs,uncertainty:i.uncertainty,candidates:y.map(m=>({call:m.item.playLabel,utility:Number(m.util.toFixed(3))})),temp:_,epsilon:g,chosen:h.playLabel,personality:{agg_off:this.personality.aggressiveness_offense,deception:this.personality.deception_bias,trick_rate:this.personality.trick_play_rate}};globalThis.GS?.bus?.emit?.("qa:debug",{text:JSON.stringify(d)})}}catch{}return h}choose_defense_play(e){const t=this.deps.getDefenseOptions(),n=e.possession==="player"===this.playerIsHome,o=this.model.buildKeyFromState(e,n),f=this.model.predictOffense(o),i=M(e.quarter,e.clock),l=C(e.ballOn,n),p=t.map(y=>{const h=P(y),r=f.probs;let c=0;h==="goal_line"||h==="short_yd"?c=.35*(r.run_mid+r.run_edge)+-.25*r.pass_deep:h==="inside_blitz"||h==="outside_blitz"?c=.25*r.pass_short+-.25*r.gadget:h==="passing"?c=.35*(r.pass_short+r.pass_deep)+-.2*r.run_mid:h==="prevent_deep"?c=.5*r.pass_deep+-.35*(r.run_mid+r.run_edge):h==="prevent"?c=.35*r.pass_deep+-.2*r.run_mid:c=.2*(r.run_mid+r.run_edge+r.pass_short)-.05*r.gadget;let d=0;e.toGo<=2&&(h==="goal_line"||h==="short_yd"||h==="inside_blitz")&&(d+=.2),l==="red"&&(h==="goal_line"||h==="short_yd")&&(d+=.1),e.quarter===4&&e.clock<=120&&h==="prevent_deep"&&(d+=.25);const b=this.lastDefenseCalls.slice(-2).filter(v=>v===y).length,O=b>=2?-.4:b===1?-.15:0,S=k(.6*c+.3*d+.1*O,-1,1);return{item:{label:y},util:S}}),a=e.down===3&&e.toGo>=8||e.quarter===4&&e.clock<=120?.45:.65,_=.02+.1*f.uncertainty;let g;if(this.rng()<_){const y=Math.floor(this.rng()*Math.max(1,p.length));g=p[Math.min(y,p.length-1)].item}else g=z(this.rng,p,a);this.lastDefenseCalls.push(g.label),this.lastDefenseCalls.length>8&&this.lastDefenseCalls.shift();try{if((()=>{try{if(typeof localStorage<"u")return localStorage.getItem("gs_dev_mode")==="1"}catch{}try{return!!globalThis.GS?.__devMode?.enabled}catch{}return!1})()){const h=e.possession==="player"===this.playerIsHome,r={quarter:e.quarter,clock:`${String(Math.floor(e.clock/60)).padStart(1,"0")}:${String(e.clock%60).padStart(2,"0")}`,score:{us:e.score[e.possession==="player"?"player":"ai"],them:e.score[e.possession==="player"?"ai":"player"]},down:e.down,to_go:e.toGo,yardline:L(e,h),phase:i,field_zone:l,opponent_pred:f.probs,uncertainty:f.uncertainty,candidates:p.map(c=>({call:c.item.label,utility:Number(c.util.toFixed(3))})),temp:a,epsilon:_,chosen:g.label,personality:{agg_def:this.personality.aggressiveness_defense}};globalThis.GS?.bus?.emit?.("qa:debug",{text:JSON.stringify(r)})}}catch{}return g}}export{te as C,se as P,R as _,N as c};
//# sourceMappingURL=ai-logic-D4N6Kzv9.js.map
