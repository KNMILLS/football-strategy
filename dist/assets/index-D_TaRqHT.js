const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/offenseCharts-Cs8xlLcW.js","assets/http-B_bVN8Ck.js","assets/matchupTables-C8SyztAM.js","assets/validators-BtKpG0wR.js","assets/penaltyTables-CtArJ56i.js","assets/tables-CJNVkz7O.js"])))=>i.map(i=>d[i]);
(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function t(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(a){if(a.ep)return;a.ep=!0;const o=t(a);fetch(a.href,o)}})();const ut="modulepreload",pt=function(s){return"/"+s},be={},C=function(e,t,n){let a=Promise.resolve();if(t&&t.length>0){let l=function(c){return Promise.all(c.map(d=>Promise.resolve(d).then(u=>({status:"fulfilled",value:u}),u=>({status:"rejected",reason:u}))))};document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),r=i?.nonce||i?.getAttribute("nonce");a=l(t.map(c=>{if(c=pt(c),c in be)return;be[c]=!0;const d=c.endsWith(".css"),u=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${u}`))return;const m=document.createElement("link");if(m.rel=d?"stylesheet":ut,d||(m.as="script"),m.crossOrigin="",m.href=c,r&&m.setAttribute("nonce",r),document.head.appendChild(m),d)return new Promise((y,w)=>{m.addEventListener("load",y),m.addEventListener("error",()=>w(new Error(`Unable to preload CSS for ${c}`)))})}))}function o(i){const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=i,window.dispatchEvent(r),!r.defaultPrevented)throw i}return a.then(i=>{for(const r of i||[])r.status==="rejected"&&o(r.reason);return e().catch(o)})},ue={1:"+50 and (+10 x 1D6)",2:"+50",3:"+45",4:"+40",5:"+35",6:"+30"};function I(s){return Math.floor(s()*6)+1}function H(s){const e=I(s),t=ue[e];if(!t)return 30;if(t.includes("and"))return 50+I(s)*10;const n=t.match(/\+(\d+)/);return n&&n[1]?parseInt(n[1],10):30}function qe(s){const e=I(s),t=[e],n=ue[e];let a;if(!n)a=30;else if(n.includes("and")){const o=I(s);t.push(o),a=50+o*10}else{const o=n.match(/\+(\d+)/);a=o&&o[1]?parseInt(o[1],10):30}return{result:a,diceRolls:t}}const ht=Object.freeze(Object.defineProperty({__proto__:null,LONG_GAIN_TABLE:ue,resolveLongGain:H,resolveLongGainWithDice:qe,rollD6:I},Symbol.toStringTag,{value:"Module"})),ie={2:"FUMBLE*",3:"PENALTY -10*",4:10,5:15,6:20,7:25,8:30,9:35,10:40,11:"LG",12:"LG + 5"},ze={1:{possession:"kicker",yard:40},2:{possession:"kicker",yard:40},3:{possession:"receiver",yard:35},4:{possession:"receiver",yard:35},5:{possession:"receiver",yard:35},6:{possession:"receiver",yard:30}};function He(s,e){return typeof s=="number"?{yardLine:s,turnover:!1}:s==="LG"?{yardLine:Math.min(H(e),50),turnover:!1}:s==="LG + 5"?{yardLine:Math.min(H(e)+5,50),turnover:!1}:{yardLine:25,turnover:!1}}function Ue(s,e){if(e.onside){let l=I(s);e.kickerLeadingOrTied&&(l=Math.min(6,l+1));const c=ze[l]||{possession:"receiver",yard:35};return{yardLine:c.yard,turnover:c.possession==="kicker"}}let t=I(s)+I(s),n=ie[t],a=!1,o=!1;if(typeof n=="string"&&n.includes("*")){/FUMBLE/i.test(n)&&(a=!0),/PENALTY/i.test(n)&&(o=!0),n=n.replace("*","").trim();const l=I(s)+I(s);let c=ie[l];typeof c=="string"&&c.includes("*")&&(/FUMBLE/i.test(c)&&(a=!1),/PENALTY/i.test(c)&&(o=!1),c=c.replace("*","").trim()),n=c}const i=He(n,s);let r=i.yardLine;return o&&(r=Math.max(0,i.yardLine-10)),{yardLine:r,turnover:a}}const yt=Object.freeze(Object.defineProperty({__proto__:null,NORMAL_KICKOFF_TABLE:ie,ONSIDE_KICK_TABLE:ze,parseKickoffYardLine:He,resolveKickoff:Ue},Symbol.toStringTag,{value:"Module"})),Ke={2:30,3:35,4:38,5:40,6:42,7:43,8:44,9:46,10:48,11:50,12:52},Ye={2:{type:"LG"},3:{yards:20},4:{yards:15},5:{yards:12},6:{yards:10},7:{yards:8},8:{yards:6},9:{yards:5},10:{yards:3},11:{yards:0},12:{type:"FC"}};function Y(s){return Math.floor(s()*6)+1}function je(s,e,t){const n=s.puntingTeam==="player",a=Y(e)+Y(e),o=Ke[a]??40;let i=s.ballOn+(n?o:-o);if(i>100||i<0||i===100||i===0)return{ballOn:(n?"ai":"player")==="player"?20:80,possessionFlips:!0,fumbleRecoveredByKickingTeam:!1,touchback:!0,distance:o,returnYards:0,returnType:"YDS"};const r=Y(e)+Y(e),l=Ye[r]||{yards:0};let c=0,d=!1;return l.type==="FC"?c=0:l.type==="LG"?c=t(e):(c=l.yards||0,r<=4&&e()<.15&&(d=e()<.5)),n?i-=c:i+=c,i=Math.max(0,Math.min(100,i)),d?{ballOn:i,possessionFlips:!1,fumbleRecoveredByKickingTeam:!0,touchback:!1,distance:o,returnYards:c,returnType:l.type?l.type:"YDS"}:{ballOn:i,possessionFlips:!0,fumbleRecoveredByKickingTeam:!1,touchback:!1,distance:o,returnYards:c,returnType:l.type?l.type:"YDS"}}const gt=Object.freeze(Object.defineProperty({__proto__:null,PUNT_DISTANCE_TABLE:Ke,PUNT_RETURN_TABLE:Ye,resolvePunt:je,rollD6:Y},Symbol.toStringTag,{value:"Module"})),te={2:{PAT:"NG","1-12":"NG","13-22":"NG","23-32":"G","33-38":"G","39-45":"G"},3:{PAT:"G","1-12":"NG","13-22":"NG","23-32":"NG","33-38":"G","39-45":"NG"},4:{PAT:"G","1-12":"G","13-22":"NG","23-32":"NG","33-38":"NG","39-45":"NG"},5:{PAT:"G","1-12":"G","13-22":"G","23-32":"NG","33-38":"NG","39-45":"NG"},6:{PAT:"G","1-12":"G","13-22":"G","23-32":"G","33-38":"NG","39-45":"NG"},7:{PAT:"G","1-12":"G","13-22":"G","23-32":"G","33-38":"G","39-45":"NG"},8:{PAT:"G","1-12":"G","13-22":"G","23-32":"G","33-38":"NG","39-45":"NG"},9:{PAT:"G","1-12":"G","13-22":"G","23-32":"NG","33-38":"NG","39-45":"NG"},10:{PAT:"G","1-12":"G","13-22":"G","23-32":"NG","33-38":"NG","39-45":"NG"},11:{PAT:"G","1-12":"G","13-22":"NG","23-32":"NG","33-38":"G","39-45":"NG"},12:{PAT:"NG","1-12":"NG","13-22":"G","23-32":"G","33-38":"G","39-45":"G"}};function B(s){return Math.floor(s()*6)+1}function mt(s){const e=B(s)+B(s);return(te[e]||{}).PAT==="G"}function We(s,e){const t=Math.round(e);let n=null;if(t<=12?n="1-12":t<=22?n="13-22":t<=32?n="23-32":t<=38?n="33-38":t<=45?n="39-45":n=null,!n)return!1;const a=B(s)+B(s);return(te[a]||{})[n]==="G"}const bt=Object.freeze(Object.defineProperty({__proto__:null,PLACE_KICK_TABLE:te,attemptFieldGoal:We,attemptPAT:mt,rollD6:B},Symbol.toStringTag,{value:"Module"})),x={gain0to20:30,gain20plus:45,loss:30,outOfBounds:15,incomplete:15,interception:30,penalty:15,fumble:15,kickoff:15,fieldgoal:15,punt:15,extraPoint:0};function wt(s,e,t){return ee(s,e,t).outcome}function ee(s,e,t){const n={yards:0,penalty:null,turnover:!1,interceptReturn:0,firstDown:!1};let a;if(!s)return{outcome:n};const o=s.trim();if(n.raw=o,n.outOfBounds=/O\/?B/i.test(o),/Incomplete/i.test(o))return n.category="incomplete",{outcome:n};if(/FUMBLE/i.test(o))return n.turnover=!0,n.category="fumble",{outcome:n};if(/INTERCEPT/i.test(o)){n.turnover=!0,n.category="interception";const l=o.match(/[+-]?\d+/);return l&&(n.interceptReturn=parseInt(l[0],10)),{outcome:n}}if(/PENALTY/i.test(o)){const l=o.match(/[+-]\d+/),c=l?parseInt(l[0],10):0,d=c>0;return n.penalty={on:d?"defense":"offense",yards:Math.abs(c),firstDown:/1st\s*Down/i.test(o)},n.category="penalty",{outcome:n}}if(/Sack/i.test(o)){const l=o.match(/-\d+/);return l&&(n.yards=parseInt(l[0],10)),n.category="loss",{outcome:n}}if(/LG/.test(o)){const l=qe(t);return n.yards=l.result,n.category="gain",a=l.diceRolls,{outcome:n,diceRolls:a}}const i=o.match(/[+-]?\d+/);if(i)return n.yards=parseInt(i[0],10),n.category=n.yards<0?"loss":"gain",{outcome:n};const r=o.match(/Complete\s*[+-]\d+/i);if(r){const l=r[0].match(/[+-]\d+/);return l&&(n.yards=parseInt(l[0],10)),n.category=n.yards<0?"loss":"gain",{outcome:n}}return n.category="other",{outcome:n}}function Qe(s,e=x){if(!s)return e.gain0to20;if(s.outOfBounds)return e.outOfBounds;switch(s.category){case"incomplete":return e.incomplete;case"interception":return e.interception;case"fumble":return e.fumble;case"penalty":return e.penalty;case"loss":return e.loss;case"gain":return Math.abs(s.yards)>20?e.gain20plus:e.gain0to20;default:return e.gain0to20}}const kt=Object.freeze(Object.defineProperty({__proto__:null,DEFAULT_TIME_KEEPING:x,calculateTimeOff:Qe,parseResultString:wt,parseResultStringWithDice:ee},Symbol.toStringTag,{value:"Module"}));function pe(s,e,t,n=x){let a=Qe(s,n);if(e){const o=s.category==="incomplete",i=!!s.outOfBounds;(o||i||t)&&(a=0)}return a}const vt=Object.freeze(Object.defineProperty({__proto__:null,timeOffWithTwoMinute:pe},Symbol.toStringTag,{value:"Module"}));var we={};class he{config;constructor(e={}){this.config={enabled:!1,logLevel:"off",outputDestination:"console",privacyMode:"production",maxEventsPerGame:1e4,batchSize:100,flushInterval:5e3,fileName:`telemetry_${Date.now()}.ndjson`,enableSessionTracking:!0,customFilters:[],...this.getEnvironmentDefaults(),...e}}isEnabled(){return this.config.enabled}getLogLevel(){return this.config.logLevel}getOutputDestination(){return this.config.outputDestination}getPrivacyMode(){return this.config.privacyMode}getMaxEventsPerGame(){return this.config.maxEventsPerGame||1e4}getMaxEvents(){return this.getMaxEventsPerGame()}getBatchSize(){return this.config.batchSize||100}getFlushInterval(){return this.config.flushInterval||5e3}getFileName(){return this.config.fileName||`telemetry_${Date.now()}.ndjson`}isSessionTrackingEnabled(){return this.config.enableSessionTracking!==!1}getCustomFilters(){return this.config.customFilters||[]}updateConfig(e){this.config={...this.config,...e}}enable(e={}){this.config.enabled=!0,this.updateConfig(e)}disable(){this.config.enabled=!1,this.config.logLevel="off"}setLogLevel(e){this.config.logLevel=e,e==="off"?this.config.enabled=!1:this.config.enabled=!0}setOutputDestination(e){this.config.outputDestination=e}setPrivacyMode(e){this.config.privacyMode=e}getNdJsonLoggerConfig(){return{logLevel:this.config.logLevel,fileName:this.config.fileName,enableBatching:this.config.outputDestination==="file",flushInterval:this.config.flushInterval}}getConfig(){return{...this.config}}static fromEnvironment(){const e=typeof process<"u"?we:{},t={};if(e.TELEMETRY_ENABLED==="true"?t.enabled=!0:e.TELEMETRY_ENABLED==="false"&&(t.enabled=!1),e.TELEMETRY_LOG_LEVEL){const n=e.TELEMETRY_LOG_LEVEL.toLowerCase();["off","debug","production"].includes(n)&&(t.logLevel=n)}if(e.TELEMETRY_OUTPUT){const n=e.TELEMETRY_OUTPUT.toLowerCase();["console","file","memory"].includes(n)&&(t.outputDestination=n)}if(e.TELEMETRY_PRIVACY_MODE){const n=e.TELEMETRY_PRIVACY_MODE.toLowerCase();["development","production"].includes(n)&&(t.privacyMode=n)}if(e.TELEMETRY_MAX_EVENTS){const n=parseInt(e.TELEMETRY_MAX_EVENTS,10);!isNaN(n)&&n>0&&(t.maxEventsPerGame=n)}if(e.TELEMETRY_BATCH_SIZE){const n=parseInt(e.TELEMETRY_BATCH_SIZE,10);!isNaN(n)&&n>0&&(t.batchSize=n)}if(e.TELEMETRY_FLUSH_INTERVAL){const n=parseInt(e.TELEMETRY_FLUSH_INTERVAL,10);!isNaN(n)&&n>0&&(t.flushInterval=n)}return new he(t)}getEnvironmentDefaults(){return typeof process<"u"&&we.VITEST?{enabled:!0,logLevel:"debug",privacyMode:"development"}:{enabled:!1,logLevel:"off",privacyMode:"production"}}}const ke=he.fromEnvironment();class _t{listeners={};on(e,t){const n=this.listeners[e]||=[];return n.push(t),()=>{const a=n.indexOf(t);a>=0&&n.splice(a,1)}}emit(e,t){const n=this.listeners[e];if(n)for(const a of n)a(t)}}class St{constructor(e,t){this.eventBus=e,this.config=t,this.sessionId=this.generateSessionId(),this.gameId=this.generateGameId(),this.isEnabled=t.isEnabled()}events=[];sessionId;gameId;eventCounter=0;isEnabled=!1;startNewGame(){this.isEnabled&&(this.gameId=this.generateGameId(),this.eventCounter=0,this.events=[],this.setupEventListeners())}stopCollection(){return this.isEnabled?(this.cleanupEventListeners(),[...this.events]):[]}recordDiceRoll(e){if(!this.isEnabled||this.config.getMaxEvents&&this.events.length>=this.config.getMaxEvents())return;const t={timestamp:Date.now(),eventId:this.generateEventId(),sessionId:this.sessionId,gameId:this.gameId,eventType:"dice_roll",...e};this.events.push(t)}recordOutcomeDetermined(e){if(!this.isEnabled||this.config.getMaxEvents&&this.events.length>=this.config.getMaxEvents())return;const t={timestamp:Date.now(),eventId:this.generateEventId(),sessionId:this.sessionId,gameId:this.gameId,eventType:"outcome_determined",...e};this.events.push(t)}recordPenaltyAssessed(e){if(!this.isEnabled||this.config.getMaxEvents&&this.events.length>=this.config.getMaxEvents())return;const t={timestamp:Date.now(),eventId:this.generateEventId(),sessionId:this.sessionId,gameId:this.gameId,eventType:"penalty_assessed",...e};this.events.push(t)}recordPlayResolved(e){if(!this.isEnabled||this.config.getMaxEvents&&this.events.length>=this.config.getMaxEvents())return;const t={timestamp:Date.now(),eventId:this.generateEventId(),sessionId:this.sessionId,gameId:this.gameId,eventType:"play_resolved",...e};this.events.push(t)}recordGameStateChange(e){if(!this.isEnabled||this.config.getMaxEvents&&this.events.length>=this.config.getMaxEvents())return;const t={timestamp:Date.now(),eventId:this.generateEventId(),sessionId:this.sessionId,gameId:this.gameId,eventType:"game_state_change",...e};this.events.push(t)}recordScoringEvent(e){if(!this.isEnabled||this.config.getMaxEvents&&this.events.length>=this.config.getMaxEvents())return;const t={timestamp:Date.now(),eventId:this.generateEventId(),sessionId:this.sessionId,gameId:this.gameId,eventType:"scoring_event",...e};this.events.push(t)}recordTimeUpdate(e){if(!this.isEnabled||this.config.getMaxEvents&&this.events.length>=this.config.getMaxEvents())return;const t={timestamp:Date.now(),eventId:this.generateEventId(),sessionId:this.sessionId,gameId:this.gameId,eventType:"time_update",...e};this.events.push(t)}recordPossessionChange(e){if(!this.isEnabled||this.config.getMaxEvents&&this.events.length>=this.config.getMaxEvents())return;const t={timestamp:Date.now(),eventId:this.generateEventId(),sessionId:this.sessionId,gameId:this.gameId,eventType:"possession_change",...e};this.events.push(t)}getEvents(){return[...this.events]}clearEvents(){this.events=[],this.eventCounter=0}setupEventListeners(){this.eventBus.on("ui:diceResult",e=>{this.recordDiceRoll({playLabel:e.outcome?.playLabel||"unknown",defenseLabel:e.outcome?.defenseLabel||"unknown",deckName:e.outcome?.deckName||"unknown",diceResult:e.diceResult,chartKey:e.outcome?.chartKey,defenseKey:e.outcome?.defenseKey})}),this.eventBus.on("playResolved",e=>{})}cleanupEventListeners(){}generateSessionId(){return`session_${Date.now()}_${this.eventCounter}`}generateGameId(){return`game_${Date.now()}_${this.eventCounter}`}generateEventId(){return`evt_${this.eventCounter++}_${Date.now()}`}}const Ve={1:"A",2:"B",3:"C",4:"D",5:"E",6:"F",7:"G",8:"H",9:"I",0:"J"},Ze={"Goal Line":1,"Short Yardage":2,"Inside Blitz":3,Running:4,"Run & Pass":5,"Pass & Run":6,Passing:7,"Outside Blitz":8,Prevent:9,"Prevent Deep":0},Je={"Pro Style":"ProStyle","Ball Control":"BallControl","Aerial Style":"AerialStyle"},Xe={"Run & Pass Option":"Run/Pass Option","Sideline Pass":"Side Line Pass"};let j=null;function Tt(s){ke.isEnabled()&&(j=new St(s,ke))}function et(){return j}function tt(s){const{deckName:e,playLabel:t,defenseLabel:n,charts:a,rng:o}=s,i=Je[e]||e,r=Xe[t]||t,l=Ze[n],c=l!=null?Ve[l]:void 0,d=a?.[i],u=d?d[r]:void 0,m=c&&u?u[c]:null;if(j&&m){const y=ee(m,H,o);if(y.diceRolls&&y.diceRolls.length>0){const w=y.diceRolls,p=w[0]||0,b=w[1]||p,h=w.reduce((k,S)=>k+S,0),g=p===b&&w.length>1;j.recordDiceRoll({playLabel:t,defenseLabel:n,deckName:e,diceResult:{d1:p,d2:b,sum:h,isDoubles:g},chartKey:String(i),...c?{defenseKey:c}:{}})}return j.recordOutcomeDetermined({playLabel:t,defenseLabel:n,deckName:e,outcome:{category:y.outcome.category||"other",yards:y.outcome.yards,penalty:y.outcome.penalty||void 0,interceptReturn:y.outcome.interceptReturn,resultString:m||void 0}}),y.outcome}return ee(m,H,o).outcome}const Ot=Object.freeze(Object.defineProperty({__proto__:null,DECK_NAME_TO_CHART_KEY:Je,DEF_LABEL_TO_NUM:Ze,DEF_NUM_TO_LETTER:Ve,LABEL_TO_CHART_KEY:Xe,determineOutcomeFromCharts:tt,getTelemetryCollector:et,initializeTelemetry:Tt},Symbol.toStringTag,{value:"Module"}));function nt(s){const e=s.quarter===4&&s.clock<=300;let t=s.diff>0&&s.diff<=2;return s.coach.twoPointAggressiveLate&&s.diff<0&&s.diff===-1&&e&&(t=!0),t}function Pt(s,e){return nt(s)?{aiPoints:e()<.5?2:0}:{aiPoints:e()<.98?1:0}}const $t=Object.freeze(Object.defineProperty({__proto__:null,performPAT:Pt,shouldGoForTwo:nt},Symbol.toStringTag,{value:"Module"})),Gt={"Andy Reid":{name:"Andy Reid",aggression:.9,fourthDownBoost:.15,passBias:.15,twoPointAggressiveLate:!0,onsideAggressive:!0,playbookPreferences:{"West Coast":.6,Spread:.95,"Air Raid":.9,Smashmouth:.3,"Wide Zone":.7},riskTolerance:.8,clockManagementAggression:.9},"John Madden":{name:"John Madden",aggression:.6,fourthDownBoost:.08,passBias:.05,twoPointAggressiveLate:!1,onsideAggressive:!1,playbookPreferences:{"West Coast":.9,Spread:.5,"Air Raid":.4,Smashmouth:.85,"Wide Zone":.8},riskTolerance:.5,clockManagementAggression:.5},"Bill Belichick":{name:"Bill Belichick",aggression:.35,fourthDownBoost:0,passBias:-.05,twoPointAggressiveLate:!1,onsideAggressive:!1,playbookPreferences:{"West Coast":.8,Spread:.2,"Air Raid":.1,Smashmouth:.9,"Wide Zone":.95},riskTolerance:.2,clockManagementAggression:.3}},Mt=Object.freeze(Object.defineProperty({__proto__:null,COACH_PROFILES:Gt},Symbol.toStringTag,{value:"Module"}));function Et(s,e){for(const t of e)if(s<=t.max_yd)return t.p_make;return 0}function Lt(s,e){const t=s.baseline;return{makeProb(n,a){let o=Et(Math.round(n),t);const i=Math.abs(a.wind_mph??0),r=(a.wind_mph??0)>0?1:(a.wind_mph??0)<0?-1:0;r>0&&(o+=s.adjustments.wind_head_per_10mph*(i/10)),r<0&&(o+=s.adjustments.wind_tail_per_10mph*(i/10)),a.surface==="grass"&&(o+=0);const l=a.kicker??"avg";return l==="elite"&&(o+=s.adjustments.elite_kicker_bonus),l==="weak"&&(o+=s.adjustments.weak_kicker_malus),Math.max(0,Math.min(1,o))}}}function st(){const e=Lt({baseline:[{max_yd:29,p_make:.97},{max_yd:39,p_make:.92},{max_yd:49,p_make:.82},{max_yd:55,p_make:.68},{max_yd:60,p_make:.5},{max_yd:66,p_make:.32}],adjustments:{wind_head_per_10mph:-.05,wind_tail_per_10mph:.03,altitude_high:.03,wet_surface:-.03,elite_kicker_bonus:.04,weak_kicker_malus:-.04}});function t(o){const i=o.fgModel||e,r=o.yardline_100,l=o.distance_to_go_yd,c=100-r+17,d=i.makeProb(c,{}),u=o.quarter===1||o.quarter===2&&o.time_remaining_sec>300||o.quarter===3&&o.time_remaining_sec>300,m=(o.quarter===2||o.quarter===4)&&o.time_remaining_sec<=300,y=o.time_remaining_sec<=120,w=o.score_diff<0;if(u){if(r<=40)return l<=1?"punt":l<=2&&r>=35&&d>=.75?"field_goal":"punt";if(r>=41&&r<=59)return l<=2||l<=4?"go_for_it":"punt";if(r>=60&&r<=69)return l<=2||l<=5?"go_for_it":d>=.75?"field_goal":"punt";if(r>=70)return l<=2||l<=5?"go_for_it":d>=.7||d>=.5?"field_goal":"go_for_it"}return m&&w&&(r>=50&&l<=5||r>=60&&l<=7||r>=70&&l<=10||r<40&&y&&l<=2)?"go_for_it":m&&!w?r>=80&&l<=1?"go_for_it":r>=57&&(o.down>=2||o.time_remaining_sec<=30)?d>=.55?"field_goal":"punt":d>=.62&&r>=60?"field_goal":"punt":r<=59?"punt":d>=.62?"field_goal":l<=2?"go_for_it":"punt"}function n(o){return o.quarter<4||o.time_remaining_sec>300?o.score_diff<=-9?"two":"kick":o.score_diff===-8?"two":o.score_diff===-5?"kick":o.score_diff===-4?"two":"kick"}function a(o){const i=o.score_diff<0,r=o.score_diff>=9,l=(o.quarter===2||o.quarter===4)&&o.time_remaining_sec<=300,c=o.time_remaining_sec<=120;return(l||c)&&i?{tempo:"hurry_up"}:(l||c)&&r?{tempo:"burn_clock"}:{tempo:"normal"}}return{chooseFourthDown:t,choosePAT:n,chooseTempo:a}}function Dt(s,e,t){return Math.max(e,Math.min(t,s))}function ve(s,e,t){return(t==="player"===e?100-s:s)<20}function _e(s){return s<=2?"short":s>=8?"long":"medium"}function Se(s,e,t){return`${Math.max(1,Math.min(4,s))}:${e}:${t?"RZ":"FG"}`}class At{countsByKey=Object.create(null);global={run:0,pass:0};record(e,t,n){if(e!=="player"||n.possessing!=="player")return;const a=ve(n.ballOnFromHome,n.playerIsHome,n.possessing),o=Se(n.down,_e(n.toGo),a);this.countsByKey[o]||(this.countsByKey[o]={run:0,pass:0}),this.countsByKey[o][t]+=1,this.global[t]+=1}predictRunProbabilityForPlayer(e){const t=ve(e.ballOnFromHome,e.playerIsHome,"player"),n=Se(e.down,_e(e.toGo),t),a=this.countsByKey[n]||{run:0,pass:0},o=this.global,i=a.run+a.pass,r=o.run+o.pass,l=(a.run+1)/(i+2),c=r>0?o.run/r:.5,d=Math.max(0,Math.min(1,i/6));return Dt(l*d+c*(1-d),.1,.9)}}function z(s){let e=s%2147483647;return e<=0&&(e+=2147483646),function(){return e=e*16807%2147483647,(e-1)/2147483646}}function It(s,e,t){return Math.max(e,Math.min(t,s))}function Ct(s){return s<=1?1:s<=3?"2-3":s<=6?"4-6":s<=10?"7-10":s<=15?"11-15":"16+"}function le(s,e){const t=e?s:100-s;return t<=5?"own_gl":t<=19?"backed":t<=39?"own":t<=59?"mid":t<=79?"plus":"red"}function ce(s,e){return e<=120?"two_min":s===4&&e<=360?"Q4-late":s===4?"Q4-early":s===3?"Q3":s===2?"Q2":"Q1"}function Rt(s,e){const t=s-e;if(t===0)return"tied";const n=Math.abs(t),a=n<=1?1:n<=3?"2-3":n<=7?"4-7":n<=14?"8-14":"15+";return t>0?`lead:${a}`:`trail:${a}`}function V(s){return`${s.down}|${s.dist}|${s.zone}|${s.score}|${s.clock}`}class Ft{offenseCounts=new Map;defenseCounts=new Map;decay;alpha;constructor(e){const t=Math.max(1,Math.floor(e?.halfLife??12));this.decay=Math.pow(.5,1/t),this.alpha=e?.alpha??.5}reset(){this.offenseCounts.clear(),this.defenseCounts.clear()}decayAll(e){for(const[t,n]of e){let a=0;for(const o of Object.keys(n)){const r=(n[o]??0)*this.decay;n[o]=r,a+=r}a<.001&&e.delete(t)}}stepDecay(){this.decayAll(this.offenseCounts),this.decayAll(this.defenseCounts)}recordOffense(e,t){const n=V(e),a=this.offenseCounts.get(n)||Object.create(null);a[t]=(a[t]||0)+1,this.offenseCounts.set(n,a)}recordDefense(e,t){const n=V(e),a=this.defenseCounts.get(n)||Object.create(null);a[t]=(a[t]||0)+1,this.defenseCounts.set(n,a)}predictOffense(e){const t=V(e),n=this.offenseCounts.get(t)||{},a=["run_mid","run_edge","pass_short","pass_deep","gadget"];let o=0;const i={run_mid:this.alpha,run_edge:this.alpha,pass_short:this.alpha,pass_deep:this.alpha,gadget:this.alpha};for(const d of a)i[d]+=n[d]||0,o+=i[d];const r=Object.fromEntries(a.map(d=>[d,(i[d]||0)/(o||1)])),c=1/(1+Object.values(n).reduce((d,u)=>d+(u||0),0));return{probs:r,uncertainty:c}}predictDefense(e){const t=V(e),n=this.defenseCounts.get(t)||{},a=["goal_line","short_yd","inside_blitz","outside_blitz","balanced","passing","prevent","prevent_deep"];let o=0;const i=Object.create(null);for(const d of a)i[d]=(n[d]||0)+this.alpha,o+=i[d];const r=Object.fromEntries(a.map(d=>[d,(i[d]||0)/(o||1)])),c=1/(1+Object.values(n).reduce((d,u)=>d+(u||0),0));return{probs:r,uncertainty:c}}buildKeyFromState(e,t){const n=It(e.down,1,4),a=Ct(e.toGo),o=le(e.ballOn,t),i=ce(e.quarter,e.clock),r=e.score[e.possession==="player"?"player":"ai"],l=e.score[e.possession==="player"?"ai":"player"],c=Rt(r,l);return{down:n,dist:a,zone:o,score:c,clock:i}}}function Te(s){const e=s.toLowerCase();return/reverse|razzle|flea|double pass|end around/.test(e)?"gadget":/end run|outside|sweep|toss/.test(e)?"run_edge":/long bomb|deep|post|corner|stop & go|streak/.test(e)?"pass_deep":/pass|hook|look in|sideline|flair|flare|pop|button|down & (in|out)|screen|quick|slant/.test(e)?"pass_short":"run_mid"}function Oe(s){const e=s.toLowerCase();return/goal line/.test(e)?"goal_line":/short yardage/.test(e)?"short_yd":/inside blitz/.test(e)?"inside_blitz":/outside blitz/.test(e)?"outside_blitz":/prevent deep/.test(e)?"prevent_deep":/prevent/.test(e)?"prevent":/passing/.test(e)?"passing":"balanced"}function X(s,e,t){return Math.max(e,Math.min(t,s))}function Nt(s,e,t,n){const a=e.getWhiteSignRestriction(s);return a==null?!0:(t.possession==="player"===n?100-t.ballOn:t.ballOn)>a}function Pe(s,e,t){const n=Math.max(.05,t),a=e.map(l=>Math.exp(X(l.util,-1,1)/n)),o=a.reduce((l,c)=>l+c,0)||1,i=s()*o;let r=0;for(let l=0;l<e.length;l++){const c=a[l]||0;if(i>=r&&i<r+c)return e[l].item;r+=c}return e[e.length-1].item}function $e(s,e){const t=s.ballOn;return e?t<=50?`OWN ${Math.max(1,t)}`:`OPP ${Math.max(1,100-t)}`:t>=50?`OWN ${Math.max(1,100-t)}`:`OPP ${Math.max(1,t)}`}class Ge{constructor(e,t){this.deps=e,this.playerIsHome=t}rng=z(123456789);model=new Ft({halfLife:12,alpha:.5});lastOffenseCalls=[];lastDefenseCalls=[];personality={aggressiveness_offense:.5,aggressiveness_defense:.5,trick_play_rate:.02,blitz_rate_base:.18,deception_bias:.25,tempo_preference:"normal",risk_tolerance_late:.6};async loadPersonality(e){try{let t={};try{const n=await C(()=>import("./playcaller.config-DWG2L_TX.js"),[]).catch(()=>null);t=n&&(n.default||n)||{}}catch{}this.personality={...this.personality,...t}}catch{}e&&(this.personality={...this.personality,...e})}reset(e){this.rng=z(e),this.model.reset(),this.lastOffenseCalls=[],this.lastDefenseCalls=[]}stepDecay(){this.model.stepDecay()}add_observation(e,t,n){const a=e.possession==="player"===this.playerIsHome,o=this.model.buildKeyFromState(e,a);this.model.recordOffense(o,Te(t)),this.model.recordDefense(o,Oe(n))}choose_offense_play(e,t){const n=this.deps.getOffenseHand().filter(p=>(p.type==="run"||p.type==="pass")&&Nt(p.label,this.deps,e,this.playerIsHome)),a=e.possession==="player"===this.playerIsHome,o=this.model.buildKeyFromState(e,a),i=this.model.predictDefense(o),r=ce(e.quarter,e.clock),l=le(e.ballOn,a),c=e.down===3&&e.toGo>=6||e.down===4||e.quarter===4&&e.clock<=360,d=this.personality.tempo_preference==="hurry"?.7:this.personality.tempo_preference==="chew"?.5:.6,u=X(d*(c?.6:1),.2,1.2),m=.03,y=n.map(p=>{const b=Te(p.label),h=i.probs;let g=0;b==="run_mid"?g=.2*(h.passing+h.prevent+h.prevent_deep)+-.3*(h.goal_line+h.short_yd+h.inside_blitz):b==="run_edge"?g=.15*(h.passing+h.balanced)+-.25*(h.short_yd+h.outside_blitz):b==="pass_short"?g=.25*(h.balanced+h.passing)+-.25*(h.inside_blitz+h.outside_blitz+h.goal_line):b==="pass_deep"?g=.35*h.passing+-.5*(h.prevent+h.prevent_deep):b==="gadget"&&(g=.15*(1-h.short_yd)+-.2*h.goal_line);let k=0;const S=e.toGo<=2,O=e.toGo>=8;S&&(b==="run_mid"||b==="run_edge"||/keeper|slant|off tackle/i.test(p.label))&&(k+=.25),O&&(b==="pass_short"||b==="pass_deep")&&(k+=.2),(l==="own_gl"||l==="backed")&&(b==="pass_deep"||b==="gadget")&&(k-=.3),l==="red"&&e.down===1&&b==="run_mid"&&(k+=.05);const _=this.lastOffenseCalls.slice(-2).filter(K=>K===p.label).length,T=_>=2?-.5:_===1?-.2:0,P=(1-i.uncertainty)*this.personality.deception_bias*(this.rng()<.5?1:-1)*.1,$=e.score[e.possession==="player"?"player":"ai"],E=e.score[e.possession==="player"?"ai":"player"],M=e.quarter===4&&e.clock<=300&&$>E&&(b==="pass_deep"||b==="gadget")?.25:0,G=X(.45*g+.3*k+.15*T+.1*P-.4*M,-1,1);return{item:{deckName:t,playLabel:p.label},util:G}});let w;if(this.rng()<m){const p=Math.floor(this.rng()*Math.max(1,y.length));w=y[Math.min(p,y.length-1)].item}else w=Pe(this.rng,y,u);this.lastOffenseCalls.push(w.playLabel),this.lastOffenseCalls.length>8&&this.lastOffenseCalls.shift();try{if((()=>{try{if(typeof localStorage<"u")return localStorage.getItem("gs_dev_mode")==="1"}catch{}try{return!!globalThis.GS?.__devMode?.enabled}catch{}return!1})()){const b=e.possession==="player"===this.playerIsHome,h={drive:void 0,quarter:e.quarter,clock:`${String(Math.floor(e.clock/60)).padStart(1,"0")}:${String(e.clock%60).padStart(2,"0")}`,score:{us:e.score[e.possession==="player"?"player":"ai"],them:e.score[e.possession==="player"?"ai":"player"]},down:e.down,to_go:e.toGo,yardline:$e(e,b),phase:r,field_zone:l,opponent_pred:i.probs,uncertainty:i.uncertainty,candidates:y.map(g=>({call:g.item.playLabel,utility:Number(g.util.toFixed(3))})),temp:u,epsilon:m,chosen:w.playLabel,personality:{agg_off:this.personality.aggressiveness_offense,deception:this.personality.deception_bias,trick_rate:this.personality.trick_play_rate}};globalThis.GS?.bus?.emit?.("qa:debug",{text:JSON.stringify(h)})}}catch{}return w}choose_defense_play(e){const t=this.deps.getDefenseOptions(),n=e.possession==="player"===this.playerIsHome,a=this.model.buildKeyFromState(e,n),o=this.model.predictOffense(a),i=ce(e.quarter,e.clock),r=le(e.ballOn,n),l=t.map(y=>{const w=Oe(y),p=o.probs;let b=0;w==="goal_line"||w==="short_yd"?b=.35*(p.run_mid+p.run_edge)+-.25*p.pass_deep:w==="inside_blitz"||w==="outside_blitz"?b=.25*p.pass_short+-.25*p.gadget:w==="passing"?b=.35*(p.pass_short+p.pass_deep)+-.2*p.run_mid:w==="prevent_deep"?b=.5*p.pass_deep+-.35*(p.run_mid+p.run_edge):w==="prevent"?b=.35*p.pass_deep+-.2*p.run_mid:b=.2*(p.run_mid+p.run_edge+p.pass_short)-.05*p.gadget;let h=0;e.toGo<=2&&(w==="goal_line"||w==="short_yd"||w==="inside_blitz")&&(h+=.2),r==="red"&&(w==="goal_line"||w==="short_yd")&&(h+=.1),e.quarter===4&&e.clock<=120&&w==="prevent_deep"&&(h+=.25);const k=this.lastDefenseCalls.slice(-2).filter(_=>_===y).length,S=k>=2?-.4:k===1?-.15:0,O=X(.6*b+.3*h+.1*S,-1,1);return{item:{label:y},util:O}}),d=e.down===3&&e.toGo>=8||e.quarter===4&&e.clock<=120?.45:.65,u=.02+.1*o.uncertainty;let m;if(this.rng()<u){const y=Math.floor(this.rng()*Math.max(1,l.length));m=l[Math.min(y,l.length-1)].item}else m=Pe(this.rng,l,d);this.lastDefenseCalls.push(m.label),this.lastDefenseCalls.length>8&&this.lastDefenseCalls.shift();try{if((()=>{try{if(typeof localStorage<"u")return localStorage.getItem("gs_dev_mode")==="1"}catch{}try{return!!globalThis.GS?.__devMode?.enabled}catch{}return!1})()){const w=e.possession==="player"===this.playerIsHome,p={quarter:e.quarter,clock:`${String(Math.floor(e.clock/60)).padStart(1,"0")}:${String(e.clock%60).padStart(2,"0")}`,score:{us:e.score[e.possession==="player"?"player":"ai"],them:e.score[e.possession==="player"?"ai":"player"]},down:e.down,to_go:e.toGo,yardline:$e(e,w),phase:i,field_zone:r,opponent_pred:o.probs,uncertainty:o.uncertainty,candidates:l.map(b=>({call:b.item.label,utility:Number(b.util.toFixed(3))})),temp:d,epsilon:u,chosen:m.label,personality:{agg_def:this.personality.aggressiveness_defense}};globalThis.GS?.bus?.emit?.("qa:debug",{text:JSON.stringify(p)})}}catch{}return m}}function Bt(s){return Math.max(0,Math.min(100,s))}function Me(s,e){return s.possession==="player"?e:-e}function Ee(s,e){return Bt(s+e)}function de(s,e){return s.possession==="player"?100-e:e}function xt(s,e){return s.possession==="player"?e:100-e}function Le(s,e){const t=Math.floor(e/2);return s>t?{applied:t,capped:!0}:{applied:s,capped:!1}}function qt(s,e,t){if(t){const o=s.possession==="player"?100-e:e;return{down:1,toGo:Math.min(10,o)}}const n=s.possession==="player"?100-e:e,a=Math.min(10,n);return{down:Math.max(1,s.down),toGo:Math.max(1,a)}}function zt(s){return s?!!(s.raw&&/\bLG\b/i.test(s.raw)):!1}function Ht(s,e){return e?0:x.penalty}function De(s){return{...s,score:{...s.score}}}function Ut(s,e,t,n){const a=n&&t.on==="defense",o=a?"midfield":"previous",i=a?50:e;if(t.on==="defense"){const r=de(s,i),{applied:l,capped:c}=Le(t.yards,r);return{ballOn:Ee(i,Me(s,l)),capped:c,spotBasis:o}}else{const r=xt(s,i),{applied:l,capped:c}=Le(t.yards,r);return{ballOn:Ee(i,Me(s,-l)),capped:c,spotBasis:o}}}function ot(s){const{prePlayState:e,postPlayState:t,outcome:n,inTwoMinute:a}=s,o=n.penalty,r=zt(n)&&o.on==="defense",l=De(t),c=Ut(e,e.ballOn,o,r),d=!!o.firstDown&&o.on==="defense",u=qt(e,c.ballOn,d);let y={...De(e),ballOn:c.ballOn,down:u.down,toGo:u.toGo};const w=e.quarter<=4,p=e.clock===0||y.clock===0,h=o.on==="defense"&&w&&p,g=Ht(a,h);y.clock=Math.max(0,e.clock-g);const k={automaticFirstDownApplied:d,halfDistanceCapped:c.capped,measuredFromMidfieldForLG:r,spotBasis:c.spotBasis,untimedDownScheduled:h};function S(P){const E=-de(e,P.ballOn)+de(e,e.ballOn),v=P.down===1?5:P.down===2?2:P.down===3?0:-3,M=Math.max(0,10-P.toGo)*.2;return E+v+M}const O=S(y),_=S(l);let T="neutral";return O>_+.5?T="accept":_>O+.5&&(T="decline"),{accepted:y,declined:l,decisionHint:T,adminMeta:k}}function Ae(s){return Math.max(0,Math.min(100,Math.round(s)))}function Kt(s){return s===0||s===100}function Yt(s){return s<0||s>100}function jt(s){return s==="player"?20:80}function Ie(s){return{ballOn:jt(s.possessing),possession:s.possessing}}function Wt(s,e){const t=s.possessing==="player"?"ai":"player",n=Ae(s.possessing==="player"?s.ballOn-7:s.ballOn+7);let a;return t==="player"?a=Math.max(20,n):a=Math.min(80,n),{ballOn:Ae(a),possession:t}}function Qt(s,e){const t={...s};return s.possession==="player"?t.ballOn=Math.max(0,Math.min(100,s.ballOn+e)):t.ballOn=Math.max(0,Math.min(100,s.ballOn-e)),t}function Vt(s){const e={...s,score:{...s.score}};let t=!1,n=!1;return s.possession==="player"?(s.ballOn>=100&&(e.score.player+=6,t=!0),s.ballOn<=0&&(e.score.ai+=2,n=!0)):(s.ballOn<=0&&(e.score.ai+=6,t=!0),s.ballOn>=100&&(e.score.player+=2,n=!0)),{state:e,touchdown:t,safety:n}}function at(s){let{state:e}=s;const t={quarter:e.quarter,clock:e.clock,down:e.down,toGo:e.toGo,ballOn:e.ballOn,possession:e.possession,score:{...e.score}},n=tt({deckName:s.deckName,playLabel:s.playLabel,defenseLabel:s.defenseLabel,charts:s.charts,rng:s.rng});if(n.category==="penalty"&&n.penalty){const y=ot({prePlayState:e,postPlayState:e,outcome:n,inTwoMinute:!1});return{state:y.decisionHint==="decline"?y.declined:y.accepted,outcome:n,touchdown:!1,safety:!1,possessionChanged:!1}}let a={...e},o=!1;if(n.category==="gain"||n.category==="loss")a=Qt(e,n.yards);else if(n.category!=="incomplete")if(n.category==="interception"){a.possession=e.possession==="player"?"ai":"player",o=!0;const u=n.interceptReturn||0;if(a.possession==="player"?a.ballOn=Math.max(0,Math.min(100,e.ballOn+u)):a.ballOn=Math.max(0,Math.min(100,e.ballOn-u)),Yt(a.ballOn)){const m=Ie({ballOn:a.ballOn,possessing:a.possession});a.ballOn=m.ballOn}else if(Kt(a.ballOn)){const m=Ie({ballOn:a.ballOn,possessing:a.possession});a.ballOn=m.ballOn}a.down=1,a.toGo=10}else n.category==="fumble"&&(a.possession=e.possession==="player"?"ai":"player",o=!0,a.down=1,a.toGo=10);if(!o&&(n.category==="gain"||n.category==="loss")){const m=Math.abs(n.yards)>=e.toGo&&n.yards>0;m?(a.down=1,a.toGo=10):(a.down=Math.min(4,e.down+1),a.toGo=Math.max(1,m?10:e.toGo-Math.max(0,n.yards)))}else!o&&n.category==="incomplete"&&(a.down=Math.min(4,e.down+1));const i=!o&&n.category==="gain"&&n.yards>0&&n.yards>=e.toGo,r=pe(n,!1,i);a.clock=Math.max(0,e.clock-r);const l={quarter:a.quarter,clock:a.clock,down:a.down,toGo:a.toGo,ballOn:a.ballOn,possession:a.possession,score:{...a.score}},c=Vt(a);a=c.state,l.quarter=a.quarter,l.score.player=a.score.player,l.score.ai=a.score.ai;const d=et();if(d&&(d.recordPlayResolved({playLabel:s.playLabel,defenseLabel:s.defenseLabel,deckName:s.deckName,gameStateBefore:t,gameStateAfter:l,outcome:{category:n.category||"other",yards:n.yards,touchdown:c.touchdown,safety:c.safety,possessionChanged:o}}),(t.ballOn!==l.ballOn||t.down!==l.down||t.possession!==l.possession)&&d.recordGameStateChange({changeType:"field_position",oldState:t,newState:l,reason:"play_resolution"}),t.clock!==l.clock&&d.recordTimeUpdate({clockBefore:t.clock,clockAfter:l.clock,timeElapsed:t.clock-l.clock,quarter:t.quarter,reason:"play_resolution"}),o&&t.possession!==l.possession&&d.recordPossessionChange({possessionBefore:t.possession,possessionAfter:l.possession,reason:"turnover",spot:l.ballOn,down:l.down,toGo:l.toGo}),c.touchdown||c.safety)){const u=c.touchdown?t.possession==="player"?"player":"ai":t.possession==="player"?"ai":"player";d.recordScoringEvent({scoringTeam:u,points:c.touchdown?6:2,scoreType:c.touchdown?"TD":"Safety",gameStateBefore:t,gameStateAfter:l})}return{state:a,outcome:n,touchdown:c.touchdown,safety:c.safety,possessionChanged:o}}var Ce={};const Re={engine:"deterministic",NEW_ENGINE_V1:!0};function Zt(s){const e=`GRIDIRON_${String(s).toUpperCase()}`,t=typeof process<"u"&&Ce?Ce[e]:void 0;if(t!==void 0)return t==="dice"?"dice":"deterministic";try{const n=localStorage.getItem(`gridiron_feature_${s}`);if(n!==null)return s==="engine"?n==="dice"?"dice":"deterministic":(Re[s],n)}catch{console.warn("localStorage not available, using default feature flags")}return Re[s]}function rt(){return Zt("engine")}function Bn(){const s=rt();return{type:s,...{deterministic:{name:"Deterministic Engine",description:"Legacy card-based resolution system"},dice:{name:"Dice Engine",description:"New 2d20 dice-based resolution system"}}[s]}}const Jt=["Power Up Middle","Power Off Tackle","QB Keeper","Slant Run","End Run","Reverse","Draw","Trap","Run & Pass Option","Flair Pass","Sideline Pass","Look In Pass","Screen Pass","Pop Pass","Button Hook Pass","Razzle Dazzle","Down & Out Pass","Down & In Pass","Long Bomb","Stop & Go Pass"];function Fe(s,e){const t=s.replace(/\s+/g,"_"),n=e.replace(/\s+/g,"").replace(/[()&]/g,"").replace(/\/+/,"");return`${t}_${n}`}function Ne(s,e){return`assets/cards/${s}/${e}.jpg`}function Xt(s){return s.startsWith("Punt")?"punt":s.toLowerCase().includes("pass")?"pass":(["Run & Pass Option"].includes(s),"run")}function oe(s){const e=Jt.map(o=>({id:Fe(s,o),deck:s,label:o,type:Xt(o),art:Ne(s,o)})),t="Punt (4th Down Only)",n={id:Fe(s,t),deck:s,label:t,type:"punt",art:Ne(s,t)};return[...e.filter(o=>o.label!=="Trap"),n]}const q={"Pro Style":oe("Pro Style"),"Ball Control":oe("Ball Control"),"Aerial Style":oe("Aerial Style")},N=[{id:"Defense_GoalLine",label:"Goal Line"},{id:"Defense_ShortYardage",label:"Short Yardage"},{id:"Defense_InsideBlitz",label:"Inside Blitz"},{id:"Defense_Running",label:"Running"},{id:"Defense_RunAndPass",label:"Run & Pass"},{id:"Defense_PassAndRun",label:"Pass & Run"},{id:"Defense_Passing",label:"Passing"},{id:"Defense_OutsideBlitz",label:"Outside Blitz"},{id:"Defense_Prevent",label:"Prevent"},{id:"Defense_PreventDeep",label:"Prevent Deep"}],en={"Long Bomb":5,"Run & Pass Option":2,"Razzle Dazzle":5,"Stop & Go Pass":5};class tn{offenseCharts=null;async initialize(){if(!this.offenseCharts)try{const{fetchOffenseCharts:e}=await C(async()=>{const{fetchOffenseCharts:n}=await import("./offenseCharts-Cs8xlLcW.js");return{fetchOffenseCharts:n}},__vite__mapDeps([0,1])),t=await e();t.ok&&(this.offenseCharts=t.data)}catch(e){console.warn("Failed to load offense charts for deterministic engine:",e)}}resolvePlay(e,t,n,a){const o=this.findOffenseCard(e),i=this.findDefenseCard(t);if(!o)return console.warn(`Unknown offense card ID: ${e}`),{yards:0,clock:"30"};if(!i)return console.warn(`Unknown defense card ID: ${t}`),{yards:0,clock:"30"};if(this.offenseCharts)try{const{resolvePlayCore:r}=require("../rules/ResolvePlayCore"),l=r({state:n,charts:this.offenseCharts,deckName:o.deck,playLabel:o.label,defenseLabel:i.label,rng:a});return this.convertDeterministicResult(l,o.label,i.label)}catch(r){console.warn("Failed to use resolvePlayCore, falling back to stub:",r)}return{yards:0,clock:"30"}}convertDeterministicResult(e,t,n){return{yards:e.outcome?.yards||0,turnover:e.outcome?.category==="interception"||e.outcome?.category==="fumble",clock:"30",tags:[t,n]}}findOffenseCard(e){for(const t of["Pro Style","Ball Control","Aerial Style"]){const a=q[t].find(o=>o.id===e);if(a)return a}return null}findDefenseCard(e){return N.find(t=>t.id===e)||null}}class nn{matchupTable=null;penaltyTable=null;async initialize(){if(!(this.matchupTable&&this.penaltyTable))try{const{fetchMatchupTable:e}=await C(async()=>{const{fetchMatchupTable:o}=await import("./matchupTables-C8SyztAM.js");return{fetchMatchupTable:o}},__vite__mapDeps([2,3,1])),{fetchPenaltyTableByName:t}=await C(async()=>{const{fetchPenaltyTableByName:o}=await import("./penaltyTables-CtArJ56i.js");return{fetchPenaltyTableByName:o}},__vite__mapDeps([4,3,1])),[n,a]=await Promise.all([e("play_vs_defense_outcomes.json"),t("penalty_table_v1")]);n.ok&&(this.matchupTable=n.data),a.ok&&(this.penaltyTable=a.data)}catch(e){console.warn("Failed to load dice tables for dice engine:",e)}}resolvePlay(e,t,n,a){const o=this.findOffenseCard(e),i=this.findDefenseCard(t);if(!o)return console.warn(`Unknown offense card ID: ${e}`),{yards:0,clock:"30"};if(!i)return console.warn(`Unknown defense card ID: ${t}`),{yards:0,clock:"30"};if(this.matchupTable&&this.penaltyTable)try{const{resolveSnap:r}=require("../rules/ResolveSnap"),l=r(o.id,i.id,this.matchupTable,this.penaltyTable,n,a);return this.convertDiceResult(l,o.label,i.label)}catch(r){console.warn("Failed to use resolveSnap, falling back to stub:",r)}return{yards:0,clock:"30"}}convertDiceResult(e,t,n){const a={yards:e.finalYards||e.baseOutcome?.yards||0,clock:e.finalClockRunoff.toString(),tags:[t,n,...e.tags]};return e.baseOutcome?.turnover&&(a.turnover={type:e.baseOutcome.turnover.type,return_yards:e.baseOutcome.turnover.return_yards,return_to:e.baseOutcome.turnover.return_to}),e.doubles&&(a.doubles={kind:e.doubles}),e.penalty&&(a.penalty={side:e.penalty.penaltyInfo.side,yards:e.penalty.penaltyInfo.yards,label:e.penalty.penaltyInfo.label,override_play_result:e.penalty.overridesPlayResult},e.canAcceptDecline&&(a.options={can_accept_decline:!0})),a}findOffenseCard(e){for(const t of["Pro Style","Ball Control","Aerial Style"]){const a=q[t].find(o=>o.id===e);if(a)return a}return null}findDefenseCard(e){return N.find(t=>t.id===e)||null}}class sn{engines=new Map;initialized=!1;constructor(){this.engines.set("deterministic",new tn),this.engines.set("dice",new nn)}async initialize(){if(!this.initialized)try{const e=[this.engines.get("deterministic"),this.engines.get("dice")];await Promise.all(e.map(t=>t?.initialize())),this.initialized=!0}catch(e){console.warn("Failed to initialize engines:",e)}}getEngine(e){const t=e||rt(),n=this.engines.get(t);return n||(console.warn(`Unknown engine type: ${t}, falling back to deterministic`),this.engines.get("deterministic"))}getCurrentEngine(){return this.getEngine()}async resolvePlay(e,t,n,a){return this.initialized||await this.initialize(),this.getCurrentEngine().resolvePlay(e,t,n,a)}}const it=new sn;async function Be(s,e,t,n){return it.resolvePlay(s,e,t,n)}function on(s){const e=(s||[]).map(d=>String(d).replace(/\s+/g," ").trim()).filter(Boolean);if(e.length===0)return{pbp:"Play is underway.",analyst:"Watch the leverage and pad level here."};if(e.length===1)return{pbp:e[0]||"Play is underway.",analyst:"Good fundamentals at the point of attack."};const t=d=>/\blines up\b/i.test(d),n=d=>/^\d+(st|nd|rd|th)\s*&|^Now\s/i.test(d),a=d=>!(t(d)||n(d)),o=e.filter(a),i=/(drops back|throws|pass|button hook|slant|sideline|down and in|down and out|pop pass|flair|flare|screen|bomb|keeper|sneak|draw|trap|toss|sweep|handoff|fumbled|intercepted|sacked|return|pylon|toe-?tap|first down|loss of|gain of|pressure|hits|seam shot|deep post|post|corner)/i,r=/(blitz|goal[- ]?line|prevent|nickel|coverage|box|pad level|leverage|midfield|red zone|goal to go|backed up|short[- ]?yardage|crowds the line|balanced)/i,l=o.find(d=>i.test(d))||o[0]||e.find(a)||e[0]||"Play is underway.";let c=o.find(d=>d!==l&&(r.test(d)||/first down|now \d+(st|nd|rd|th)/i.test(d)))||e.find(d=>d!==l&&a(d))||e.find(d=>d!==l)||"Good fundamentals at the point of attack.";return{pbp:l,analyst:c}}function an(s,e,t,n,a){const o=s.down===1?"First and 10":s.down===2?`Second and ${s.toGo}`:s.down===3?`Third and ${s.toGo}`:`Fourth and ${s.toGo}`,i=a.formatPossessionSpotForBroadcast(s.possession,s.ballOn),r=String(t.defenseLabel||""),l=String(t.playLabel||""),c=a.formatClock(s.clock),d=`HOME ${s.score.player} – AWAY ${s.score.ai}`,u=(()=>{const G=s.ballOn%3;return G===0?"left hash":G===1?"right hash":"between the hashes"})(),m=s.ballOn%2===0?"near side numbers":"far side numbers",y=/shotgun|down &|bomb|screen|sideline|button|look in|pop pass|flair|flare/i.test(l)?"shotgun, three wide":/keeper|sneak|short yard|goal line|off tackle|slant run|trap|draw/i.test(l)?"under center, I-formation":"balanced set",w=/outside blitz|inside blitz/i.test(r)?"blitz look":/passing/i.test(r)?"nickel shell, two-high safeties":/prevent_deep/i.test(r)?"prevent, safeties deep":/goal line|short yard/i.test(r)?"heavy front, stacked box":"balanced front",p=/sideline|down & out|down & in|screen|flair|flare|button/i.test(l)?"slot in short motion":"",b=/run|keeper|draw|trap|sneak|slant|off tackle|end run|reverse|razzle|power up middle/i.test(l)&&!/pass/i.test(l),h=/pass|hook|look in|sideline|flair|flare|screen|down &/i.test(l),g=b?/end run/i.test(l)?"hands it off around the edge.":/off tackle/i.test(l)?"hands it off off tackle.":/keeper|sneak|qb/i.test(l)?"keeps it himself.":"turns and hands it off up the middle.":h?"drops back and fires.":"gets it out quickly.";let k="";if(!n)k="";else if(n.category==="incomplete")k=" Incomplete.";else if(n.category==="gain"||n.category==="loss"){const G=n.yards||0;if(G>0){const K=[" slips through left guard."," dives into the pile."," cuts back against pursuit."," bounces outside."," spins forward."],se=[" quick hitter underneath."," slant left, caught."," button hook at the sticks."," out to the flat."," screen forms."],R=Q=>Q[Math.floor(a.rng()*Q.length)];if(k=`${R(b?K:se)} Gain of ${G}.`,G>=20)try{a.quarterStats.explosives+=1}catch{}}else G<0?k=` Swallowed up for ${Math.abs(G)}.`:k=" Stonewalled at the line."}else if(n.category==="fumble"){k=" Ball is loose and recovered.";try{a.quarterStats.turnovers+=1}catch{}}else if(n.category==="interception"){k=" Picked off!";try{a.quarterStats.turnovers+=1}catch{}}`${o}${a.formatTeamYardLine(s.possession,s.ballOn)}${s.quarter}${c}${d}`;const S=s.possession==="player"?"HOME":"AWAY",O=(()=>{const G=["Here we go —","They set —","Quick to the line —","They take their time —","Snap comes —","Ball is snapped —","Here’s the play —","They roll it out —"];return G[Math.floor(a.rng()*G.length)]})(),_=`${S} ${a.playInDrive>1?"sets":"breaks the huddle"} on the ${u}, ${y}. Defense shows ${w}${p?`, ${p}`:""}.`,T=`${O} quarterback ${g}${k}`,P=`${a.formatOrdinal(e.down)} & ${e.toGo}`,$=a.formatTeamYardLine(e.possession,e.ballOn),v=`Spotted ${(e.possession==="player"?100-e.ballOn:e.ballOn)<=20?"inside the red zone":e.ballOn>=48&&e.ballOn<=52?"just shy of midfield":`${m}`} at ${$}. ${P}.`,D=(s.quarter===2||s.quarter===4)&&s.clock<=120?s.clock<60?" They’re hurrying now — under a minute left.":" Gotta get this snapped before the clock burns.":"",U=n&&(n.category==="interception"||n.category==="fumble")?e.possession==="player"?" And the crowd erupts!":" A hush falls over the stadium.":"",W=(a.rng()<.35?`${o} at ${a.formatTeamYardLine(s.possession,s.ballOn)}… ${T} ${v}${D}${U}`:`${o} from ${i}, Q${s.quarter} ${c} — ${d}. ${_} ${T} ${v}${D}${U}`).trim();let L="";if(n&&(n.category==="gain"||n.category==="loss")){const G=n.yards||0;G>=8?L=b?"Great cut and second-level block opened that lane.":"Beat the leverage outside — timing was perfect.":G>=3?L=b?"Good pad level; fell forward behind the guard.":"On time and on target; easy yards.":G>0?L=b?"Patient run, but backers closed fast.":"Checkdown; kept it ahead of the sticks.":G===0?L="Front won at the snap — no movement.":L="That was a brick wall up front; linebackers filled every crease."}L||(/outside blitz/i.test(r)?L="Edge pressure; QB had to speed it up.":/inside blitz/i.test(r)?L="A-gap heat — protection slid late.":/goal line|short yard/i.test(r)?L="Heavy front, gaps corked.":/passing/i.test(r)?L="Light box with umbrella coverage.":/prevent/i.test(r)?L="Soft shell, keep-it-in-front spacing.":L=b?"Line got just enough push.":"Protection held just long enough.");try{(a.playInDrive>=2?a.playInDrive:0)>=2&&b&&(L+=" They’ve hit that off-tackle twice; don’t be shocked if they fake it next series.")}catch{}return{pbp:W,analyst:L}}function rn(s,e,t,n,a,o,i){const r=[],l=v=>v==="player"?"HOME":"AWAY",c=`${l(s.possession)} ball at the ${i.formatTeamYardLine(s.possession,s.ballOn)} yard line.`,d=s.possession==="player"?100-s.ballOn:s.ballOn,u=s.ballOn,m=s.possession==="player"?u>=50:u<=50,y=u>=45&&u<=55,w=s.possession==="player"?u<=10:u>=90;let p=null;d<=10&&s.down===1&&s.toGo>=d?p="GoalToGo":d<=20?p="RedZone":y?p="NearMid":m?p="AcrossMid":w&&(p="BackedUp");const b=i.getLastNotesForSide(s.possession);p&&p!==b.zone&&(p==="GoalToGo"?r.push("Goal to go."):p==="RedZone"?r.push("Red zone opportunity."):p==="NearMid"?r.push("Near midfield."):p==="AcrossMid"?r.push("Across midfield."):p==="BackedUp"&&r.push("Backed up near own goal line."));const g=d+17<=45;g&&s.down>=3&&!b.fgInRange&&r.push("Within field goal range."),r.push(`${i.formatOrdinal(s.down)} & ${s.toGo}, ${c}`);const k=s.toGo<=1,S=/sneak|qb keeper|keeper/i.test(a),O=/play[- ]?action|long bomb|down & in|down & out|post|corner|seam|bomb/i.test(a);if(k||S||O){const v=/pass|hook|look in|sideline|flare|flair|pop|bomb|button|screen|down &/i.test(a)?"lines up in the shotgun.":"lines up under center.";r.push(v)}const _=String(a||""),P=(v=>{const M=D=>D[Math.floor(i.rng()*D.length)];return/goal line/i.test(v)?M(["Stacked front, safeties pinched.","Stacked box, gaps corked."]):/short yardage/i.test(v)?M(["Tight box, gaps packed.","Heavy front, gaps corked."]):/passing/i.test(v)?M(["Light box, two-high shell.","Nickel spacing, umbrella coverage."]):/outside blitz/i.test(v)?M(["Corner fire off the edge.","Nickel off the slot.","Safety blitz crashing down."]):/inside blitz/i.test(v)?M(["Mike shoots the A-gap.","Linebacker dog up the middle."]):/prevent deep/i.test(v)?M(["Umbrella shell, keep it in front.","Prevent deep — nothing behind."]):/prevent/i.test(v)?"Umbrella look, keep-it-in-front spacing.":/run & pass|pass & run|running/i.test(v)?M(["Balanced shell.","Soft quarters, balanced spacing."]):null})(String(o||"")),$=b.defense||null,E=/blitz/i.test(o||"");if(P&&(E||(o||"")!==$)&&r.push(P),/punt/i.test(_)?r.push(`${l(s.possession)} lines up to punt from the ${s.ballOn} yard line.`):/pass|hook|look in|sideline|flare|flair|pop|bomb|button/i.test(_)?/screen/i.test(_)?r.push("Quarterback sets up the screen."):/button hook/i.test(_)?r.push("Quick button hook route."):/look in/i.test(_)?r.push("Quick slant to the inside."):/sideline/i.test(_)?r.push("Throws to the sideline."):/down & in/i.test(_)?r.push("Throws down and in."):/down & out/i.test(_)?r.push("Throws down and out."):/pop pass/i.test(_)?r.push("Quick pop pass over the middle."):/flair|flare/i.test(_)?r.push("Flair pass to the back."):/stop & go/i.test(_)?r.push("Stop-and-go, going deep."):/bomb/i.test(_)?r.push("Going deep downfield."):r.push("Quarterback drops back to pass."):/keeper|draw|qb/i.test(_)?r.push("Quarterback keeps it himself and runs."):/end run/i.test(_)?r.push("Quarterback hands off around the end."):/off tackle/i.test(_)?r.push("Quarterback hands off off tackle."):/slant run/i.test(_)?r.push("Quarterback hands off on an inside slant run."):/draw/i.test(_)?r.push("Quarterback delays and hands off on a draw play."):/trap/i.test(_)?r.push("Quarterback hands off on a trap play."):/run & pass option/i.test(_)?r.push("Quarterback reads the option look."):/razzle dazzle/i.test(_)?r.push("Trick play! Razzle dazzle in the backfield."):r.push("Quarterback hands off to the running back."),n.td)return{result:"Touchdown",notes:[...r,"Touchdown scored."]};if(n.safety)return{result:"Safety",notes:[...r,"Safety is awarded."]};if(!t)return{result:"Play",notes:r};if(t.category==="incomplete"){let v="The pass falls incomplete.";return/blitz/i.test(o)?v="Pressure forces an incomplete pass.":/prevent deep/i.test(o)?v="Prevent deep coverage breaks up the deep shot.":/passing/i.test(o)&&(v="Tight coverage, pass falls incomplete."),{result:"Incomplete",notes:[...r,v]}}if(t.category==="gain"||t.category==="loss"){const v=t.yards||0,M=v>=0?"Gain":"Loss";if(!!(t.raw&&/sack/i.test(t.raw)||/sack/i.test(_))){const R=/blitz/i.test(o)?" Blitz gets home.":"";return{result:`Sack -${Math.abs(v)}`,notes:[...r,`Edge wins inside spin; quarterback swallowed.${R}`,`Loss of ${Math.abs(v)} yards. Protection beaten.`,`Now ${i.formatOrdinal(e.down)} & ${e.toGo}.`]}}const U=s.possession===e.possession&&s.down!==1&&e.down===1,ne=["slashes for","rumbles for","bursts for","powers for","cuts for"],W=["stacked for","dropped for","stuffed for","spilled for"],L=R=>R[Math.floor(i.rng()*R.length)],G=v>=0?`${L(ne)} ${Math.abs(v)}.`:`${L(W)} ${Math.abs(v)}.`,K=Math.abs(v)>=20?(()=>{const R=i.formatTeamYardLine(s.possession,s.ballOn),me=s.possession==="player"?s.ballOn+Math.floor(Math.abs(v)/2):s.ballOn-Math.floor(Math.abs(v)/2),Q=i.formatTeamYardLine(s.possession,Math.max(0,Math.min(100,me))),ft=i.formatTeamYardLine(e.possession,e.ballOn);return`From ${R}… to ${Q}… down at ${ft}!`})():"",se=U?" First down!":"";return{result:`${M} ${Math.abs(v)}`,notes:[...r,`${G} ${K}`.trim(),`Now ${i.formatOrdinal(e.down)} & ${e.toGo}.${se}`]}}if(i.setLastNotesForSide(s.possession,{zone:p||i.getLastNotesForSide(s.possession).zone,fgInRange:g,defense:o||null}),t.category==="interception"){const v=t.interceptReturn||0,M=v?` Return of ${Math.abs(v)} yards.`:"",D=i.formatTeamYardLine(e.possession,e.ballOn);return{result:"Interception",notes:[...r,`Ball is picked — tipped and taken.${M}`,`${l(e.possession)} takes over at the ${D}.`]}}if(t.category==="fumble"){const v=i.formatTeamYardLine(e.possession,e.ballOn),M=i.formatTeamYardLine(s.possession,s.ballOn);return{result:"Fumble",notes:[...r,`Ball's loose at ${M} — scrum on the ground.`,`Recovered by ${l(e.possession)} at ${v}.`]}}if(t.category==="penalty"){const v=t.penalty&&t.penalty.on||"offense",M=t.penalty&&t.penalty.yards||0;return{result:`Penalty on ${v} (${M})`,notes:[...r,"Penalty called."]}}return{result:"Play",notes:r}}class ln{constructor(e){this.rng=e;const t=n=>n[Math.floor(this.rng()*n.length)];this.weather={temp:t(["crisp","mild","warm","hot"]),wind:t(["calm","light breeze","gusty","quartering wind"]),precip:t(["clear","overcast","light rain","light snow"])}}driveId=1;playInDrive=0;currentPossession=null;driveStartAbsBallOn=null;driveStartSide=null;driveStats={runPlays:0,passPlays:0,totalYards:0,explosives:0,sacks:0};quarterStats={quarter:1,runs:0,passes:0,pointsHome:0,pointsAway:0,explosives:0,turnovers:0};weather;lullThreeAndOutStreak=0;lastNotesBySide={player:{zone:null,fgInRange:!1,defense:null},ai:{zone:null,fgInRange:!1,defense:null}};getPlayInDrive(){return this.playInDrive}getQuarterStatsRef(){return this.quarterStats}getLastNotesForSide(e){return this.lastNotesBySide[e]}setLastNotesForSide(e,t){this.lastNotesBySide[e]=t}incrementRunOrPassByLabel(e){try{const t=String(e||"").toLowerCase();/run|keeper|draw|trap|sneak|slant|off tackle|end run|razzle/.test(t)&&!/pass/.test(t)?this.quarterStats.runs+=1:this.quarterStats.passes+=1}catch{}}beginDriveIfNeeded(e,t,n){if(this.currentPossession!==e.possession){this.playInDrive>0&&(this.driveId+=1),this.playInDrive=0,this.currentPossession=e.possession,this.driveStartAbsBallOn=e.ballOn,this.driveStartSide=e.possession,this.driveStats={runPlays:0,passPlays:0,totalYards:0,explosives:0,sacks:0};const a=n(e.possession,e.ballOn),o=e.possession==="player"?"HOME":"AWAY",i=e.ballOn,r=e.possession==="player"?i>=60:i<=40,c=(e.possession==="player"?i<=15:i>=85)?"Backed up deep — protection and ball security matter here.":r?"Short field — everything in the playbook is available.":"Solid field position to start the drive.";t.push({type:"log",message:`Brad: ${o} takes over at ${a}.`}),t.push({type:"log",message:`Rob: ${c}`})}}incrementPlayInDrive(){this.playInDrive+=1}endDriveSummaryIfAny(e,t,n){if(this.driveStartAbsBallOn!=null&&this.driveStartSide!=null){const a=this.playInDrive,o=this.driveStats.totalYards,i=this.driveStats.runPlays>this.driveStats.passPlays?"ground-heavy":this.driveStats.passPlays>this.driveStats.runPlays?"air-heavy":"balanced",r=this.driveStartSide==="player"?"HOME":"AWAY",l=a<=3&&o>=30||this.driveStats.explosives>=1,c=a>=8&&o>=30;let d="";n==="touchdown"?d=l?`Three plays, quick strike — all chunk yardage — and ${r} cashes in.`:c?`Ten-play, grinding march — they owned the trenches — and ${r} finishes.`:`Drive wraps touchdown — ${a} plays for ${Math.abs(o)}.`:n==="punt"?d=a<=3?`${r} goes three-and-out — momentum drifting the other way.`:`Stalled after ${a} plays — punt coming.`:n==="downs"?d=`Stuffed on downs — ${r} turned away.`:n==="safety"?d=`Safety ends it — costly series for ${r}.`:d=`Drive wraps ${n} — ${a} plays, ${Math.abs(o)} yards ${o>=0?"gained":"lost"}.`;const u=n==="touchdown"?c?"They leaned on them — pure power football.":l?"Scheme beat leverage — that flipped the field.":"Execution at the key moments.":n==="safety"?"Protection broke down; all the juice flips sideline.":n==="downs"?"That front dominated gaps — nowhere to go.":n==="punt"?`${i} looks, but no finish.`:`${i} sequence.`;t.push({type:"log",message:`Brad: ${d}`}),t.push({type:"log",message:`Rob: ${u}`});try{if(n==="punt"&&a<=3&&o<5?this.lullThreeAndOutStreak+=1:this.lullThreeAndOutStreak=0,this.lullThreeAndOutStreak>=2){const y=this.weather,w=y.precip!=="clear"?`Weather note — ${y.precip}, ${y.wind}.`:y.wind!=="calm"?`Wind note — ${y.wind}, ball hanging a bit.`:"Crowd is restless; waiting for a spark.",p=this.driveStats.runPlays+this.driveStats.passPlays>=8?"Big bodies leaning — fatigue creeping in.":"Front sevens fresh, but they’re grinding.";t.push({type:"log",message:`Brad: ${w}`}),t.push({type:"log",message:`Rob: ${p}`}),this.lullThreeAndOutStreak=0}}catch{}}}}function cn(s,e,t,n){const a=[];let o={...s},r=(n.timeKeeping||x).kickoff;(o.quarter===2||o.quarter===4)&&o.clock>120&&o.clock-r<120&&(r=o.clock-120,a.push({type:"log",message:"Two-minute warning."}),a.push({type:"vfx",payload:{kind:"twoMinute"}})),o.clock=Math.max(0,o.clock-r);const l=e==="onside",c=n.isLeading(t,o.score)||n.isTied(o.score),d=Ue(n.rng,{onside:l,kickerLeadingOrTied:c}),u=t==="player"?"ai":"player",m=u==="player"?d.yardLine:100-d.yardLine;o.possession=d.turnover?t:u,o.ballOn=Math.max(0,Math.min(100,m));const y={down:1,toGo:10};o.down=y.down,o.toGo=y.toGo,a.push({type:"kickoff",payload:{onside:l}});try{const w=o.possession,p=n.formatTeamYardLine(w,o.ballOn),b=D=>D[Math.floor(n.rng()*D.length)],h=b(["a high hanger","a booming end-over-end","a wobbly spiral","a knuckleball","a low liner"]),g=b(["toward the near numbers","to the far sideline","between the hashes","to the right numbers","to the left numbers"]),k=b(["the goal line","the five","the three"]),S=w==="player"?o.ballOn:100-o.ballOn,O=S>=55,_=S>=70,T=["angles left, then up the seam","up the middle, bounces outside","zigs past the first wave, then squared up"],P=["straight ahead, no crease","met by the first wave, stacked"],E=b(_?["hits the crease and bursts free","finds daylight down the sideline","cuts back and turns on the jets"]:O?T:[...T,...P]),v=_?`And away we go — ${h} ${g}. Caught at ${k}, ${E} — all the way to ${p}!`:O?`And away we go — ${h} ${g}. Caught at ${k}, ${E} — big return to ${p}.`:`And away we go — ${h} ${g}. Caught at ${k}, ${E} — brought to ${p}.`,M=b(_?["Coverage bust — contain lost leverage and the lane opened wide.","Out-kicked the coverage — return team found a runway.","Missed fits across the board — explosive return."]:O?["Out-kicked the coverage — return team found daylight.","Gunners got washed — edge was there."]:["Coverage lanes stayed disciplined — no big gap to hit.","Good hang gave the gunners time — textbook coverage.","Return set it up, but contain held firm."]);a.push({type:"log",message:`Brad: ${v}`}),a.push({type:"log",message:`Rob: ${M}`})}catch{}return a.push({type:"hud",payload:{quarter:o.quarter,clock:o.clock,down:o.down,toGo:o.toGo,ballOn:o.ballOn,possession:o.possession,score:{player:o.score.player,ai:o.score.ai}}}),{state:o,events:a}}function dn(s,e,t){const n=[],a=s.possession,o=je({ballOn:s.ballOn,puntingTeam:a},t.rng,H),i=t.formatTeamYardLine(a,s.ballOn),r=a==="player"?"ai":"player",l=t.formatTeamYardLine(o.possessionFlips?r:a,o.ballOn);typeof o.distance=="number"&&o.distance;const c=o.returnYards||0,d=h=>h[Math.floor(t.rng()*h.length)],u=d(["booming end-over-end","tight spiral","wobbly spiral","low driving kick","high hanging punt"]),m=d(["toward the boundary","angling to the near hash","to the far numbers","middle of the field"]),y=c>=15?d(["up the seam","bounces outside","cuts back against pursuit"]):d(["met square by the first wave","slips one, then wrapped","no room, stacked early"]),w=`${u} from ${i}, ${m}. Return ${y} for ${c}, down at ${l}.`,p=c>=15?"Out-kicked the coverage — return team found daylight.":"Hang time and lanes — coverage wins that down.";n.push({type:"log",message:`Brad: ${w}`}),n.push({type:"log",message:`Rob: ${p}`}),e.possession=o.possessionFlips?a==="player"?"ai":"player":a,e.ballOn=o.ballOn;const b={down:1,toGo:10};return e.down=b.down,e.toGo=b.toGo,t.endDriveSummaryIfAny(e,n,"punt"),n.push({type:"hud",payload:{quarter:e.quarter,clock:e.clock,down:e.down,toGo:e.toGo,ballOn:e.ballOn,possession:e.possession,score:{player:e.score.player,ai:e.score.ai}}}),{state:e,events:n}}function fn(s,e,t){const n=[];let a={...s};const o=a.score.player-a.score.ai;(t.choosePAT?.({diff:o,quarter:a.quarter,clock:a.clock,side:e})??(e==="ai"?(()=>{const c=a.quarter===4&&a.clock<=300;return o<0&&-o<=2&&c?"two":"kick"})():"kick"))==="two"?t.rng()<.5&&(e==="player"?a.score.player+=2:a.score.ai+=2,n.push({type:"score",payload:{...t.scoringSideToDelta(e,2),kind:"TwoPoint"}})):t.attemptPatInternal(t.rng)&&(e==="player"?a.score.player+=1:a.score.ai+=1,n.push({type:"score",payload:{...t.scoringSideToDelta(e,1),kind:"XP"}})),a.awaitingPAT=!1;const r=t.chooseKickoffType?.({trailing:t.isTrailing(e,a.score),quarter:a.quarter,clock:a.clock})??"normal",l=t.performKickoff(a,r,e);return{state:l.state,events:[...n,...l.events]}}function un(s,e,t,n){const a=[];let o={...s};const i={...o};let r=n.timeKeepingFieldGoalSeconds,l=!1;if((i.quarter===2||i.quarter===4)&&i.clock>120&&i.clock-r<120&&(r=i.clock-120,l=!0),o.clock=Math.max(0,i.clock-r),l&&(a.push({type:"log",message:"Brad: Two-minute warning."}),a.push({type:"vfx",payload:{kind:"twoMinute"}})),n.attemptFieldGoalKick(n.rng,e)){t==="player"?o.score.player+=3:o.score.ai+=3,a.push({type:"score",payload:{...n.scoringSideToDelta(t,3),kind:"FG"}});const d=n.randomHash(),u=`Field goal from ${e}, ${d} — it is good. HOME ${o.score.player} — AWAY ${o.score.ai}, Q${o.quarter} ${n.formatClock(o.clock)}`,m="Clean snap, clean hold; good rotation on the ball.";a.push({type:"log",message:`Brad: ${u}`}),a.push({type:"log",message:`Rob: ${m}`});const y=n.performKickoff(o,"normal",t);o=y.state,a.push(...y.events)}else{const d=n.missedFieldGoalSpot({ballOn:o.ballOn,possessing:t},e);o.possession=d.possession,o.ballOn=d.ballOn;const u={down:1,toGo:10};o.down=u.down,o.toGo=u.toGo;const m=n.formatTeamYardLine(o.possession,o.ballOn),y=n.randomHash(),w=`Field goal from ${e}, ${y} — no good. ${o.possession==="player"?"HOME":"AWAY"} ball at ${m}.`,p="Snap and hold were fine — just yanked it.";a.push({type:"log",message:`Brad: ${w}`}),a.push({type:"log",message:`Rob: ${p}`})}return a.push({type:"hud",payload:n.hudPayload(o)}),{state:o,events:a}}function pn(s,e,t,n,a){const o=[];let i={...s};try{const r=a?.on||"defense",l=a?.yards||0,c=`${n.formatOrdinal(i.down)} & ${i.toGo}`,d=e==="accept"?`Penalty on ${r}, ${l} yards — accepted; now ${c}`:`Penalty on ${r}, ${l} yards — declined; play stands; now ${c}`;o.push({type:"log",message:d})}catch{}if(t.untimedDownScheduled&&(i.untimedDownScheduled=!0,o.push({type:"log",message:"Untimed down will be played due to defensive penalty."})),!i.gameOver&&!i.awaitingPAT){const r=!!i.untimedDownScheduled;if(i.clock===0&&!r){const l=i.quarter;o.push({type:"endOfQuarter",payload:{quarter:l}}),o.push({type:"log",message:`End of Q${l} — HOME ${i.score.player} — AWAY ${i.score.ai}`}),l===2?(o.push({type:"halftime"}),i.quarter=3,i.clock=900):l===4?(i.gameOver=!0,o.push({type:"final",payload:{score:i.score}})):(i.quarter=l+1,i.clock=900)}}return o.push({type:"hud",payload:n.hudPayload(i)}),{state:i,events:o}}function hn(s,e,t){const n=[];let a={...s};const o=t.isLeading(e==="player"?"ai":"player",a.score),i=t.chooseSafetyFreeKick?.({leading:o})??"kickoff+25",r=e;if(i==="kickoff+25"){const l=r==="player"?"ai":"player",c=l==="player"?25:75;a.possession=l,a.ballOn=c;const d={down:1,toGo:10};a.down=d.down,a.toGo=d.toGo,n.push({type:"kickoff",payload:{onside:!1}})}else{const l=r==="player"?"ai":"player",c=l==="player"?35:65;a.possession=l,a.ballOn=c;const d={down:1,toGo:10};a.down=d.down,a.toGo=d.toGo,n.push({type:"kickoff",payload:{onside:!1}})}return n.push({type:"hud",payload:{quarter:a.quarter,clock:a.clock,down:a.down,toGo:a.toGo,ballOn:a.ballOn,possession:a.possession,score:{player:a.score.player,ai:a.score.ai}}}),{state:a,events:n}}function yn(s){return{quarter:s.quarter,clock:s.clock,down:s.down,toGo:s.toGo,ballOn:s.ballOn,possession:s.possession,score:{player:s.score.player,ai:s.score.ai}}}function ye(s,e){return(s===2||s===4)&&e<=120}function Z(s,e){return s==="player"?{playerDelta:e,aiDelta:0}:{playerDelta:0,aiDelta:e}}function gn(s){const e=B(s)+B(s);return(te[e]||{}).PAT==="G"}function mn(s){const e=s();return e<.45?"left hash":e<.9?"right hash":"middle"}function xe(s,e){const t=e.player-e.ai;return(s==="player"?t:-t)>0}function bn(s,e){const t=e.player-e.ai;return(s==="player"?t:-t)<0}function wn(s){return s.player===s.ai}function J(s){return s===1?"1st":s===2?"2nd":s===3?"3rd":`${Math.max(1,Math.min(4,s))}th`}function ae(s){const e=Math.floor(Math.max(0,s)/60),t=Math.floor(Math.max(0,s)%60),n=t<10?`0${t}`:String(t);return`${e}:${n}`}function kn(s,e){const t=s==="player"?e<=50:e>=50,n=s==="player"?e<=50?Math.max(1,e):Math.max(1,100-e):e>=50?Math.max(1,100-e):Math.max(1,e);return t?`their own ${n}`:`the ${n}`}function F(s,e){const t=n=>Math.max(1,Math.min(50,n));return s==="player"?e<=50?`HOME ${t(e)}`:`AWAY ${t(100-e)}`:e>=50?`AWAY ${t(100-e)}`:`HOME ${t(e)}`}function vn(s,e,t,n,a=!1,o){if(a)return{timeOff:0,crossedTwoMinute:!1};const i=ye(s.quarter,s.clock);let r=0,l=!1;if(e){const c=!o&&e.category==="gain"&&(e.yards||0)>0&&(e.yards||0)>=s.toGo;r=pe(e,i,c,t||x)}return n==="hurry_up"||n==="no_huddle"?r=Math.max(5,Math.floor(r*.7)):n==="burn_clock"&&e&&(e.category==="gain"||e.category==="loss")&&(r=Math.max(r,35),r=Math.min(r,40)),(s.quarter===2||s.quarter===4)&&s.clock>120&&s.clock-r<120&&(r=s.clock-120,l=!0),{timeOff:r,crossedTwoMinute:l}}function _n(s,e){const t={...s};return t.clock=Math.max(0,s.clock-e.timeOff),t}function Sn(s,e){const t=s.quarter>=3,n=s.diff<0,a=s.diff>0;if(t&&s.clock<=300){if(n&&Math.abs(s.diff)<=8)return"hurry_up";if(a&&Math.abs(s.diff)<=14)return"burn_clock"}if(ye(s.quarter,s.clock)){if(n)return"hurry_up";if(a)return"burn_clock"}return"normal"}class Tn{constructor(e){this.ctx=e,this.tracker=new ln(this.ctx.rng)}tracker;resolveSnap(e,t){const n=[],a=!!e.untimedDownScheduled,o={...e},i=/punt/i.test(String(t.playLabel)),r=at({state:o,charts:this.ctx.charts,deckName:t.deckName,playLabel:t.playLabel,defenseLabel:t.defenseLabel,rng:this.ctx.rng}),l=r.possessionChanged;if(this.beginDriveIfNeeded(o,n),r.outcome&&r.outcome.category==="penalty"&&r.outcome.penalty)return this.handlePenalty(o,r,n);let c={...r.state};const d=this.determineTempoForPlay(o),u=vn(o,r.outcome,this.ctx.timeKeeping,d,a,l);if(c=_n(c,u),u.crossedTwoMinute&&(n.push({type:"log",message:"Two-minute warning."}),n.push({type:"vfx",payload:{kind:"twoMinute"}})),this.narratePlayResult(o,c,t,r,n,i),this.updateLastNotes(o,t),!c.gameOver&&!r.touchdown&&!r.safety&&i&&o.down===4){const m=dn(o,c,{rng:this.ctx.rng,formatTeamYardLine:(y,w)=>F(y,w),endDriveSummaryIfAny:(y,w,p)=>this.endDriveSummaryIfAny(y,w,p)});return{state:m.state,events:[...n,...m.events]}}return r.touchdown?this.handleTouchdown(o,c,n):r.safety?this.handleSafety(o,c,n):!c.gameOver&&!r.touchdown&&!r.safety&&!l&&this.isTurnoverOnDowns(o,r.outcome)?this.handleTurnoverOnDowns(o,c,n):!c.gameOver&&!c.awaitingPAT&&c.clock===0&&!c.untimedDownScheduled?this.handleQuarterTransition(c,n):(n.push({type:"hud",payload:this.hudPayload(c)}),{state:c,events:n})}finalizePenaltyDecision(e,t,n,a){return pn(e,t,n,{formatOrdinal:o=>J(o),hudPayload:o=>this.hudPayload(o)},a)}resolvePATAndRestart(e,t){return fn(e,t,{rng:()=>this.ctx.rng?.()??(()=>{throw new Error("RNG not provided")})(),attemptPatInternal:n=>gn(n),scoringSideToDelta:(n,a)=>Z(n,a),isTrailing:(n,a)=>bn(n,a),performKickoff:(n,a,o)=>this.performKickoff(n,a,o),...this.ctx.policy?.choosePAT?{choosePAT:this.ctx.policy.choosePAT.bind(this.ctx.policy)}:{},...this.ctx.policy?.chooseKickoffType?{chooseKickoffType:this.ctx.policy.chooseKickoffType.bind(this.ctx.policy)}:{}})}attemptFieldGoal(e,t,n){return un(e,t,n,{rng:()=>this.ctx.rng?.()??(()=>{throw new Error("RNG not provided")})(),attemptFieldGoalKick:(a,o)=>We(a,o),scoringSideToDelta:(a,o)=>Z(a,o),randomHash:()=>mn(this.ctx.rng),formatClock:a=>ae(a),formatTeamYardLine:(a,o)=>F(a,o),performKickoff:(a,o,i)=>this.performKickoff(a,o,i),hudPayload:a=>this.hudPayload(a),timeKeepingFieldGoalSeconds:(this.ctx.timeKeeping||x).fieldgoal,missedFieldGoalSpot:(a,o)=>Wt(a)})}resolveSafetyRestart(e,t){return hn(e,t,{...this.ctx.policy?.chooseSafetyFreeKick?{chooseSafetyFreeKick:this.ctx.policy.chooseSafetyFreeKick.bind(this.ctx.policy)}:{},isLeading:(n,a)=>xe(n,a)})}performKickoff(e,t,n){return cn(e,t,n,{rng:this.ctx.rng,timeKeeping:this.ctx.timeKeeping,isLeading:(a,o)=>xe(a,o),isTied:a=>wn(a),formatTeamYardLine:(a,o)=>F(a,o)})}beginDriveIfNeeded(e,t){this.tracker.beginDriveIfNeeded(e,t,(n,a)=>F(n,a))}endDriveSummaryIfAny(e,t,n){this.tracker.endDriveSummaryIfAny(e,t,n)}hudPayload(e){return yn(e)}determineTempoForPlay(e){const t=e.score.player-e.score.ai,n={quarter:e.quarter,clock:e.clock,diff:e.possession==="player"?t:-t,side:e.possession};return this.ctx.policy?.chooseTempo?this.ctx.policy.chooseTempo(n):Sn(n)}handlePenalty(e,t,n){const a=t.outcome,o=ot({prePlayState:e,postPlayState:e,outcome:a,inTwoMinute:ye(e.quarter,e.clock)}),i=a.penalty;if((i.on==="defense"?e.possession:e.possession==="player"?"ai":"player")==="ai"){const c=o.decisionHint==="decline"?"decline":"accept",d=this.finalizePenaltyDecision(c==="accept"?o.accepted:o.declined,c,o.adminMeta,{on:i.on,yards:i.yards}),u=d.state;return n.push(...d.events),n.push({type:"hud",payload:this.hudPayload(u)}),{state:u,events:n}}const l={side:"player",summary:{down:e.down,toGo:e.toGo,ballOn:e.ballOn,quarter:e.quarter,clock:e.clock,possession:e.possession},prePlay:{down:e.down,toGo:e.toGo,ballOn:e.ballOn},accepted:o.accepted,declined:o.declined,penalty:{on:i.on,yards:i.yards,firstDown:i.firstDown},meta:{halfDistanceCapped:o.adminMeta.halfDistanceCapped,measuredFromMidfieldForLG:o.adminMeta.measuredFromMidfieldForLG,spotBasis:o.adminMeta.spotBasis,untimedDownScheduled:o.adminMeta.untimedDownScheduled}};return n.push({type:"choice-required",choice:"penaltyAcceptDecline",data:l}),n.push({type:"hud",payload:this.hudPayload(e)}),{state:e,events:n}}narratePlayResult(e,t,n,a,o,i){try{if(!(i&&e.down===4)){const l=this.buildResultSummary(e,t,a.outcome,{td:!!a.touchdown,safety:!!a.safety},String(n.playLabel),String(n.defenseLabel));this.tracker.incrementPlayInDrive(),this.tracker.incrementRunOrPassByLabel(String(n.playLabel||""));const c=this.buildBroadcastCall(e,t,n,a.outcome);o.push({type:"log",message:`Brad: ${c.pbp}`}),c.analyst&&c.analyst.trim()&&o.push({type:"log",message:`Rob: ${c.analyst}`}),o.push({type:"log",message:"────────"})}}catch{}}updateLastNotes(e,t){try{const n=e.possession==="player"?100-e.ballOn:e.ballOn,a=e.ballOn,o=e.possession==="player"?a>=50:a<=50,i=a>=45&&a<=55,r=e.possession==="player"?a<=10:a>=90;let l=null;n<=10&&e.toGo>=n?l="GoalToGo":n<=20?l="RedZone":i?l="NearMid":o?l="AcrossMid":r&&(l="BackedUp");const c=n+17<=45;this.tracker.setLastNotesForSide(e.possession,{zone:l,fgInRange:c,defense:String(t.defenseLabel||"")})}catch{}}handleTouchdown(e,t,n){t.awaitingPAT=!0;const a=e.possession;n.push({type:"log",message:"Touchdown!"}),n.push({type:"score",payload:{...Z(a,6),kind:"TD"}}),n.push({type:"vfx",payload:{kind:"td"}});const o=this.resolvePATAndRestart(t,a);return t=o.state,n.push(...o.events),n.push({type:"log",message:`Brad: Scoreboard — HOME ${t.score.player} — AWAY ${t.score.ai} — Q${t.quarter} ${ae(t.clock)}`}),n.push({type:"log",message:"────────"}),this.endDriveSummaryIfAny(t,n,"touchdown"),{state:t,events:n}}handleSafety(e,t,n){const a=e.possession,o=a==="player"?"ai":"player";n.push({type:"log",message:"Brad: Safety!"}),n.push({type:"score",payload:{...Z(o,2),kind:"Safety"}}),n.push({type:"log",message:`Brad: Scoreboard — HOME ${o==="player"?t.score.player+2:t.score.player} — AWAY ${o==="ai"?t.score.ai+2:t.score.ai} — safety awarded`});const i=this.resolveSafetyRestart(t,a);return t=i.state,n.push(...i.events),n.push({type:"log",message:"────────"}),this.endDriveSummaryIfAny(t,n,"safety"),{state:t,events:n}}isTurnoverOnDowns(e,t){return e.down!==4||!t?!1:t.category==="incomplete"||(t.category==="loss"||t.category==="gain")&&(t.yards||0)<e.toGo}handleTurnoverOnDowns(e,t,n){const a=F(e.possession,e.ballOn);return n.push({type:"log",message:`Brad: ${J(e.down)} & ${e.toGo} — stuffed — turnover on downs at ${a}`}),t.possession=e.possession==="player"?"ai":"player",t.down=1,t.toGo=10,this.endDriveSummaryIfAny(t,n,"downs"),n.push({type:"log",message:"────────"}),{state:t,events:n}}handleQuarterTransition(e,t){const n=e.quarter;t.push({type:"endOfQuarter",payload:{quarter:n}});try{const o=this.tracker.getQuarterStatsRef(),i=o.runs,r=o.passes,c=`${`End of Q${n} — HOME ${e.score.player} — AWAY ${e.score.ai}.`} Pace so far: ${i} runs, ${r} passes.`,d=i>r?"Ground games setting tone; watch for play action next quarter.":r>i?"Air it out approach; watch the pass rush fatigue.":"Balanced so far; both sides settling in.";t.push({type:"log",message:`Brad: ${c}`}),t.push({type:"log",message:`Rob: ${d}`})}catch{}const a=this.tracker.getQuarterStatsRef();if(a.quarter=n+1,a.runs=0,a.passes=0,a.pointsHome=0,a.pointsAway=0,a.explosives=0,a.turnovers=0,n===2){t.push({type:"halftime"}),t.push({type:"log",message:"Start of quarter 3."}),e.quarter=3,e.clock=900;const i=e.openingKickTo||"player",r=this.performKickoff(e,"normal",i);e=r.state,t.push(...r.events)}else n===4?(e.gameOver=!0,t.push({type:"final",payload:{score:e.score}})):(t.push({type:"log",message:`Brad: Start of quarter ${n+1}.`}),e.quarter=n+1,e.clock=900);return t.push({type:"log",message:"────────"}),{state:e,events:t}}buildBroadcastCall(e,t,n,a){return an(e,t,n,a,{rng:this.ctx.rng,playInDrive:this.tracker.getPlayInDrive(),formatClock:o=>ae(o),formatOrdinal:o=>J(o),formatTeamYardLine:(o,i)=>F(o,i),formatPossessionSpotForBroadcast:(o,i)=>kn(o,i),quarterStats:this.tracker.getQuarterStatsRef()})}buildResultSummary(e,t,n,a,o,i){return rn(e,t,n,a,o,i,{formatOrdinal:r=>J(r),formatTeamYardLine:(r,l)=>F(r,l),rng:()=>this.ctx.rng?.()??(()=>{throw new Error("RNG not provided")})(),getLastNotesForSide:r=>this.tracker.getLastNotesForSide(r),setLastNotesForSide:(r,l)=>this.tracker.setLastNotesForSide(r,l)})}chooseCommentaryLines(e){return on(e)}}class lt{constructor(e){this.ctx=e,this.core=new Tn(e)}core;resolveSnap(e,t){return this.core.resolveSnap(e,t)}finalizePenaltyDecision(e,t,n,a){return this.core.finalizePenaltyDecision(e,t,n,a)}resolvePATAndRestart(e,t){return this.core.resolvePATAndRestart(e,t)}attemptFieldGoal(e,t,n){return this.core.attemptFieldGoal(e,t,n)}resolveSafetyRestart(e,t){return this.core.resolveSafetyRestart(e,t)}performKickoff(e,t,n){return this.core.performKickoff(e,t,n)}}let re=!1;const f=new _t;let A={offenseCharts:null,placeKicking:null,timeKeeping:null,longGain:null},On=null,ct=!1;async function Pn(){if(console.log("ensureUIRegistered called, uiRegistered:",re),!re){console.log("Starting UI registration..."),$n();try{const{ErrorBoundary:s}=await C(async()=>{const{ErrorBoundary:c}=await import("./ErrorBoundary-B0safkMN.js");return{ErrorBoundary:c}},[]),{createFallbackHUD:e,createFallbackLog:t,createFallbackField:n,createFallbackHand:a,createFallbackControls:o,createGenericFallback:i,createLoadingSpinner:r}=await C(async()=>{const{createFallbackHUD:c,createFallbackLog:d,createFallbackField:u,createFallbackHand:m,createFallbackControls:y,createGenericFallback:w,createLoadingSpinner:p}=await import("./FallbackComponents-BxQai0J3.js");return{createFallbackHUD:c,createFallbackLog:d,createFallbackField:u,createFallbackHand:m,createFallbackControls:y,createGenericFallback:w,createLoadingSpinner:p}},[]);await Mn(s,e,t,n,a,o,r),await En(s,a,o,i),await Ln();const{registerEngineIndicator:l}=await C(async()=>{const{registerEngineIndicator:c}=await import("./EngineIndicator-BBoOvHZM.js");return{registerEngineIndicator:c}},[]);l(f),re=!0,dt(),f.emit("ui:ready",{})}catch(s){console.error("Failed to register UI components:",s),C(async()=>{const{createLoadingSpinner:e}=await import("./FallbackComponents-BxQai0J3.js");return{createLoadingSpinner:e}},[]).then(({createLoadingSpinner:e})=>{Gn(e)}).catch(()=>{if(typeof document<"u"){const e=document.createElement("div");e.textContent="Critical error - please refresh the page",e.style.cssText="position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:red;color:white;padding:20px;border-radius:8px;",document.body.appendChild(e)}})}}}function $n(){if(typeof document>"u")return;const s=document.createElement("div");s.id="initial-loading",s.style.cssText=`
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.8);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    color: white;
    font-family: Arial, sans-serif;
    flex-direction: column;
  `;const e=document.createElement("div");e.style.cssText=`
    width: 40px;
    height: 40px;
    border: 4px solid #333;
    border-top: 4px solid #007bff;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin-bottom: 16px;
  `;const t=document.createElement("div");if(t.textContent="Loading Gridiron Strategy...",s.appendChild(e),s.appendChild(t),!document.getElementById("initial-loading-styles")){const n=document.createElement("style");n.id="initial-loading-styles",n.textContent=`
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
    `,document.head.appendChild(n)}document.body.appendChild(s)}function dt(){if(typeof document>"u")return;const s=document.getElementById("initial-loading");s&&s.remove()}function Gn(s){if(typeof document>"u")return;dt();const e=s("Critical error - please refresh the page");document.body.appendChild(e)}async function Mn(s,e,t,n,a,o,i){const r=[{module:"./ui/HUD",register:"registerHUD",name:"HUD",fallback:e},{module:"./ui/Log",register:"registerLog",name:"GameLog",fallback:t},{module:"./ui/Field",register:"registerField",name:"GameField",fallback:n},{module:"./ui/Controls",register:"registerControls",name:"GameControls",fallback:o},{module:"./ui/Hand",register:"registerHand",name:"PlayerHand",fallback:a}];console.log("Starting core UI component registration...");for(const l of r){console.log(`Loading ${l.name} component from ${l.module}...`);try{const c=await import(l.module);console.log(`${l.name} module loaded successfully`);const d=c[l.register],u=m=>{try{return console.log(`Calling ${l.name} register function...`),d.call(c,m)}catch(y){console.error(`${l.name} component registration failed:`,y),m.emit("log",{message:`${l.name} component failed to initialize`});return}};console.log(`Registering ${l.name}...`),u(f),console.log(`${l.name} registered successfully`)}catch(c){if(console.error(`${l.name} module failed to load:`,c),typeof document<"u"){const d=document.createElement("div");d.style.cssText=`
          position: fixed;
          top: 10px;
          right: 10px;
          background: #ff4444;
          color: white;
          padding: 10px;
          border-radius: 4px;
          z-index: 9999;
          font-family: monospace;
          font-size: 12px;
        `,d.textContent=`${l.name} failed to load - check console`,document.body.appendChild(d)}}}}async function En(s,e,t,n){const a=[],o=i=>{"requestIdleCallback"in window?requestIdleCallback(i,{timeout:2e3}):setTimeout(i,100)};for(const i of a)o(async()=>{try{const r=await import(i.module),l=new s({componentName:i.name,fallbackComponent:(u,m)=>i.fallback(),onError:(u,m)=>{console.error(`${i.name} component error:`,u),f.emit("log",{message:`${i.name} component failed - using fallback display`})}}),c=r[i.register];(u=>{try{return c.call(r,u)}catch(m){l.handleError(m);return}})(f)}catch(r){console.warn(`${i.name} module failed to load:`,r);const l=i.fallback();if(typeof document<"u"){const c=document.getElementById(i.name.toLowerCase())||document.createElement("div");c.id=i.name.toLowerCase(),c.appendChild(l),document.body.appendChild(c)}}})}async function Ln(){["./ui/DevMode","./ui/SpecialTeamsUI","./ui/PenaltyUI","./ui/VFX","./ui/SFX","./qa/Harness","./ui/dice/DiceUI","./ui/dice/CardSelector","./ui/dice/PenaltyModal","./ui/dice/ResultDisplay","./ui/dice/integration","./ui/cards/ProgressiveCardSystem","./ui/cards/CardRenderer","./ui/cards/CardDefinitions","./ui/cards/RiskIndicator","./ui/cards/PerimeterBadge"].forEach(async e=>{try{const t=await import(e),a=`register${e.split("/").pop()||""}`;let o=t[a];if(typeof o!="function"){const i=Object.keys(t).filter(l=>l.startsWith("register")&&typeof t[l]=="function");let r=null;i.length===1&&(r=i[0]),r&&(o=t[r])}typeof o=="function"&&o(f)}catch(t){console.warn(`${e} component failed to load:`,t)}})}async function Dn(){try{const{ProgressiveEnhancement:s}=await C(async()=>{const{ProgressiveEnhancement:e}=await import("./ProgressiveEnhancement-xu3nqoBR.js");return{ProgressiveEnhancement:e}},[]);On=new s(f,{enableWebGL:!0,enableWebAudio:!0,enableOfflineSupport:!0,enableAdvancedAnimations:!0,enablePerformanceMonitoring:!0}),f.on("features:detected",({features:e})=>{console.log("Browser features detected:",e),e.webgl&&f.emit("log",{message:"Enhanced graphics enabled"}),e.webAudio&&f.emit("log",{message:"Enhanced audio enabled"}),e.serviceWorker&&f.emit("log",{message:"Offline support available"})}),f.on("performance:loadTime",({loadTime:e})=>{console.log(`UI loaded in ${Math.round(e)}ms`),f.emit("log",{message:`UI loaded in ${Math.round(e)}ms`})}),f.on("performance:fps",({fps:e})=>{e<30&&(console.warn(`Low frame rate detected: ${e}fps`),f.emit("log",{message:`Performance: ${e}fps`}))})}catch(s){console.warn("Progressive enhancement failed to initialize:",s)}}async function An(){try{const s=await C(()=>import("./tables-CJNVkz7O.js"),__vite__mapDeps([5,0,1,2,3,4])),[e,t,n,a]=await Promise.all([s.fetchOffenseCharts(),s.fetchPlaceKicking(),s.fetchTimeKeeping(),s.fetchLongGain()]);A={offenseCharts:e.ok?e.data:null,placeKicking:t.ok?t.data:null,timeKeeping:n.ok?n.data:null,longGain:a.ok?a.data:null};const o=`Loaded offense charts ${e.ok?"✓":`✕ (${e.error.code})`}, place-kicking ${t.ok?"✓":`✕ (${t.error.code})`}, timekeeping ${n.ok?"✓":`✕ (${n.error.code})`}, long-gain ${a.ok?"✓":`✕ (${a.error.code})`}`;f.emit("log",{message:o})}catch{A={offenseCharts:null,placeKicking:null,timeKeeping:null,longGain:null}}typeof window<"u"&&window.GS&&(window.GS.tables=A)}function ge(s){typeof document>"u"||(document.body.dataset.theme=s)}f.on("ui:themeChanged",({theme:s})=>{try{ge(s)}catch(e){console.error("Failed to apply theme:",e)}});try{f.on&&f.on("qa:startTestGame",()=>{ct=!0})}catch(s){console.warn("Unable to wire qa:startTestGame listener:",s)}function In(){try{if(typeof localStorage<"u")return localStorage.getItem("gs_dev_mode")==="1"}catch{}try{return!!globalThis.GS?.__devMode?.enabled}catch{}return!1}function Cn(s){const e=Math.max(0,Math.floor(s)),t=Math.floor(e/60),n=(e%60).toString().padStart(2,"0");return`${t}:${n}`}function Rn(s,e,t){const n=["1st","2nd","3rd","4th"],a=Math.min(s.down,4)-1,o=n[a]||`${s.down}th`,i=(()=>{const c=s.possession==="player"?s.ballOn+s.toGo:s.ballOn-s.toGo;return(s.possession==="player"?c>=100:c<=0)?"Goal":String(s.toGo)})(),r=s.ballOn<=50?s.ballOn:100-s.ballOn,l=s.possession==="player"?"HOME":"AWAY";return`Q${s.quarter} | ${Cn(s.clock)} | ${o} & ${i} | Ball on ${Math.round(r)} | ${l} (possession) | ${e} | ${t}`}async function Fn(s){if(!(typeof window>"u")){await Dn(),await Pn(),s&&s.theme&&ge(s.theme),await An(),f.emit("hudUpdate",{quarter:1,clock:900,down:1,toGo:10,ballOn:25,possession:"player",score:{player:0,ai:0}});try{f.on("ui:newGame",async({deckName:e,opponentName:t})=>{try{if(!A.offenseCharts){f.emit("log",{message:"Data tables not loaded yet."});return}const n=Date.now()%1e9,a=z(n),o=new lt({charts:A.offenseCharts,rng:a,timeKeeping:A.timeKeeping||{gain0to20:30,gain20plus:45,loss:30,outOfBounds:15,incomplete:15,interception:30,penalty:15,fumble:15,kickoff:15,fieldgoal:15,punt:15,extraPoint:0},policy:{chooseTempo:({quarter:h,clock:g,diff:k,side:S})=>{try{return st().chooseTempo({quarter:h,time_remaining_sec:g,half:h<=2?1:2,score_diff:k,down:1,distance_to_go_yd:10,yardline_100:25,has_two_minute_warning:(h===2||h===4)&&g>120,team_archetype:"Pro",home_or_road:S==="player"?"home":"road",underdog:!1,possession_after_score_pref:"normal"}).tempo}catch{return"normal"}}}}),r=(h=>h==="Pro Style"||h==="Ball Control"||h==="Aerial Style"?h:"Pro Style")(e);let l="Pro Style";t==="Andy Reid"?l="Aerial Style":t==="Bill Belichick"?l="Ball Control":t==="John Madden"&&(l="Pro Style");const c={seed:n,quarter:1,clock:900,down:1,toGo:10,ballOn:25,possession:"ai",awaitingPAT:!1,gameOver:!1,score:{player:0,ai:0}},d=o.performKickoff(c,"normal","ai"),u=d.state;if(f.emit("log",{message:`New game started — You: ${r} vs ${String(t||"AI")} (seed=${n})`}),f.emit("hudUpdate",{quarter:u.quarter,clock:u.clock,down:u.down,toGo:u.toGo,ballOn:u.ballOn,possession:u.possession,score:u.score}),u.possession==="player"){const g=(q[r]||[]).map(k=>({id:k.id,label:k.label,art:k.art,type:k.type}));f.emit("handUpdate",{cards:g,isPlayerOffense:!0})}else{const h=N.map(g=>({id:g.id,label:g.label,art:`assets/cards/Defense/${g.label}.jpg`,type:"defense"}));f.emit("handUpdate",{cards:h,isPlayerOffense:!1})}window.GS_RUNTIME={flow:o,playerDeck:r,aiDeck:l,state:u,seed:n};const m=new At,y=h=>{for(const g of h)if(g.type==="hud")f.emit("hudUpdate",g.payload);else if(g.type==="log"){if(In()&&ct)try{const S=window.GS_RUNTIME||{},O=S.__lastOffLabel||"",_=S.__lastDefLabel||"",T=S.state;if(T&&O&&_){const P=Rn(T,O,_);f.emit("log",{message:`${P} — ${g.message}`});continue}}catch(S){console.debug("Failed to build dev prefix",S)}f.emit("log",{message:g.message})}else g.type==="vfx"?f.emit("vfx",{type:g.payload.kind,payload:g.payload.data}):g.type==="final"?f.emit("log",{message:`Final — HOME ${g.payload.score.player} — AWAY ${g.payload.score.ai}`}):g.type==="halftime"?f.emit("log",{message:"Halftime"}):g.type==="endOfQuarter"?f.emit("log",{message:`End of Q${g.payload.quarter}`}):g.type==="score"&&f.emit("log",{message:`Score: ${g.payload.kind}`})};try{y(d.events)}catch(h){console.debug("Kickoff event translation failed",h)}const w={charts:A.offenseCharts,getOffenseHand:()=>(q[r]||[]).map(g=>({id:g.id,label:g.label,type:g.type})),getDefenseOptions:()=>N.map(h=>h.label),getWhiteSignRestriction:h=>en[h]??null},p=new Ge(w,!0),b=new Ge(w,!0);try{await p.loadPersonality(),await b.loadPersonality()}catch(h){console.warn("PlayCaller personality load failed",h)}p.reset(n),b.reset(n+1),f.on("hudUpdate",({possession:h})=>{try{const g=window.GS_RUNTIME||{};if(h==="player"){const S=(q[g.playerDeck]||[]).map(O=>({id:O.id,label:O.label,art:O.art,type:O.type}));f.emit("handUpdate",{cards:S,isPlayerOffense:!0})}else{const k=N.map(S=>({id:S.id,label:S.label,art:`assets/cards/Defense/${S.label}.jpg`,type:"defense"}));f.emit("handUpdate",{cards:k,isPlayerOffense:!1})}}catch(g){console.debug("HUD sync failed",g)}}),f.on("ui:playCard",async({cardId:h})=>{try{const g=window.GS_RUNTIME||{},k=g.state;if(!k||k.gameOver)return;if(await it.initialize(),k.possession==="player"){const O=(q[g.playerDeck]||[]).find(P=>P.id===h);if(!O)return;const _=b.choose_defense_play(k),T={...k};try{const P=N.find(v=>v.label===_.label),$=await Be(O.id,P?.id||_.label,k,z(k.seed));if(f.emit("log",{message:`Play resolved: ${$.yards>0?"Gain":$.yards<0?"Loss":"No gain"} of ${Math.abs($.yards)} yards`}),$.turnover&&typeof $.turnover!="boolean"){const v=$.turnover;f.emit("log",{message:`${v.type}${typeof v.return_yards=="number"?` - ${v.return_yards} yard return`:""}`})}const E={...k};$.yards!==0&&(E.ballOn=Math.max(0,Math.min(100,E.ballOn+(E.possession==="player"?$.yards:-$.yards))));try{window.GS_RUNTIME.__lastOffLabel=O.label,window.GS_RUNTIME.__lastDefLabel=_.label}catch{}window.GS_RUNTIME.state=E;try{const v=/pass/i.test(O.label)?"pass":"run";m.record("player",v,{down:T.down,toGo:T.toGo,ballOnFromHome:T.ballOn,playerIsHome:!0,possessing:T.possession})}catch(v){console.debug("Tendency record failed",v)}}catch(P){console.warn("Engine resolution failed, falling back to deterministic:",P);const $={deckName:g.playerDeck,playLabel:O.label,defenseLabel:_.label},E=o.resolveSnap(k,$);y(E.events),window.GS_RUNTIME.state=E.state}}else{const S=N.find(T=>T.id===h);if(!S)return;const O=b.choose_offense_play(k,g.aiDeck),_={...k};try{const T=await Be(O.playLabel,S.id,k,z(k.seed));if(f.emit("log",{message:`AI Play resolved: ${T.yards>0?"Gain":T.yards<0?"Loss":"No gain"} of ${Math.abs(T.yards)} yards`}),T.turnover&&typeof T.turnover!="boolean"){const $=T.turnover;f.emit("log",{message:`AI ${$.type}${typeof $.return_yards=="number"?` - ${$.return_yards} yard return`:""}`})}const P={...k};T.yards!==0&&(P.ballOn=Math.max(0,Math.min(100,P.ballOn+(P.possession==="player"?T.yards:-T.yards))));try{window.GS_RUNTIME.__lastOffLabel=O.playLabel,window.GS_RUNTIME.__lastDefLabel=S.label}catch{}window.GS_RUNTIME.state=P}catch(T){console.warn("Engine resolution failed, falling back to deterministic:",T);const P={deckName:g.aiDeck,playLabel:O.playLabel,defenseLabel:S.label},$=o.resolveSnap(k,P);y($.events),window.GS_RUNTIME.state=$.state}}}catch(g){try{f.emit("log",{message:`Play selection failed: ${String(g?.message||g)}`})}catch{}}})}catch(n){f.emit("log",{message:`Failed to start new game: ${n?.message||n}`})}})}catch(e){console.warn("Failed to register ui:newGame handler",e)}}}function Nn(){}const fe={bus:f,rules:{Kickoff:yt,Punt:gt,PlaceKicking:bt,ResultParsing:kt,Timekeeping:vt,Charts:Ot,LongGain:ht},ai:{PATDecision:$t,CoachProfiles:Mt},tables:A,start:Fn,dispose:Nn,setTheme:ge,runtime:{resolvePlayAdapter:s=>{const e=at({state:s.state,charts:s.charts,deckName:s.deckName,playLabel:s.playLabel,defenseLabel:s.defenseLabel,rng:s.rng}),t={...e.state,clock:s.state.clock,score:{...s.state.score},awaitingPAT:s.state.awaitingPAT,gameOver:s.state.gameOver},n=[];return e.possessionChanged&&n.push({type:"possessionChanged"}),e.touchdown&&n.push({type:"touchdown"}),e.safety&&n.push({type:"safety"}),{nextState:t,outcome:e.outcome,events:n}},createFlow:s=>{const e=z(s??12345);if(!A.offenseCharts)throw new Error("Offense charts not loaded");const t=new lt({charts:A.offenseCharts,rng:e,timeKeeping:A.timeKeeping||{gain0to20:30,gain20plus:45,loss:30,outOfBounds:15,incomplete:15,interception:30,penalty:15,fumble:15,kickoff:15,fieldgoal:15,punt:15,extraPoint:0},policy:{chooseTempo:({quarter:o,clock:i,diff:r,side:l})=>{try{return st().chooseTempo({quarter:o,time_remaining_sec:i,half:o<=2?1:2,score_diff:r,down:1,distance_to_go_yd:10,yardline_100:25,has_two_minute_warning:(o===2||o===4)&&i>120,team_archetype:"Pro",home_or_road:l==="player"?"home":"road",underdog:!1,possession_after_score_pref:"normal"}).tempo}catch{return"normal"}}}});let n=null;const a=o=>{for(const i of o)if(i.type==="hud")f.emit("hudUpdate",i.payload);else if(i.type==="log")f.emit("log",{message:i.message}),/Field goal missed/i.test(i.message)&&(f.emit&&f.emit("vfx:banner",{text:"NO GOOD"}),f.emit&&f.emit("sfx:crowd",{kind:"groan"}));else if(i.type==="vfx"){const r=i.payload.kind;r==="td"?(f.emit&&f.emit("vfx:banner",{text:"TOUCHDOWN!",gold:!0}),f.emit&&f.emit("vfx:flash",{}),f.emit&&f.emit("sfx:crowd",{kind:"cheer"})):r==="interception"?(f.emit&&f.emit("vfx:banner",{text:"INTERCEPTION!"}),f.emit&&f.emit("vfx:shake",{selector:"body"}),f.emit&&f.emit("sfx:hit",{})):r==="twoMinute"&&f.emit&&f.emit("vfx:flash",{}),f.emit("vfx",{type:r,payload:i.payload.data})}else if(i.type==="choice-required"){if(f.emit("flow:choiceRequired",{choice:i.choice,data:i.data}),i.choice==="penaltyAcceptDecline"){const r=i.data||{};n={accepted:r.accepted,declined:r.declined,meta:r.meta}}}else i.type==="final"?f.emit("log",{message:`Final — HOME ${i.payload.score.player} — AWAY ${i.payload.score.ai}`}):i.type==="halftime"?f.emit("log",{message:"Halftime"}):i.type==="endOfQuarter"?f.emit("log",{message:`End of Q${i.payload.quarter}`}):i.type==="score"&&(f.emit("log",{message:`Score: ${i.payload.kind}`}),f.emit&&f.emit("vfx:scorePop",{}),i.payload.kind==="FG"?(f.emit&&f.emit("vfx:banner",{text:"FIELD GOAL!"}),f.emit&&f.emit("sfx:beep",{freq:880,type:"triangle"})):i.payload.kind==="Safety"?(f.emit&&f.emit("vfx:banner",{text:"SAFETY!",gold:!0}),f.emit&&f.emit("sfx:beep",{freq:220,type:"square"})):i.payload.kind==="TD"&&(f.emit&&f.emit("vfx:banner",{text:"TOUCHDOWN!",gold:!0}),f.emit&&f.emit("sfx:crowd",{kind:"cheer"})))};return f.on&&f.on("ui:choice.penalty",o=>{if(!n)return;const i=n,r=o.decision==="accept"?i.accepted:i.declined,l=t.finalizePenaltyDecision(r,o.decision,i.meta);l.state,a(l.events),n=null}),{resolveSnap:(o,i)=>{const r=t.resolveSnap(o,i);return a(r.events),r.state,r},applyPenaltyDecision:(o,i,r)=>{const l=i==="accept"?r.accepted:r.declined,c=t.finalizePenaltyDecision(l,i,r.meta);return a(c.events),c.state,c},resolvePATAndRestart:(o,i)=>{const r=t.resolvePATAndRestart(o,i);return a(r.events),r.state,r},attemptFieldGoal:(o,i,r)=>{const l=t.attemptFieldGoal(o,i,r);return a(l.events),l.state,l},resolveSafetyRestart:(o,i)=>{const r=t.resolveSafetyRestart(o,i);return a(r.events),r.state,r},performKickoff:(o,i,r)=>{const l=t.performKickoff(o,i,r);return a(l.events),l.state,l},inner:t}}}};typeof window<"u"&&!window.GS&&(window.GS=fe);if(typeof document<"u")if(document.readyState==="loading")document.addEventListener("DOMContentLoaded",()=>{try{fe.start()}catch(s){console.error("Runtime start failed",s)}},{once:!0});else try{fe.start()}catch(s){console.error("Runtime start failed",s)}export{rt as a,Bn as g};
//# sourceMappingURL=index-D_TaRqHT.js.map
